/*! For license information please see pushly-sdk.min.js.LICENSE */
!function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s="./src/web.ts")}({"./node_modules/@firebase/app/dist/index.cjs.js":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./node_modules/@firebase/util/dist/index.cjs.js"),i=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},s="[DEFAULT]",o=[],u=function(){function t(t,n,e){this.firebase_=e,this.isDeleted_=!1,this.services_={},this.name_=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled||!1,this.options_=r.deepCopy(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){o.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){o=o.filter(function(n){return n!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed_(),this._automaticDataCollectionEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(n){t.checkDestroyed_(),n()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);var n=[];return Object.keys(t.services_).forEach(function(e){Object.keys(t.services_[e]).forEach(function(r){n.push(t.services_[e][r])})}),Promise.all(n.map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,n){if(void 0===n&&(n=s),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][n]){var e=n!==s?n:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),e);this.services_[t][n]=r}return this.services_[t][n]},t.prototype.extendApp=function(t){var n=this;r.deepExtend(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(o.forEach(function(t){n.INTERNAL.addAuthTokenListener(t)}),o=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&c("app-deleted",{name:this.name_})},t}();function c(t,n){throw a.create(t,n)}u.prototype.name&&u.prototype.options||u.prototype.delete||console.log("dc");var a=new r.ErrorFactory("app","Firebase",{"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."}),f=function t(){var n={},e={},o={},a={__esModule:!0,initializeApp:function(t,e){if(void 0===e&&(e={}),"object"!=typeof e||null===e){var r=e;e={name:r}}var o=e;void 0===o.name&&(o.name=s);var f=o.name;"string"==typeof f&&f||c("bad-app-name",{name:f+""}),i(n,f)&&c("duplicate-app",{name:f});var h=new u(t,o,a);return n[f]=h,d(h,"create"),h},app:f,apps:null,Promise:Promise,SDK_VERSION:"5.8.3",INTERNAL:{registerService:function(t,n,i,s,d){e[t]&&c("duplicate-service",{name:t}),e[t]=n,s&&(o[t]=s,h().forEach(function(t){s("create",t)}));var l=function(n){return void 0===n&&(n=f()),"function"!=typeof n[t]&&c("invalid-app-argument",{name:t}),n[t]()};return void 0!==i&&r.deepExtend(l,i),a[t]=l,u.prototype[t]=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return this._getService.bind(this,t).apply(this,d?n:[])},l},createFirebaseNamespace:t,extendNamespace:function(t){r.deepExtend(a,t)},createSubscribe:r.createSubscribe,ErrorFactory:r.ErrorFactory,removeApp:function(t){d(n[t],"delete"),delete n[t]},factories:e,useAsService:l,Promise:Promise,deepExtend:r.deepExtend}};function f(t){return i(n,t=t||s)||c("no-app",{name:t}),n[t]}function h(){return Object.keys(n).map(function(t){return n[t]})}function d(t,n){Object.keys(e).forEach(function(e){var r=l(t,e);null!==r&&o[r]&&o[r](n,t)})}function l(t,n){if("serverAuth"===n)return null;var e=n;return t.options,e}return r.patchProperty(a,"default",a),Object.defineProperty(a,"apps",{get:h}),r.patchProperty(f,"App",u),a}();n.firebase=f,n.default=f},"./node_modules/@firebase/messaging/dist/index.esm.js":function(t,n,e){"use strict";e.r(n),e.d(n,"registerMessaging",function(){return M}),e.d(n,"isSupported",function(){return I});var r,i,s,o=e("./node_modules/@firebase/util/dist/index.cjs.js"),u=e("./node_modules/tslib/tslib.es6.js"),c=e("./node_modules/@firebase/app/dist/index.cjs.js"),a=e.n(c),f={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",TOKEN_UNSUBSCRIBE_FAILED:"token-unsubscribe-failed",TOKEN_UPDATE_FAILED:"token-update-failed",TOKEN_UPDATE_NO_TOKEN:"token-update-no-token",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key",INVALID_PUBLIC_VAPID_KEY:"invalid-public-vapid-key",USE_PUBLIC_KEY_BEFORE_GET_TOKEN:"use-public-key-before-get-token",PUBLIC_KEY_DECRYPTION_FAILED:"public-vapid-key-decryption-failed"},h=((r={})[f.AVAILABLE_IN_WINDOW]="This method is available in a Window context.",r[f.AVAILABLE_IN_SW]="This method is available in a service worker context.",r[f.SHOULD_BE_INHERITED]="This method should be overriden by extended classes.",r[f.BAD_SENDER_ID]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",r[f.PERMISSION_DEFAULT]="The required permissions were not granted and dismissed instead.",r[f.PERMISSION_BLOCKED]="The required permissions were not granted and blocked instead.",r[f.UNSUPPORTED_BROWSER]="This browser doesn't support the API's required to use the firebase SDK.",r[f.NOTIFICATIONS_BLOCKED]="Notifications have been blocked.",r[f.FAILED_DEFAULT_REGISTRATION]="We are unable to register the default service worker. {$browserErrorMessage}",r[f.SW_REGISTRATION_EXPECTED]="A service worker registration was the expected input.",r[f.GET_SUBSCRIPTION_FAILED]="There was an error when trying to get any existing Push Subscriptions.",r[f.INVALID_SAVED_TOKEN]="Unable to access details of the saved token.",r[f.SW_REG_REDUNDANT]="The service worker being used for push was made redundant.",r[f.TOKEN_SUBSCRIBE_FAILED]="A problem occured while subscribing the user to FCM: {$message}",r[f.TOKEN_SUBSCRIBE_NO_TOKEN]="FCM returned no token when subscribing the user to push.",r[f.TOKEN_SUBSCRIBE_NO_PUSH_SET]="FCM returned an invalid response when getting an FCM token.",r[f.TOKEN_UNSUBSCRIBE_FAILED]="A problem occured while unsubscribing the user from FCM: {$message}",r[f.TOKEN_UPDATE_FAILED]="A problem occured while updating the user from FCM: {$message}",r[f.TOKEN_UPDATE_NO_TOKEN]="FCM returned no token when updating the user to push.",r[f.USE_SW_BEFORE_GET_TOKEN]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",r[f.INVALID_DELETE_TOKEN]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",r[f.DELETE_TOKEN_NOT_FOUND]="The deletion attempt for token could not be performed as the token was not found.",r[f.DELETE_SCOPE_NOT_FOUND]="The deletion attempt for service worker scope could not be performed as the scope was not found.",r[f.BG_HANDLER_FUNCTION_EXPECTED]="The input to setBackgroundMessageHandler() must be a function.",r[f.NO_WINDOW_CLIENT_TO_MSG]="An attempt was made to message a non-existant window client.",r[f.UNABLE_TO_RESUBSCRIBE]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",r[f.NO_FCM_TOKEN_FOR_RESUBSCRIBE]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",r[f.FAILED_TO_DELETE_TOKEN]="Unable to delete the currently saved token.",r[f.NO_SW_IN_REG]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",r[f.INCORRECT_GCM_SENDER_ID]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",r[f.BAD_SCOPE]="The service worker scope must be a string with at least one character.",r[f.BAD_VAPID_KEY]="The public VAPID key is not a Uint8Array with 65 bytes.",r[f.BAD_SUBSCRIPTION]="The subscription must be a valid PushSubscription.",r[f.BAD_TOKEN]="The FCM Token used for storage / lookup was not a valid token string.",r[f.BAD_PUSH_SET]="The FCM push set used for storage / lookup was not not a valid push set string.",r[f.FAILED_DELETE_VAPID_KEY]="The VAPID key could not be deleted.",r[f.INVALID_PUBLIC_VAPID_KEY]="The public VAPID key must be a string.",r[f.PUBLIC_KEY_DECRYPTION_FAILED]="The public VAPID key did not equal 65 bytes when decrypted.",r),d=new o.ErrorFactory("messaging","Messaging",h),l=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),v="https://fcm.googleapis.com";function p(t,n){if(null==t||null==n)return!1;if(t===n)return!0;if(t.byteLength!==n.byteLength)return!1;for(var e=new DataView(t),r=new DataView(n),i=0;i<t.byteLength;i++)if(e.getUint8(i)!==r.getUint8(i))return!1;return!0}function b(t){return function(t){var n=new Uint8Array(t);return btoa(String.fromCharCode.apply(null,n))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}!function(t){t.TYPE_OF_MSG="firebase-messaging-msg-type",t.DATA="firebase-messaging-msg-data"}(i||(i={})),function(t){t.PUSH_MSG_RECEIVED="push-msg-received",t.NOTIFICATION_CLICKED="notification-clicked"}(s||(s={}));var w=function(){function t(){}return t.prototype.getToken=function(t,n,e){return Object(u.__awaiter)(this,void 0,void 0,function(){var r,i,s,o,c,a,h,w;return Object(u.__generator)(this,function(u){switch(u.label){case 0:r=b(n.getKey("p256dh")),i=b(n.getKey("auth")),s="authorized_entity="+t+"&endpoint="+n.endpoint+"&encryption_key="+r+"&encryption_auth="+i,p(e.buffer,l.buffer)||(o=b(e),s+="&application_pub_key="+o),(c=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:c,body:s},u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch(v+"/fcm/connect/subscribe",a)];case 2:return[4,u.sent().json()];case 3:return h=u.sent(),[3,5];case 4:throw u.sent(),d.create(f.TOKEN_SUBSCRIBE_FAILED);case 5:if(h.error)throw w=h.error.message,d.create(f.TOKEN_SUBSCRIBE_FAILED,{message:w});if(!h.token)throw d.create(f.TOKEN_SUBSCRIBE_NO_TOKEN);if(!h.pushSet)throw d.create(f.TOKEN_SUBSCRIBE_NO_PUSH_SET);return[2,{token:h.token,pushSet:h.pushSet}]}})})},t.prototype.updateToken=function(t,n,e,r,i){return Object(u.__awaiter)(this,void 0,void 0,function(){var s,o,c,a,h,w,m,y;return Object(u.__generator)(this,function(u){switch(u.label){case 0:s=b(r.getKey("p256dh")),o=b(r.getKey("auth")),c="push_set="+e+"&token="+n+"&authorized_entity="+t+"&endpoint="+r.endpoint+"&encryption_key="+s+"&encryption_auth="+o,p(i.buffer,l.buffer)||(a=b(i),c+="&application_pub_key="+a),(h=new Headers).append("Content-Type","application/x-www-form-urlencoded"),w={method:"POST",headers:h,body:c},u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch(v+"/fcm/connect/subscribe",w)];case 2:return[4,u.sent().json()];case 3:return m=u.sent(),[3,5];case 4:throw u.sent(),d.create(f.TOKEN_UPDATE_FAILED);case 5:if(m.error)throw y=m.error.message,d.create(f.TOKEN_UPDATE_FAILED,{message:y});if(!m.token)throw d.create(f.TOKEN_UPDATE_NO_TOKEN);return[2,m.token]}})})},t.prototype.deleteToken=function(t,n,e){return Object(u.__awaiter)(this,void 0,void 0,function(){var r,i,s,o,c;return Object(u.__generator)(this,function(u){switch(u.label){case 0:r="authorized_entity="+t+"&token="+n+"&pushSet="+e,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),s={method:"POST",headers:i,body:r},u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch(v+"/fcm/connect/unsubscribe",s)];case 2:return[4,u.sent().json()];case 3:if((o=u.sent()).error)throw c=o.error.message,d.create(f.TOKEN_UNSUBSCRIBE_FAILED,{message:c});return[3,5];case 4:throw u.sent(),d.create(f.TOKEN_UNSUBSCRIBE_FAILED);case 5:return[2]}})})},t}();function m(t){for(var n=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),e=atob(n),r=new Uint8Array(e.length),i=0;i<e.length;++i)r[i]=e.charCodeAt(i);return r}var y="undefined",_="fcm_token_object_Store";function k(){var t=indexedDB.open(y);t.onerror=function(t){},t.onsuccess=function(n){!function(t){if(t.objectStoreNames.contains(_)){var n=t.transaction(_).objectStore(_),e=new w,r=n.openCursor();r.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},r.onsuccess=function(){var n=r.result;if(n){var i=n.value;e.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),n.continue()}else t.close(),indexedDB.deleteDatabase(y)}}}(t.result)}}var g=function(){function t(){this.dbPromise=null}return t.prototype.get=function(t){return this.createTransaction(function(n){return n.get(t)})},t.prototype.getIndex=function(t,n){return this.createTransaction(function(e){return e.index(t).get(n)})},t.prototype.put=function(t){return this.createTransaction(function(n){return n.put(t)},"readwrite")},t.prototype.delete=function(t){return this.createTransaction(function(n){return n.delete(t)},"readwrite")},t.prototype.closeDatabase=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(t,n){return void 0===n&&(n="readonly"),Object(u.__awaiter)(this,void 0,void 0,function(){var e,r,i,s;return Object(u.__generator)(this,function(o){switch(o.label){case 0:return[4,this.getDb()];case 1:return e=o.sent(),r=e.transaction(this.objectStoreName,n),i=r.objectStore(this.objectStoreName),[4,function(t){return new Promise(function(n,e){t.onsuccess=function(){n(t.result)},t.onerror=function(){e(t.error)}})}(t(i))];case 2:return s=o.sent(),[2,new Promise(function(t,n){r.oncomplete=function(){t(s)},r.onerror=function(){n(r.error)}})]}})})},t.prototype.getDb=function(){var t=this;return this.dbPromise||(this.dbPromise=new Promise(function(n,e){var r=indexedDB.open(t.dbName,t.dbVersion);r.onsuccess=function(){n(r.result)},r.onerror=function(){t.dbPromise=null,e(r.error)},r.onupgradeneeded=function(n){return t.onDbUpgrade(r,n)}})),this.dbPromise},t}();var O=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.dbName="fcm_token_details_db",n.dbVersion=3,n.objectStoreName="fcm_token_object_Store",n}return Object(u.__extends)(n,t),n.prototype.onDbUpgrade=function(t,n){var e=t.result;switch(n.oldVersion){case 0:(r=e.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:k();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var n=t.value,e=Object(u.__assign)({},n);n.createTime||(e.createTime=Date.now()),"string"==typeof n.vapidKey&&(e.vapidKey=m(n.vapidKey)),"string"==typeof n.auth&&(e.auth=m(n.auth).buffer),"string"==typeof n.auth&&(e.p256dh=m(n.p256dh).buffer),t.update(e),t.continue()}}}},n.prototype.getTokenDetailsFromToken=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(n){if(!t)throw d.create(f.BAD_TOKEN);return j({fcmToken:t}),[2,this.getIndex("fcmToken",t)]})})},n.prototype.getTokenDetailsFromSWScope=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(n){if(!t)throw d.create(f.BAD_SCOPE);return j({swScope:t}),[2,this.get(t)]})})},n.prototype.saveTokenDetails=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(n){if(!t.swScope)throw d.create(f.BAD_SCOPE);if(!t.vapidKey)throw d.create(f.BAD_VAPID_KEY);if(!t.endpoint||!t.auth||!t.p256dh)throw d.create(f.BAD_SUBSCRIPTION);if(!t.fcmSenderId)throw d.create(f.BAD_SENDER_ID);if(!t.fcmToken)throw d.create(f.BAD_TOKEN);if(!t.fcmPushSet)throw d.create(f.BAD_PUSH_SET);return j(t),[2,this.put(t)]})})},n.prototype.deleteToken=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n;return Object(u.__generator)(this,function(e){switch(e.label){case 0:return"string"!=typeof t||0===t.length?[2,Promise.reject(d.create(f.INVALID_DELETE_TOKEN))]:[4,this.getTokenDetailsFromToken(t)];case 1:if(!(n=e.sent()))throw d.create(f.DELETE_TOKEN_NOT_FOUND);return[4,this.delete(n.swScope)];case 2:return e.sent(),[2,n]}})})},n}(g);function j(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw d.create(f.BAD_TOKEN);if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw d.create(f.BAD_SCOPE);if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw d.create(f.BAD_VAPID_KEY);if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw d.create(f.BAD_SUBSCRIPTION);if(t.auth&&!(t.auth instanceof ArrayBuffer))throw d.create(f.BAD_SUBSCRIPTION);if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw d.create(f.BAD_SUBSCRIPTION);if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw d.create(f.BAD_SENDER_ID);if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw d.create(f.BAD_PUSH_SET)}var x=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.dbName="fcm_vapid_details_db",n.dbVersion=1,n.objectStoreName="fcm_vapid_object_Store",n}return Object(u.__extends)(n,t),n.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},n.prototype.getVapidFromSWScope=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n;return Object(u.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof t||0===t.length)throw d.create(f.BAD_SCOPE);return[4,this.get(t)];case 1:return[2,(n=e.sent())?n.vapidKey:void 0]}})})},n.prototype.saveVapidDetails=function(t,n){return Object(u.__awaiter)(this,void 0,void 0,function(){var e;return Object(u.__generator)(this,function(r){if("string"!=typeof t||0===t.length)throw d.create(f.BAD_SCOPE);if(null===n||65!==n.length)throw d.create(f.BAD_VAPID_KEY);return e={swScope:t,vapidKey:n},[2,this.put(e)]})})},n.prototype.deleteVapidDetails=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n;return Object(u.__generator)(this,function(e){switch(e.label){case 0:return[4,this.getVapidFromSWScope(t)];case 1:if(!(n=e.sent()))throw d.create(f.DELETE_SCOPE_NOT_FOUND);return[4,this.delete(t)];case 2:return e.sent(),[2,n]}})})},n}(g),S="messagingSenderId",E=function(){function t(t){var n=this;if(!t.options[S]||"string"!=typeof t.options[S])throw d.create(f.BAD_SENDER_ID);this.messagingSenderId=t.options[S],this.tokenDetailsModel=new O,this.vapidDetailsModel=new x,this.iidModel=new w,this.app=t,this.INTERNAL={delete:function(){return n.delete()}}}return t.prototype.getToken=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){var t,n,e,r,i;return Object(u.__generator)(this,function(s){switch(s.label){case 0:if("denied"===(t=this.getNotificationPermission_()))throw d.create(f.NOTIFICATIONS_BLOCKED);return"granted"!==t?[2,null]:[4,this.getSWRegistration_()];case 1:return n=s.sent(),[4,this.getPublicVapidKey_()];case 2:return e=s.sent(),[4,this.getPushSubscription(n,e)];case 3:return r=s.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(i=s.sent())?[2,this.manageExistingToken(n,r,e,i)]:[2,this.getNewToken(n,r,e)]}})})},t.prototype.manageExistingToken=function(t,n,e,r){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(i){switch(i.label){case 0:return function(t,n,e){if(!e.vapidKey||!p(n.buffer,e.vapidKey.buffer))return!1;var r=t.endpoint===e.endpoint,i=p(t.getKey("auth"),e.auth),s=p(t.getKey("p256dh"),e.p256dh);return r&&i&&s}(n,e,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(t,n,e,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(t,n,e)]}})})},t.prototype.updateToken=function(t,n,e,r){return Object(u.__awaiter)(this,void 0,void 0,function(){var i,s,o;return Object(u.__generator)(this,function(u){switch(u.label){case 0:return u.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,r.fcmToken,r.fcmPushSet,n,e)];case 1:return i=u.sent(),s={swScope:t.scope,vapidKey:e,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:r.fcmPushSet,createTime:Date.now(),endpoint:n.endpoint,auth:n.getKey("auth"),p256dh:n.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(s)];case 2:return u.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,e)];case 3:return u.sent(),[2,i];case 4:return o=u.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw u.sent(),o;case 6:return[2]}})})},t.prototype.getNewToken=function(t,n,e){return Object(u.__awaiter)(this,void 0,void 0,function(){var r,i;return Object(u.__generator)(this,function(s){switch(s.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,n,e)];case 1:return r=s.sent(),i={swScope:t.scope,vapidKey:e,fcmSenderId:this.messagingSenderId,fcmToken:r.token,fcmPushSet:r.pushSet,createTime:Date.now(),endpoint:n.endpoint,auth:n.getKey("auth"),p256dh:n.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return s.sent(),[4,this.vapidDetailsModel.saveVapidDetails(t.scope,e)];case 3:return s.sent(),[2,r.token]}})})},t.prototype.deleteToken=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n,e;return Object(u.__generator)(this,function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(t)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(n=r.sent())?[4,n.pushManager.getSubscription()]:[3,4];case 3:if(e=r.sent())return[2,e.unsubscribe()];r.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n;return Object(u.__generator)(this,function(e){switch(e.label){case 0:return[4,this.tokenDetailsModel.deleteToken(t)];case 1:return n=e.sent(),[4,this.iidModel.deleteToken(n.fcmSenderId,n.fcmToken,n.fcmPushSet)];case 2:return e.sent(),[2]}})})},t.prototype.getPushSubscription=function(t,n){return t.pushManager.getSubscription().then(function(e){return e||t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},t.prototype.requestPermission=function(){throw d.create(f.AVAILABLE_IN_WINDOW)},t.prototype.useServiceWorker=function(t){throw d.create(f.AVAILABLE_IN_WINDOW)},t.prototype.usePublicVapidKey=function(t){throw d.create(f.AVAILABLE_IN_WINDOW)},t.prototype.onMessage=function(t,n,e){throw d.create(f.AVAILABLE_IN_WINDOW)},t.prototype.onTokenRefresh=function(t,n,e){throw d.create(f.AVAILABLE_IN_WINDOW)},t.prototype.setBackgroundMessageHandler=function(t){throw d.create(f.AVAILABLE_IN_SW)},t.prototype.delete=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission_=function(){return Notification.permission},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getIidModel=function(){return this.iidModel},t}();var A=function(t){function n(n){var e=t.call(this,n)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}return Object(u.__extends)(n,t),n.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},n.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},n.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},n.prototype.onPush_=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n,e,r,i,s,o;return Object(u.__generator)(this,function(u){switch(u.label){case 0:if(!t.data)return[2];try{n=t.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return u.sent()?[2,this.sendMessageToWindowClients_(n)]:(e=this.getNotificationData_(n))?(r=e.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=u.sent(),s=e.actions,o=Notification.maxActions,s&&o&&s.length>o&&console.warn("This browser only supports "+o+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,e)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(n)]:[3,5];case 4:return u.sent(),[2];case 5:return[2]}})})},n.prototype.onSubChange_=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var t,n,e,r;return Object(u.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return t=i.sent(),[3,3];case 2:throw n=i.sent(),d.create(f.UNABLE_TO_RESUBSCRIBE,{message:n});case 3:return i.trys.push([3,5,,8]),[4,t.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return e=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(t.scope)];case 6:if(!(r=i.sent()))throw e;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),e;case 8:return[2]}})})},n.prototype.onNotificationClick_=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n,e,r,i;return Object(u.__generator)(this,function(o){switch(o.label){case 0:return t.notification&&t.notification.data&&t.notification.data.FCM_MSG?t.action?[2]:(t.stopImmediatePropagation(),t.notification.close(),(n=t.notification.data.FCM_MSG).notification&&(e=n.fcmOptions&&n.fcmOptions.link||n.notification.click_action)?[4,this.getWindowClient_(e)]:[2]):[2];case 1:return(r=o.sent())?[3,3]:[4,self.clients.openWindow(e)];case 2:return r=o.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=o.sent(),o.label=5;case 5:return r?(delete n.notification,delete n.fcmOptions,i=P(s.NOTIFICATION_CLICKED,n),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},n.prototype.getNotificationData_=function(t){if(t&&"object"==typeof t.notification){var n,e=Object(u.__assign)({},t.notification);return e.data=Object(u.__assign)({},t.notification.data,((n={}).FCM_MSG=t,n)),e}},n.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw d.create(f.BG_HANDLER_FUNCTION_EXPECTED);this.bgMessageHandler=t},n.prototype.getWindowClient_=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n,e,r,i;return Object(u.__generator)(this,function(s){switch(s.label){case 0:return n=new URL(t,self.location.href).href,[4,T()];case 1:for(e=s.sent(),r=null,i=0;i<e.length;i++)if(new URL(e[i].url,self.location.href).href===n){r=e[i];break}return[2,r]}})})},n.prototype.attemptToMessageClient_=function(t,n){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(e){if(!t)throw d.create(f.NO_WINDOW_CLIENT_TO_MSG);return t.postMessage(n),[2]})})},n.prototype.hasVisibleClients_=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(t){switch(t.label){case 0:return[4,T()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState})]}})})},n.prototype.sendMessageToWindowClients_=function(t){return Object(u.__awaiter)(this,void 0,void 0,function(){var n,e,r=this;return Object(u.__generator)(this,function(i){switch(i.label){case 0:return[4,T()];case 1:return n=i.sent(),e=P(s.PUSH_MSG_RECEIVED,t),[4,Promise.all(n.map(function(t){return r.attemptToMessageClient_(t,e)}))];case 2:return i.sent(),[2]}})})},n.prototype.getSWRegistration_=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(t){return[2,self.registration]})})},n.prototype.getPublicVapidKey_=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(u.__generator)(this,function(e){switch(e.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(t=e.sent()))throw d.create(f.SW_REGISTRATION_EXPECTED);return[4,this.getVapidDetailsModel().getVapidFromSWScope(t.scope)];case 2:return null==(n=e.sent())?[2,l]:[2,n]}})})},n}(E);function T(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function P(t,n){return(e={})[i.TYPE_OF_MSG]=t,e[i.DATA]=n,e;var e}var N=function(t){function n(n){var e=t.call(this,n)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.manifestCheckPromise=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Object(o.createSubscribe)(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Object(o.createSubscribe)(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}return Object(u.__extends)(n,t),n.prototype.getToken=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(n){switch(n.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(u.__generator)(this,function(e){switch(e.label){case 0:if(!(t=document.querySelector('link[rel="manifest"]')))return[2];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,fetch(t.href)];case 2:return[4,e.sent().json()];case 3:return n=e.sent(),[3,5];case 4:return e.sent(),[2];case 5:if(!n||!n.gcm_sender_id)return[2];if("103953800507"!==n.gcm_sender_id)throw d.create(f.INCORRECT_GCM_SENDER_ID);return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return n.sent(),[2,t.prototype.getToken.call(this)]}})})},n.prototype.requestPermission=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){var t;return Object(u.__generator)(this,function(n){switch(n.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(t=n.sent()))return[2];throw"denied"===t?d.create(f.PERMISSION_BLOCKED):d.create(f.PERMISSION_DEFAULT)}})})},n.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw d.create(f.SW_REGISTRATION_EXPECTED);if(null!=this.registrationToUse)throw d.create(f.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse=t},n.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw d.create(f.INVALID_PUBLIC_VAPID_KEY);if(null!=this.publicVapidKeyToUse)throw d.create(f.USE_PUBLIC_KEY_BEFORE_GET_TOKEN);var n=m(t);if(65!==n.length)throw d.create(f.PUBLIC_KEY_DECRYPTION_FAILED);this.publicVapidKeyToUse=n},n.prototype.onMessage=function(t,n,e){return"function"==typeof t?this.onMessageInternal(t,n,e):this.onMessageInternal(t)},n.prototype.onTokenRefresh=function(t,n,e){return"function"==typeof t?this.onTokenRefreshInternal(t,n,e):this.onTokenRefreshInternal(t)},n.prototype.waitForRegistrationToActivate_=function(t){var n=t.installing||t.waiting||t.active;return new Promise(function(e,r){if(n)if("activated"!==n.state)if("redundant"!==n.state){var i=function(){if("activated"===n.state)e(t);else{if("redundant"!==n.state)return;r(d.create(f.SW_REG_REDUNDANT))}n.removeEventListener("statechange",i)};n.addEventListener("statechange",i)}else r(d.create(f.SW_REG_REDUNDANT));else e(t);else r(d.create(f.NO_SW_IN_REG))})},n.prototype.getSWRegistration_=function(){var t=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw d.create(f.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:t.message})}).then(function(n){return t.waitForRegistrationToActivate_(n).then(function(){return t.registrationToUse=n,n.update(),n})}))},n.prototype.getPublicVapidKey_=function(){return Object(u.__awaiter)(this,void 0,void 0,function(){return Object(u.__generator)(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,l]})})},n.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(n){if(n.data&&n.data[i.TYPE_OF_MSG]){var e=n.data;switch(e[i.TYPE_OF_MSG]){case s.PUSH_MSG_RECEIVED:case s.NOTIFICATION_CLICKED:var r=e[i.DATA];t.messageObserver&&t.messageObserver.next(r)}}},!1)},n}(E);function M(t){var n={isSupported:I};t.INTERNAL.registerService("messaging",function(t){if(!I())throw d.create(f.UNSUPPORTED_BROWSER);return self&&"ServiceWorkerGlobalScope"in self?new A(t):new N(t)},n)}function I(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}M(a.a)},"./node_modules/@firebase/util/dist/index.cjs.js":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./node_modules/tslib/tslib.es6.js"),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},s=function(t,n){if(!t)throw o(n)},o=function(t){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},u=function(t){for(var n=[],e=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?n[e++]=i:i<2048?(n[e++]=i>>6|192,n[e++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),n[e++]=i>>18|240,n[e++]=i>>12&63|128,n[e++]=i>>6&63|128,n[e++]=63&i|128):(n[e++]=i>>12|224,n[e++]=i>>6&63|128,n[e++]=63&i|128)}return n},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,n){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var e=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var s=t[i],o=i+1<t.length,u=o?t[i+1]:0,c=i+2<t.length,a=c?t[i+2]:0,f=s>>2,h=(3&s)<<4|u>>4,d=(15&u)<<2|a>>6,l=63&a;c||(l=64,o||(d=64)),r.push(e[f],e[h],e[d],e[l])}return r.join("")},encodeString:function(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(u(t),n)},decodeString:function(t,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(t):function(t){for(var n=[],e=0,r=0;e<t.length;){var i=t[e++];if(i<128)n[r++]=String.fromCharCode(i);else if(i>191&&i<224){var s=t[e++];n[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){var o=((7&i)<<18|(63&(s=t[e++]))<<12|(63&(u=t[e++]))<<6|63&t[e++])-65536;n[r++]=String.fromCharCode(55296+(o>>10)),n[r++]=String.fromCharCode(56320+(1023&o))}else{s=t[e++];var u=t[e++];n[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&u)}}return n.join("")}(this.decodeStringToByteArray(t,n))},decodeStringToByteArray:function(t,n){this.init_();for(var e=n?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var s=e[t.charAt(i++)],o=i<t.length?e[t.charAt(i)]:0,u=++i<t.length?e[t.charAt(i)]:64,c=++i<t.length?e[t.charAt(i)]:64;if(++i,null==s||null==o||null==u||null==c)throw Error();var a=s<<2|o>>4;if(r.push(a),64!=u){var f=o<<4&240|u>>2;if(r.push(f),64!=c){var h=u<<6&192|c;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},a=function(t){try{return c.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function f(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(var e in n)n.hasOwnProperty(e)&&(t[e]=f(t[e],n[e]));return t}var h=function(){function t(){var t=this;this.promise=new Promise(function(n,e){t.resolve=n,t.reject=e})}return t.prototype.wrapCallback=function(t){var n=this;return function(e,r){e?n.reject(e):n.resolve(r),"function"==typeof t&&(n.promise.catch(function(){}),1===t.length?t(e):t(e,r))}},t}(),d=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""},l="FirebaseError",v=Error.captureStackTrace;var p=function(){return function(t,n){if(this.code=t,this.message=n,v)v(this,b.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=l,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}}}();p.prototype=Object.create(Error.prototype),p.prototype.constructor=p,p.prototype.name=l;var b=function(){function t(t,n,e){this.service=t,this.serviceName=n,this.errors=e,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,n){void 0===n&&(n={});var e,r=this.errors[t],i=this.service+"/"+t;e=void 0===r?"Error":r.replace(this.pattern,function(t,e){var r=n[e];return void 0!==r?r.toString():"<"+e+"?>"}),e=this.serviceName+": "+e+" ("+i+").";var s=new p(i,e);for(var o in n)n.hasOwnProperty(o)&&"_"!==o.slice(-1)&&(s[o]=n[o]);return s},t}();function w(t){return JSON.parse(t)}var m=function(t){var n={},e={},r={},i="";try{var s=t.split(".");n=w(a(s[0])||""),e=w(a(s[1])||""),i=s[2],r=e.d||{},delete e.d}catch(t){}return{header:n,claims:e,data:r,signature:i}},y=function(t,n){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&n(e,t[e])},_=function(t,n){return y(n,function(n,e){t[n]=e}),t},k=function(t,n,e){for(var r in t)if(n.call(e,t[r],r,t))return r},g=function(t){function n(){var n=t.call(this)||this;n.chain_=[],n.buf_=[],n.W_=[],n.pad_=[],n.inbuf_=0,n.total_=0,n.blockSize=64,n.pad_[0]=128;for(var e=1;e<n.blockSize;++e)n.pad_[e]=0;return n.reset(),n}return r.__extends(n,t),n.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},n.prototype.compress_=function(t,n){n||(n=0);var e=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)e[r]=t.charCodeAt(n)<<24|t.charCodeAt(n+1)<<16|t.charCodeAt(n+2)<<8|t.charCodeAt(n+3),n+=4;else for(r=0;r<16;r++)e[r]=t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3],n+=4;for(r=16;r<80;r++){var i=e[r-3]^e[r-8]^e[r-14]^e[r-16];e[r]=4294967295&(i<<1|i>>>31)}var s,o,u=this.chain_[0],c=this.chain_[1],a=this.chain_[2],f=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(s=f^c&(a^f),o=1518500249):(s=c^a^f,o=1859775393):r<60?(s=c&a|f&(c|a),o=2400959708):(s=c^a^f,o=3395469782);i=(u<<5|u>>>27)+s+h+o+e[r]&4294967295;h=f,f=a,a=4294967295&(c<<30|c>>>2),c=u,u=i}this.chain_[0]=this.chain_[0]+u&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+f&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},n.prototype.update=function(t,n){if(null!=t){void 0===n&&(n=t.length);for(var e=n-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;r<n;){if(0==s)for(;r<=e;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<n;)if(i[s]=t.charCodeAt(r),++r,++s==this.blockSize){this.compress_(i),s=0;break}}else for(;r<n;)if(i[s]=t[r],++r,++s==this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=n}},n.prototype.digest=function(){var t=[],n=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&n,n/=256;this.compress_(this.buf_);var r=0;for(e=0;e<5;e++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[e]>>i&255,++r;return t},n}(function(){return function(){this.blockSize=-1}}());var O=function(){function t(t,n){var e=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(function(){t(e)}).catch(function(t){e.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(n){n.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(n){n.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,n,e){var r,i=this;if(void 0===t&&void 0===n&&void 0===e)throw new Error("Missing Observer.");void 0===(r=function(t,n){if("object"!=typeof t||null===t)return!1;for(var e=0,r=n;e<r.length;e++){var i=r[e];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:n,complete:e}).next&&(r.next=j),void 0===r.error&&(r.error=j),void 0===r.complete&&(r.complete=j);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),s},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var n=0;n<this.observers.length;n++)this.sendOne(n,t)},t.prototype.sendOne=function(t,n){var e=this;this.task.then(function(){if(void 0!==e.observers&&void 0!==e.observers[t])try{n(e.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var n=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){n.observers=void 0,n.onNoObservers=void 0}))},t}();function j(){}function x(t,n,e){var r="";switch(n){case 1:r=e?"first":"First";break;case 2:r=e?"second":"Second";break;case 3:r=e?"third":"Third";break;case 4:r=e?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}n.assert=s,n.assertionError=o,n.base64=c,n.base64Decode=a,n.base64Encode=function(t){var n=u(t);return c.encodeByteArray(n,!0)},n.CONSTANTS=i,n.deepCopy=function(t){return f(void 0,t)},n.deepExtend=f,n.patchProperty=function(t,n,e){t[n]=e},n.Deferred=h,n.getUA=d,n.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())},n.isNodeSdk=function(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN},n.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},n.ErrorFactory=b,n.FirebaseError=p,n.patchCapture=function(t){var n=v;return v=t,n},n.jsonEval=w,n.stringify=function(t){return JSON.stringify(t)},n.decode=m,n.isAdmin=function(t){var n=m(t).claims;return"object"==typeof n&&!0===n.admin},n.issuedAtTime=function(t){var n=m(t).claims;return"object"==typeof n&&n.hasOwnProperty("iat")?n.iat:null},n.isValidFormat=function(t){var n=m(t).claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")},n.isValidTimestamp=function(t){var n,e,r=m(t).claims,i=Math.floor((new Date).getTime()/1e3);return"object"==typeof r&&(r.hasOwnProperty("nbf")?n=r.nbf:r.hasOwnProperty("iat")&&(n=r.iat),e=r.hasOwnProperty("exp")?r.exp:n+86400),i&&n&&e&&i>=n&&i<=e},n.clone=function(t){return _({},t)},n.contains=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.every=function(t,n){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&!n(e,t[e]))return!1;return!0},n.extend=_,n.findKey=k,n.findValue=function(t,n,e){var r=k(t,n,e);return r&&t[r]},n.forEach=y,n.getAnyKey=function(t){for(var n in t)return n},n.getCount=function(t){var n=0;for(var e in t)n++;return n},n.getValues=function(t){var n=[],e=0;for(var r in t)n[e++]=t[r];return n},n.isEmpty=function(t){for(var n in t)return!1;return!0},n.isNonNullObject=function(t){return"object"==typeof t&&null!==t},n.map=function(t,n,e){var r={};for(var i in t)r[i]=n.call(e,t[i],i,t);return r},n.safeGet=function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]},n.querystring=function(t){var n=[];return y(t,function(t,e){Array.isArray(e)?e.forEach(function(e){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}),n.length?"&"+n.join("&"):""},n.querystringDecode=function(t){var n={};return t.replace(/^\?/,"").split("&").forEach(function(t){if(t){var e=t.split("=");n[e[0]]=e[1]}}),n},n.Sha1=g,n.async=function(t,n){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];Promise.resolve(!0).then(function(){t.apply(void 0,e)}).catch(function(t){n&&n(t)})}},n.createSubscribe=function(t,n){var e=new O(t,n);return e.subscribe.bind(e)},n.errorPrefix=x,n.validateArgCount=function(t,n,e,r){var i;if(r<n?i="at least "+n:r>e&&(i=0===e?"none":"no more than "+e),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},n.validateCallback=function(t,n,e,r){if((!r||e)&&"function"!=typeof e)throw new Error(x(t,n,r)+"must be a valid function.")},n.validateContextObject=function(t,n,e,r){if((!r||e)&&("object"!=typeof e||null===e))throw new Error(x(t,n,r)+"must be a valid context object.")},n.validateNamespace=function(t,n,e,r){if((!r||e)&&"string"!=typeof e)throw new Error(x(t,n,r)+"must be a valid firebase namespace.")},n.stringLength=function(t){for(var n=0,e=0;e<t.length;e++){var r=t.charCodeAt(e);r<128?n++:r<2048?n+=2:r>=55296&&r<=56319?(n+=4,e++):n+=3}return n},n.stringToByteArray=function(t){for(var n=[],e=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var o=i-55296;s(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?n[e++]=i:i<2048?(n[e++]=i>>6|192,n[e++]=63&i|128):i<65536?(n[e++]=i>>12|224,n[e++]=i>>6&63|128,n[e++]=63&i|128):(n[e++]=i>>18|240,n[e++]=i>>12&63|128,n[e++]=i>>6&63|128,n[e++]=63&i|128)}return n}},"./node_modules/bowser/es5.js":function(t,n,e){t.exports=function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=70)}({18:function(t,n,e){var r,i;void 0===(i="function"==typeof(r=function(t){"use strict";var n=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),e=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t)}return n(t,null,[{key:"getFirstMatch",value:function(t,n){var e=n.match(t);return e&&e.length>0&&e[1]||""}},{key:"getSecondMatch",value:function(t,n){var e=n.match(t);return e&&e.length>1&&e[2]||""}},{key:"matchAndReturnConst",value:function(t,n,e){if(t.test(n))return e}},{key:"getWindowsVersionName",value:function(t){switch(t){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}},{key:"getVersionPrecision",value:function(t){return t.split(".").length}},{key:"compareVersions",value:function(n,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.getVersionPrecision(n),s=t.getVersionPrecision(e),o=Math.max(i,s),u=0,c=t.map([n,e],function(n){var e=o-t.getVersionPrecision(n),r=n+new Array(e+1).join(".0");return t.map(r.split("."),function(t){return new Array(20-t.length).join("0")+t}).reverse()});for(r&&(u=o-Math.min(i,s)),o-=1;o>=u;){if(c[0][o]>c[1][o])return 1;if(c[0][o]===c[1][o]){if(o===u)return 0;o-=1}else if(c[0][o]<c[1][o])return-1}}},{key:"map",value:function(t,n){var e=[],r=void 0;if(Array.prototype.map)return Array.prototype.map.call(t,n);for(r=0;r<t.length;r+=1)e.push(n(t[r]));return e}}]),t}();t.exports=e})?r.apply(n,[t]):r)||(t.exports=i)},65:function(t,n,e){var r,i,s;i=[n,e(18)],void 0===(s="function"==typeof(r=function(n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=[{test:function(t){return"microsoft edge"===t.getBrowserName(!0)},describe:function(t){var n=(0,e.getFirstMatch)(/edge\/(\d+(\.?_?\d+)+)/i,t);return{name:"EdgeHTML",version:n}}},{test:[/trident/i],describe:function(t){var n={name:"Trident"},r=(0,e.getFirstMatch)(/trident\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:function(t){return t.test(/presto/i)},describe:function(t){var n={name:"Presto"},r=(0,e.getFirstMatch)(/presto\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:function(t){var n=t.test(/gecko/i),e=t.test(/like gecko/i);return n&&!e},describe:function(t){var n={name:"Gecko"},r=(0,e.getFirstMatch)(/gecko\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:"Blink"}}},{test:[/(apple)?webkit/i],describe:function(t){var n={name:"WebKit"},r=(0,e.getFirstMatch)(/webkit\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}}],t.exports=n.default})?r.apply(n,i):r)||(t.exports=s)},66:function(t,n,e){var r,i,s;i=[n,e(18)],void 0===(s="function"==typeof(r=function(n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={tablet:"tablet",mobile:"mobile",desktop:"desktop"};n.default=[{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:r.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:r.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:r.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:r.tablet,vendor:"Amazon"}}},{test:[/tablet/i],describe:function(){return{type:r.tablet}}},{test:function(t){var n=t.test(/ipod|iphone/i),e=t.test(/like (ipod|iphone)/i);return n&&!e},describe:function(t){var n=(0,e.getFirstMatch)(/(ipod|iphone)/i,t);return{type:r.mobile,vendor:"Apple",model:n}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:r.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:r.mobile}}},{test:function(t){return"blackberry"===t.getBrowserName(!0)},describe:function(){return{type:r.mobile,vendor:"BlackBerry"}}},{test:function(t){return"bada"===t.getBrowserName(!0)},describe:function(){return{type:r.mobile}}},{test:function(t){return"windows phone"===t.getBrowserName()},describe:function(){return{type:r.mobile,vendor:"Microsoft"}}},{test:function(t){var n=Number(String(t.getOSVersion()).split(".")[0]);return"android"===t.getOSName(!0)&&n>=3},describe:function(){return{type:r.tablet}}},{test:function(t){return"android"===t.getOSName(!0)},describe:function(){return{type:r.mobile}}},{test:function(t){return"macos"===t.getOSName(!0)},describe:function(){return{type:r.desktop,vendor:"Apple"}}},{test:function(t){return"windows"===t.getOSName(!0)},describe:function(){return{type:r.desktop}}},{test:function(t){return"linux"===t.getOSName(!0)},describe:function(){return{type:r.desktop}}}],t.exports=n.default})?r.apply(n,i):r)||(t.exports=s)},67:function(t,n,e){var r,i,s;i=[n,e(18)],void 0===(s="function"==typeof(r=function(n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=[{test:[/windows phone/i],describe:function(t){var n=(0,e.getFirstMatch)(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,t);return{name:"Windows Phone",version:n}}},{test:[/windows/i],describe:function(t){var n=(0,e.getFirstMatch)(/Windows ((NT|XP)( \d\d?.\d)?)/i,t),r=(0,e.getWindowsVersionName)(n);return{name:"Windows",version:n,versionName:r}}},{test:[/macintosh/i],describe:function(t){var n=(0,e.getFirstMatch)(/mac os x (\d+(\.?_?\d+)+)/i,t).replace(/[_\s]/g,".");return{name:"macOS",version:n}}},{test:[/(ipod|iphone|ipad)/i],describe:function(t){var n=(0,e.getFirstMatch)(/os (\d+([_\s]\d+)*) like mac os x/i,t).replace(/[_\s]/g,".");return{name:"iOS",version:n}}},{test:function(t){var n=!t.test(/like android/i),e=t.test(/android/i);return n&&e},describe:function(t){var n=(0,e.getFirstMatch)(/android[\s/-](\d+(\.\d+)*)/i,t);return{name:"Android",version:n}}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var n=(0,e.getFirstMatch)(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,t),r={name:"WebOS"};return n&&n.length&&(r.version=n),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var n=(0,e.getFirstMatch)(/rim\stablet\sos\s(\d+(\.\d+)*)/i,t)||(0,e.getFirstMatch)(/blackberry\d+\/(\d+([_\s]\d+)*)/i,t)||(0,e.getFirstMatch)(/\bbb(\d+)/i,t);return{name:"BlackBerry",version:n}}},{test:[/bada/i],describe:function(t){var n=(0,e.getFirstMatch)(/bada\/(\d+(\.\d+)*)/i,t);return{name:"Bada",version:n}}},{test:[/tizen/i],describe:function(t){var n=(0,e.getFirstMatch)(/tizen[/\s](\d+(\.\d+)*)/i,t);return{name:"Tizen",version:n}}},{test:[/linux/i],describe:function(){return{name:"Linux"}}}],t.exports=n.default})?r.apply(n,i):r)||(t.exports=s)},68:function(t,n,e){var r,i,s;i=[n,e(18)],void 0===(s="function"==typeof(r=function(n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=/version\/(\d+(\.?_?\d+)+)/i,i=[{test:[/opera/i],describe:function(t){var n={name:"Opera"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/opr\/|opios/i],describe:function(t){var n={name:"Opera"},i=(0,e.getFirstMatch)(/(?:opr|opios)[\s/](\S+)/i,t)||(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/SamsungBrowser/i],describe:function(t){var n={name:"Samsung Internet for Android"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/Whale/i],describe:function(t){var n={name:"NAVER Whale Browser"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/MZBrowser/i],describe:function(t){var n={name:"MZ Browser"},i=(0,e.getFirstMatch)(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,t)||(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/focus/i],describe:function(t){var n={name:"Focus"},i=(0,e.getFirstMatch)(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,t)||(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/swing/i],describe:function(t){var n={name:"Swing"},i=(0,e.getFirstMatch)(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,t)||(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/coast/i],describe:function(t){var n={name:"Opera Coast"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/yabrowser/i],describe:function(t){var n={name:"Yandex Browser"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/ucbrowser/i],describe:function(t){var n={name:"UC Browser"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/Maxthon|mxios/i],describe:function(t){var n={name:"Maxthon"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/epiphany/i],describe:function(t){var n={name:"Epiphany"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/puffin/i],describe:function(t){var n={name:"Puffin"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/sleipnir/i],describe:function(t){var n={name:"Sleipnir"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/k-meleon/i],describe:function(t){var n={name:"K-Meleon"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/msie|trident/i],describe:function(t){var n={name:"Internet Explorer"},r=(0,e.getFirstMatch)(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/edg([ea]|ios)/i],describe:function(t){var n={name:"Microsoft Edge"},r=(0,e.getSecondMatch)(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/vivaldi/i],describe:function(t){var n={name:"Vivaldi"},r=(0,e.getFirstMatch)(/vivaldi\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/seamonkey/i],describe:function(t){var n={name:"SeaMonkey"},r=(0,e.getFirstMatch)(/seamonkey\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/sailfish/i],describe:function(t){var n={name:"Sailfish"},r=(0,e.getFirstMatch)(/sailfish\s?browser\/(\d+(\.\d+)?)/i,t);return r&&(n.version=r),n}},{test:[/silk/i],describe:function(t){var n={name:"Amazon Silk"},r=(0,e.getFirstMatch)(/silk\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/phantom/i],describe:function(t){var n={name:"PhantomJS"},r=(0,e.getFirstMatch)(/phantomjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/slimerjs/i],describe:function(t){var n={name:"SlimerJS"},r=(0,e.getFirstMatch)(/slimerjs\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(t){var n={name:"BlackBerry"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/(web|hpw)[o0]s/i],describe:function(t){var n={name:"WebOS Browser"},i=(0,e.getFirstMatch)(r,t)||(0,e.getFirstMatch)(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,t);return i&&(n.version=i),n}},{test:[/bada/i],describe:function(t){var n={name:"Bada"},r=(0,e.getFirstMatch)(/dolfin\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/tizen/i],describe:function(t){var n={name:"Tizen"},i=(0,e.getFirstMatch)(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,t)||(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/qupzilla/i],describe:function(t){var n={name:"QupZilla"},i=(0,e.getFirstMatch)(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,t)||(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/firefox|iceweasel|fxios/i],describe:function(t){var n={name:"Firefox"},r=(0,e.getFirstMatch)(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:[/chromium/i],describe:function(t){var n={name:"Chromium"},i=(0,e.getFirstMatch)(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,t)||(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/chrome|crios|crmo/i],describe:function(t){var n={name:"Chrome"},r=(0,e.getFirstMatch)(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t);return r&&(n.version=r),n}},{test:function(t){var n=!t.test(/like android/i),e=t.test(/android/i);return n&&e},describe:function(t){var n={name:"Android Browser"},i=(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/safari|applewebkit/i],describe:function(t){var n={name:"Safari"},i=(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/googlebot/i],describe:function(t){var n={name:"Googlebot"},i=(0,e.getFirstMatch)(/googlebot\/(\d+(\.\d+))/i,t)||(0,e.getFirstMatch)(r,t);return i&&(n.version=i),n}},{test:[/.*/i],describe:function(t){return{name:(0,e.getFirstMatch)(/^(.*)\/(.*) /,t),version:(0,e.getSecondMatch)(/^(.*)\/(.*) /,t)}}}];n.default=i,t.exports=n.default})?r.apply(n,i):r)||(t.exports=s)},69:function(t,n,e){var r,i,s;i=[n,e(68),e(67),e(66),e(65),e(18)],void 0===(s="function"==typeof(r=function(n,e,r,i,s,o){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=h(e),c=h(r),a=h(i),f=h(s);function h(t){return t&&t.__esModule?t:{default:t}}var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),v=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===n||null===n||""===n)throw new Error("UserAgent parameter can't be empty");this._ua=n,this.parsedResult={},!0!==e&&this.parse()}return l(t,[{key:"getUA",value:function(){return this._ua}},{key:"test",value:function(t){return t.test(this._ua)}},{key:"parseBrowser",value:function(){var t=this;this.parsedResult.browser={};var n=u.default.find(function(n){if("function"==typeof n.test)return n.test(t);if(n.test instanceof Array)return n.test.some(function(n){return t.test(n)});throw new Error("Browser's test function is not valid")});return n&&(this.parsedResult.browser=n.describe(this.getUA())),this.parsedResult.browser}},{key:"getBrowser",value:function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}},{key:"getBrowserName",value:function(t){return t?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}},{key:"getBrowserVersion",value:function(){return this.getBrowser().version}},{key:"getOS",value:function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}},{key:"parseOS",value:function(){var t=this;this.parsedResult.os={};var n=c.default.find(function(n){if("function"==typeof n.test)return n.test(t);if(n.test instanceof Array)return n.test.some(function(n){return t.test(n)});throw new Error("Browser's test function is not valid")});return n&&(this.parsedResult.os=n.describe(this.getUA())),this.parsedResult.os}},{key:"getOSName",value:function(t){var n=this.getOS(),e=n.name;return t?String(e).toLowerCase()||"":e||""}},{key:"getOSVersion",value:function(){return this.getOS().version}},{key:"getPlatform",value:function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}},{key:"getPlatformType",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.getPlatform(),e=n.type;return t?String(e).toLowerCase()||"":e||""}},{key:"parsePlatform",value:function(){var t=this;this.parsedResult.platform={};var n=a.default.find(function(n){if("function"==typeof n.test)return n.test(t);if(n.test instanceof Array)return n.test.some(function(n){return t.test(n)});throw new Error("Browser's test function is not valid")});return n&&(this.parsedResult.platform=n.describe(this.getUA())),this.parsedResult.platform}},{key:"getEngine",value:function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}},{key:"parseEngine",value:function(){var t=this;this.parsedResult.engine={};var n=f.default.find(function(n){if("function"==typeof n.test)return n.test(t);if(n.test instanceof Array)return n.test.some(function(n){return t.test(n)});throw new Error("Browser's test function is not valid")});return n&&(this.parsedResult.engine=n.describe(this.getUA())),this.parsedResult.engine}},{key:"parse",value:function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}},{key:"getResult",value:function(){return this.parsedResult}},{key:"satisfies",value:function(t){var n=this,e={},r=0,i={},s=0,o=Object.keys(t);if(o.forEach(function(n){var o=t[n];"string"==typeof o?(i[n]=o,s+=1):"object"===(void 0===o?"undefined":d(o))&&(e[n]=o,r+=1)}),r>0){var u=Object.keys(e),c=u.find(function(t){return n.isOS(t)});if(c){var a=this.satisfies(e[c]);if(void 0!==a)return a}var f=u.find(function(t){return n.isPlatform(t)});if(f){var h=this.satisfies(e[f]);if(void 0!==h)return h}}if(s>0){var l=Object.keys(i),v=l.find(function(t){return n.isBrowser(t)});if(void 0!==v)return this.compareVersion(i[v])}}},{key:"isBrowser",value:function(t){return this.getBrowserName(!0)===String(t).toLowerCase()}},{key:"compareVersion",value:function(t){var n=0,e=t,r=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===t[0]?(n=1,e=t.substr(1)):"<"===t[0]?(n=-1,e=t.substr(1)):"="===t[0]?e=t.substr(1):"~"===t[0]&&(r=!0,e=t.substr(1)),(0,o.compareVersions)(i,e,r)===n}},{key:"isOS",value:function(t){return this.getOSName(!0)===String(t).toLowerCase()}},{key:"isPlatform",value:function(t){return this.getPlatformType(!0)===String(t).toLowerCase()}},{key:"is",value:function(t){return this.isBrowser(t)||this.isOS(t)||this.isPlatform(t)}},{key:"some",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n.some(function(n){return t.is(n)})}}]),t}();n.default=v,t.exports=n.default})?r.apply(n,i):r)||(t.exports=s)},70:function(t,n,e){var r,i,s;i=[n,e(69)],void 0===(s="function"==typeof(r=function(n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(e),i=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),s=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t)}return i(t,null,[{key:"getParser",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"!=typeof t)throw new Error("UserAgent should be a string");return new r.default(t,n)}},{key:"parse",value:function(t){return new r.default(t).getResult()}}]),t}();n.default=s,t.exports=n.default})?r.apply(n,i):r)||(t.exports=s)}})},"./node_modules/error-stack-parser/error-stack-parser.js":function(t,n,e){var r,i,s;!function(o,u){"use strict";i=[e("./node_modules/stackframe/stackframe.js")],void 0===(s="function"==typeof(r=function(t){var n=/(^|@)\S+\:\d+/,e=/^\s*at .*(\S+\:\d+|\(native\))/m,r=/^(eval@)?(\[native code\])?$/;return{parse:function(t){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return this.parseOpera(t);if(t.stack&&t.stack.match(e))return this.parseV8OrIE(t);if(t.stack)return this.parseFFOrSafari(t);throw new Error("Cannot parse given Error object")},extractLocation:function(t){if(-1===t.indexOf(":"))return[t];var n=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/.exec(t.replace(/[\(\)]/g,""));return[n[1],n[2]||void 0,n[3]||void 0]},parseV8OrIE:function(n){var r=n.stack.split("\n").filter(function(t){return!!t.match(e)},this);return r.map(function(n){n.indexOf("(eval ")>-1&&(n=n.replace(/eval code/g,"eval").replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,""));var e=n.replace(/^\s+/,"").replace(/\(eval code/g,"(").split(/\s+/).slice(1),r=this.extractLocation(e.pop()),i=e.join(" ")||void 0,s=["eval","<anonymous>"].indexOf(r[0])>-1?void 0:r[0];return new t({functionName:i,fileName:s,lineNumber:r[1],columnNumber:r[2],source:n})},this)},parseFFOrSafari:function(n){var e=n.stack.split("\n").filter(function(t){return!t.match(r)},this);return e.map(function(n){if(n.indexOf(" > eval")>-1&&(n=n.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,":$1")),-1===n.indexOf("@")&&-1===n.indexOf(":"))return new t({functionName:n});var e=/((.*".+"[^@]*)?[^@]*)(?:@)/,r=n.match(e),i=r&&r[1]?r[1]:void 0,s=this.extractLocation(n.replace(e,""));return new t({functionName:i,fileName:s[0],lineNumber:s[1],columnNumber:s[2],source:n})},this)},parseOpera:function(t){return!t.stacktrace||t.message.indexOf("\n")>-1&&t.message.split("\n").length>t.stacktrace.split("\n").length?this.parseOpera9(t):t.stack?this.parseOpera11(t):this.parseOpera10(t)},parseOpera9:function(n){for(var e=/Line (\d+).*script (?:in )?(\S+)/i,r=n.message.split("\n"),i=[],s=2,o=r.length;s<o;s+=2){var u=e.exec(r[s]);u&&i.push(new t({fileName:u[2],lineNumber:u[1],source:r[s]}))}return i},parseOpera10:function(n){for(var e=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=n.stacktrace.split("\n"),i=[],s=0,o=r.length;s<o;s+=2){var u=e.exec(r[s]);u&&i.push(new t({functionName:u[3]||void 0,fileName:u[2],lineNumber:u[1],source:r[s]}))}return i},parseOpera11:function(e){var r=e.stack.split("\n").filter(function(t){return!!t.match(n)&&!t.match(/^Error created at/)},this);return r.map(function(n){var e,r=n.split("@"),i=this.extractLocation(r.pop()),s=r.shift()||"",o=s.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;s.match(/\(([^\)]*)\)/)&&(e=s.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var u=void 0===e||"[arguments not available]"===e?void 0:e.split(",");return new t({functionName:o,args:u,fileName:i[0],lineNumber:i[1],columnNumber:i[2],source:n})},this)}}})?r.apply(n,i):r)||(t.exports=s)}()},"./node_modules/idb/build/idb.js":function(t,n,e){!function(t){"use strict";function n(t){return new Promise(function(n,e){t.onsuccess=function(){n(t.result)},t.onerror=function(){e(t.error)}})}function e(t,e,r){var i,s=new Promise(function(s,o){n(i=t[e].apply(t,r)).then(s,o)});return s.request=i,s}function r(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function i(t,n,r,i){i.forEach(function(i){i in r.prototype&&(t.prototype[i]=function(){return e(this[n],i,arguments)})})}function s(t,n,e,r){r.forEach(function(r){r in e.prototype&&(t.prototype[r]=function(){return this[n][r].apply(this[n],arguments)})})}function o(t,n,r,i){i.forEach(function(i){i in r.prototype&&(t.prototype[i]=function(){return function(t,n,r){var i=e(t,n,r);return i.then(function(t){if(t)return new c(t,i.request)})}(this[n],i,arguments)})})}function u(t){this._index=t}function c(t,n){this._cursor=t,this._request=n}function a(t){this._store=t}function f(t){this._tx=t,this.complete=new Promise(function(n,e){t.oncomplete=function(){n()},t.onerror=function(){e(t.error)},t.onabort=function(){e(t.error)}})}function h(t,n,e){this._db=t,this.oldVersion=n,this.transaction=new f(e)}function d(t){this._db=t}r(u,"_index",["name","keyPath","multiEntry","unique"]),i(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),o(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(c,"_cursor",["direction","key","primaryKey","value"]),i(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var e=this,r=arguments;return Promise.resolve().then(function(){return e._cursor[t].apply(e._cursor,r),n(e._request).then(function(t){if(t)return new c(t,e._request)})})})}),a.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},a.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},r(a,"_store",["name","keyPath","indexNames","autoIncrement"]),i(a,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),o(a,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),s(a,"_store",IDBObjectStore,["deleteIndex"]),f.prototype.objectStore=function(){return new a(this._tx.objectStore.apply(this._tx,arguments))},r(f,"_tx",["objectStoreNames","mode"]),s(f,"_tx",IDBTransaction,["abort"]),h.prototype.createObjectStore=function(){return new a(this._db.createObjectStore.apply(this._db,arguments))},r(h,"_db",["name","version","objectStoreNames"]),s(h,"_db",IDBDatabase,["deleteObjectStore","close"]),d.prototype.transaction=function(){return new f(this._db.transaction.apply(this._db,arguments))},r(d,"_db",["name","version","objectStoreNames"]),s(d,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(t){[a,u].forEach(function(n){t in n.prototype&&(n.prototype[t.replace("open","iterate")]=function(){var n=function(t){return Array.prototype.slice.call(t)}(arguments),e=n[n.length-1],r=this._store||this._index,i=r[t].apply(r,n.slice(0,-1));i.onsuccess=function(){e(i.result)}})})}),[u,a].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var e=this,r=[];return new Promise(function(i){e.iterateCursor(t,function(t){t?(r.push(t.value),void 0===n||r.length!=n?t.continue():i(r)):i(r)})})})}),t.openDb=function(t,n,r){var i=e(indexedDB,"open",[t,n]),s=i.request;return s&&(s.onupgradeneeded=function(t){r&&r(new h(s.result,t.oldVersion,s.transaction))}),i.then(function(t){return new d(t)})},t.deleteDb=function(t){return e(indexedDB,"deleteDatabase",[t])},Object.defineProperty(t,"__esModule",{value:!0})}(n)},"./node_modules/stackframe/stackframe.js":function(t,n,e){var r,i,s;!function(e,o){"use strict";i=[],void 0===(s="function"==typeof(r=function(){function t(t){return!isNaN(parseFloat(t))&&isFinite(t)}function n(t){return t.charAt(0).toUpperCase()+t.substring(1)}function e(t){return function(){return this[t]}}var r=["isConstructor","isEval","isNative","isToplevel"],i=["columnNumber","lineNumber"],s=["fileName","functionName","source"],o=r.concat(i,s,["args"]);function u(t){if(t instanceof Object)for(var e=0;e<o.length;e++)t.hasOwnProperty(o[e])&&void 0!==t[o[e]]&&this["set"+n(o[e])](t[o[e]])}u.prototype={getArgs:function(){return this.args},setArgs:function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("Args must be an Array");this.args=t},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(t){if(t instanceof u)this.evalOrigin=t;else{if(!(t instanceof Object))throw new TypeError("Eval Origin must be an Object or StackFrame");this.evalOrigin=new u(t)}},toString:function(){var n=this.getFunctionName()||"{anonymous}",e="("+(this.getArgs()||[]).join(",")+")",r=this.getFileName()?"@"+this.getFileName():"",i=t(this.getLineNumber())?":"+this.getLineNumber():"",s=t(this.getColumnNumber())?":"+this.getColumnNumber():"";return n+e+r+i+s}};for(var c=0;c<r.length;c++)u.prototype["get"+n(r[c])]=e(r[c]),u.prototype["set"+n(r[c])]=function(t){return function(n){this[t]=Boolean(n)}}(r[c]);for(var a=0;a<i.length;a++)u.prototype["get"+n(i[a])]=e(i[a]),u.prototype["set"+n(i[a])]=function(n){return function(e){if(!t(e))throw new TypeError(n+" must be a Number");this[n]=Number(e)}}(i[a]);for(var f=0;f<s.length;f++)u.prototype["get"+n(s[f])]=e(s[f]),u.prototype["set"+n(s[f])]=function(t){return function(n){this[t]=String(n)}}(s[f]);return u})?r.apply(n,i):r)||(t.exports=s)}()},"./node_modules/tslib/tslib.es6.js":function(t,n,e){"use strict";e.r(n),e.d(n,"__extends",function(){return i}),e.d(n,"__assign",function(){return s}),e.d(n,"__rest",function(){return o}),e.d(n,"__decorate",function(){return u}),e.d(n,"__param",function(){return c}),e.d(n,"__metadata",function(){return a}),e.d(n,"__awaiter",function(){return f}),e.d(n,"__generator",function(){return h}),e.d(n,"__exportStar",function(){return d}),e.d(n,"__values",function(){return l}),e.d(n,"__read",function(){return v}),e.d(n,"__spread",function(){return p}),e.d(n,"__await",function(){return b}),e.d(n,"__asyncGenerator",function(){return w}),e.d(n,"__asyncDelegator",function(){return m}),e.d(n,"__asyncValues",function(){return y}),e.d(n,"__makeTemplateObject",function(){return _}),e.d(n,"__importStar",function(){return k}),e.d(n,"__importDefault",function(){return g});var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])};function i(t,n){function e(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}var s=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t};function o(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&(e[r[i]]=t[r[i]])}return e}function u(t,n,e,r){var i,s=arguments.length,o=s<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,n,e,r);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(o=(s<3?i(o):s>3?i(n,e,o):i(n,e))||o);return s>3&&o&&Object.defineProperty(n,e,o),o}function c(t,n){return function(e,r){n(e,r,t)}}function a(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)}function f(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})}function h(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=r[2&s[0]?"return":s[0]?"throw":"next"])&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[0,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function d(t,n){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}function l(t){var n="function"==typeof Symbol&&t[Symbol.iterator],e=0;return n?n.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}}function v(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,i,s=e.call(t),o=[];try{for(;(void 0===n||n-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(e=s.return)&&e.call(s)}finally{if(i)throw i.error}}return o}function p(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(v(arguments[n]));return t}function b(t){return this instanceof b?(this.v=t,this):new b(t)}function w(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e.apply(t,n||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(t){i[t]&&(r[t]=function(n){return new Promise(function(e,r){s.push([t,n,e,r])>1||u(t,n)})})}function u(t,n){try{!function(t){t.value instanceof b?Promise.resolve(t.value.v).then(c,a):f(s[0][2],t)}(i[t](n))}catch(t){f(s[0][3],t)}}function c(t){u("next",t)}function a(t){u("throw",t)}function f(t,n){t(n),s.shift(),s.length&&u(s[0][0],s[0][1])}}function m(t){var n,e;return n={},r("next"),r("throw",function(t){throw t}),r("return"),n[Symbol.iterator]=function(){return this},n;function r(r,i){t[r]&&(n[r]=function(n){return(e=!e)?{value:b(t[r](n)),done:"return"===r}:i?i(n):n})}}function y(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator];return n?n.call(t):l(t)}function _(t,n){return Object.defineProperty?Object.defineProperty(t,"raw",{value:n}):t.raw=n,t}function k(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}function g(t){return t&&t.__esModule?t:{default:t}}},"./src/common/constants.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EVENT_JITTER_MAX_MILLISECONDS=7e3},"./src/common/data-providers/api.data-provider.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./src/common/utils.ts"),o=e("./src/common/constants.ts"),u=function(){function t(){}return t.get=function(t,n){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,this.exec(t,"GET",{"content-type":"application/json"},void 0,n)]})})},t.post=function(t,n,e){return void 0===n&&(n={}),r(this,void 0,void 0,function(){return i(this,function(r){return[2,this.exec(t,"POST",{"content-type":"application/json"},n,e)]})})},t.exec=function(t,n,e,u,c){return r(this,void 0,void 0,function(){var r,a,f,h,d;return i(this,function(i){switch(i.label){case 0:r=null,i.label=1;case 1:return i.trys.push([1,11,,12]),c?(a=0,a="object"==typeof c&&"ms"in c?c.ms:o.EVENT_JITTER_MAX_MILLISECONDS,[4,s.delayRandom(a)]):[3,3];case 2:i.sent(),i.label=3;case 3:return f={method:n,headers:e},"GET"!==n&&u&&(f.body="string"!=typeof u?JSON.stringify(u):u),[4,s.retryFetch(t,f)];case 4:if(!(r=i.sent()).ok)return[3,9];h=void 0,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,r.json()];case 6:return h=i.sent(),[3,8];case 7:return i.sent(),[3,8];case 8:return[2,h];case 9:throw new Error("Endpoint returned with status "+r.statusText);case 10:return[3,12];case 11:throw(d=(d=i.sent())||{}).response=r,d;case 12:return[2]}})})},t}();n.ApiDataProvider=u},"./src/common/data-providers/idb.data-provider.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./node_modules/idb/build/idb.js"),o=e("./src/common/utils.ts"),u=e("./src/sdk/data-providers/index.ts"),c=function(){function t(t,n){void 0===n&&(n=1),this.dbName=t,this.version=n,this.storeName="production_store"}return t.prototype.isEnabled=function(){var t=u.CookieDataProvider.get("pushly.app_usingIdb",0);return 1===o.tryParseInt(t)},t.prototype.connect=function(){return r(this,void 0,void 0,function(){var t,n,e=this;return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,o.delayRandom(250)];case 1:return r.sent(),[4,s.openDb(this.dbName,this.version,function(t){switch(t.oldVersion){case 0:case 1:t.createObjectStore(e.storeName,{keyPath:"entityType"})}})];case 2:return t=r.sent(),this.db=t,[3,4];case 3:throw n=r.sent(),console.log(n),n;case 4:return[2]}})})},t.prototype.deleteDb=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.db&&this.close(),[4,s.deleteDb(this.dbName)];case 1:return t.sent(),[2]}})})},t.prototype.get=function(t){return r(this,void 0,void 0,function(){var n,e,r;return i(this,function(i){switch(i.label){case 0:return this.db?[3,2]:[4,this.connect()];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),e=this.db.transaction(this.storeName,"readonly"),[4,e.objectStore(this.storeName).get(t)];case 3:return n=i.sent(),[3,5];case 4:throw r=i.sent(),console.warn("IDB Error ["+this.storeName+"->"+t+"]",r),r;case 5:return[2,n||{}]}})})},t.prototype.set=function(t,n){return r(this,void 0,void 0,function(){var e,r,s,o;return i(this,function(i){switch(i.label){case 0:return this.db?[3,2]:[4,this.connect()];case 1:i.sent(),i.label=2;case 2:return e=this.db.transaction(this.storeName,"readwrite"),[4,(r=e.objectStore(this.storeName)).get(t)];case 3:return s=i.sent()||{},n.entityType=t,o=Object.keys(n),Object.keys(s).forEach(function(t){-1===o.indexOf(t)&&delete s[t]}),o.forEach(function(t){var e=n[t];s[t]=e}),[4,r.put(s)];case 4:return i.sent(),[4,e.complete];case 5:return i.sent(),[2]}})})},t.prototype.getAll=function(){return r(this,void 0,void 0,function(){var t,n;return i(this,function(e){switch(e.label){case 0:return this.db?[3,2]:[4,this.connect()];case 1:e.sent(),e.label=2;case 2:return t=this.db.transaction(this.storeName,"readonly"),[4,t.objectStore(this.storeName).getAll()];case 3:return n=e.sent()||[],[4,t.complete];case 4:return e.sent(),[2,n]}})})},t.prototype.close=function(){this.db&&(this.db.close(),this.db=void 0)},t}();n.IdbDP=c,n.IdbDataProvider=new c("pushly",1)},"./src/common/utils.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=this;Object.defineProperty(n,"__esModule",{value:!0}),n.randomString=function(t){void 0===t&&(t=32);for(var n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="",r=0;r<t;r++)e+=n[Math.floor(Math.random()*n.length)];return e},n.tryParseInt=function(t){var n,e=String(t);try{isNaN(e)||(n=parseInt(e,10))}catch(t){}return n},n.buildRegexFromArray=function(t){return new RegExp(t.map(function(t){return"("+t+")"}).join("|"),"i")},n.delay=function(t){return void 0===t&&(t=0),r(s,void 0,void 0,function(){return i(this,function(n){return[2,new Promise(function(n,e){setTimeout(function(){return n()},t)})]})})},n.delayRandom=function(t){return void 0===t&&(t=0),r(s,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return void 0!==t&&t>0&&(t=Math.round(Math.random()*t)),[4,n.delay(t)];case 1:return e.sent(),[2,t]}})})},n.retryFetch=function t(e,s,o,u,c){return void 0===u&&(u=8),void 0===c&&(c=800),r(this,void 0,void 0,function(){var a,f,h,d,l=this;return i(this,function(v){switch(v.label){case 0:a=null,f=function(a){return r(l,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:if((r=u-1)<=0)throw a instanceof Error?a:new Error(a);return[4,n.delay(c)];case 1:return i.sent(),o&&o(r),[2,t(e,s,o,r,2*c)]}})})},v.label=1;case 1:return v.trys.push([1,6,,7]),[4,fetch(e,s)];case 2:return(a=v.sent()).ok?[2,a]:[3,3];case 3:return[4,a.text()];case 4:return h=v.sent(),[2,f("Retry fetch failed on url: "+e+". response object: "+h)];case 5:return[3,7];case 6:return d=v.sent(),[2,f(d)];case 7:return[2]}})})}},"./src/sdk/constants.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ENV_NAME="production",n.PUSHLY_APPLICATION_VERSION="8421d22f48d204ab5c5d58f13450e571ca371c16",n.EVENTS_ENDPOINT="https://k.p-n.io/event-stream",n.SETTINGS_ENDPOINT="https://cdn.p-n.io/domain-settings",n.ALLOW_ENDPOINT="https://k.p-n.io/allow",n.CSS_URL="https://cdn.p-n.io/pushly-sdk.min.css",n.SW_DEPENDENCY_URL="https://cdn.p-n.io/pushly-sw.min.js",n.PROXY_URL="https://notifications.p-n.io",n.APNS_URL="https://cdn.p-n.io/apns",function(t){for(var e in t)n.hasOwnProperty(e)||(n[e]=t[e])}(e("./src/common/constants.ts")),n.PUSHLY_SDK_APPLICATION_NAME="pushly-sdk",n.PUSHLY_UNIQUE_USER_ID_QS="pushly_unique_user_id",n.PUSHLY_UNIQUE_USER_FIRST_APPEARANCE_QS="pushly_unique_user_first_appearance",n.PUSHLY_PROMPT_DISMISSED_COOKIE_TIMEOUT=7,n.PUSHLY_DOMAIN_KEY_QS="pushly_domain_key",n.PUSHLY_SUBSCRIBED_URL_QS="pushly_subscribed_url",n.PUSHLY_PROMPT_ID_QS="pushly_prompt_id",n.PUSHLY_DB_NAME="pushly_db",n.PUSHLY_STORE_NAME="pushly_store",n.PUSHLY_SETTINGS_CACHED_COOKIE_TIMEOUT=1/24/12,n.ENV_NAME_LOCAL="local",n.ENV_NAME_LOCAL_PRODUCTION="local-production",n.ENV_NAME_DEV="dev",n.ENV_NAME_STAGING="staging",n.ENV_NAME_PRODUCTION="production",n.MOBILE_MAX_SIZE=768,n.DEFAULT_CLASSNAME_WEB_PUSH_UNSUPPORTED="pushly-web-push-unsupported",n.DEFAULT_CLASSNAME_WEB_PUSH_SUPPORTED="pushly-web-push-supported",n.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE="pushly-subscription-none",n.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE="pushly-subscription-subscribed",n.DEFAULT_CLASSNAME_SUBSCRIPTION_FALSE="pushly-subscription-unsubscribed",n.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED="pushly-subscription-denied",n.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE="pushly-prompt-ineligible",n.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE="pushly-prompt-eligible",n.DEFAULT_CLASSNAME_PROMPT_VISIBLE="pushly-prompt-visible",n.DEFAULT_CLASSNAME_PROMPT_CUSTOM="pushly-prompt-custom",n.DEFAULT_CLASSNAME_PROMPT_BTN_ALLOW="pushly-prompt-buttons-allow",n.DEFAULT_CLASSNAME_PROMPT_BTN_DISMISS="pushly-prompt-buttons-dismiss",n.UNCAUGHT_ERROR_BLACKLIST=["^UnknownError","^NotAllowedError$","^AbortError$","^QuotaExceededError$","Only secure origins are allowed","Cannot read property .permission. of undefined","Failed to execute .transaction. on .IDBDatabase.","failed for reasons unrelated to the database itself","Internal error opening backing store for indexedDB.open"],n.DEBUG_EVENT_DOMAIN_WHITELIST=["drYuYnE4fePhWfs1v4L2jVdZGlqBZUAFW8qS","ObKjd8QLiYPdzoPCc5AjMuYRsImjiTDP2LlH","SyQnj5ThdSz3T69zy7juMgrYy54qOXyTghGR","BCeLboDFNRwDLByTKkXLDU6OBrwLSLQmYntG"]},"./src/sdk/data-providers/cookie.data-provider.ts":function(t,n,e){"use strict";function r(){return!("WorkerGlobalScope"in self)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.getDomain=function(){var t=function(){var t,n,e=document.location.hostname.split(".");for(t=e.length-1;t>=0;t--)if(n=e.slice(t).join("."),document.cookie="_sw_tld_check=cookie;domain=."+n+";",document.cookie.indexOf("_sw_tld_check=cookie")>-1)return document.cookie="_sw_tld_check=cookie".split("=")[0]+"=;domain=."+n+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",n}();return t||"localhost"!==(t=location.hostname)&&(t="."+t.split(".").splice(-2).join(".")),t},t.set=function(t,n,e,i){if(void 0===e&&(e=9999),void 0===i&&(i="d"),r()){void 0!==n&&null!==n||(e=-1);try{var s=new Date,o=this.getDomain(),u=1;switch(i){case"d":case"days":u=86400;break;case"h":case"hours":u=3600;break;case"m":case"minutes":u=60}return s.setTime(s.getTime()+e*u*1e3),document.cookie=t+"="+n+";expires="+s.toUTCString()+";path=/;domain="+o,n}catch(t){}}},t.setWithRawExpires=function(t,n,e){if(r())try{var i=this.getDomain();return document.cookie=t+"="+n+";expires="+e+";path=/;domain="+i,n}catch(t){console.log(t)}},t.get=function(t,n){if(void 0===n&&(n=null),r()){for(var e=document.cookie.split(";"),i=0;i<e.length;i++){var s=e[i].split("=");if(s[0].trim()===t)return s[1].trim()}return n}},t.getAll=function(){if(r()){for(var t={},n=document.cookie.split(";"),e=0;e<n.length;e++){var i=n[e].split("=");/pushly_*/i.test(i[0].trim())&&(t[i[0].trim()]=i[1].trim())}return t}},t.clear=function(t){this.set(t,null,-1)},t.has=function(t){return null!==this.get(t)},t}();n.CookieDataProvider=i},"./src/sdk/data-providers/event.data-provider.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./src/sdk/utils.ts"),o=e("./src/sdk/enums/index.ts"),u=e("./src/sdk/exceptions/index.ts"),c=function(){function t(){this.listeners={}}return t.prototype.on=function(t,n){for(var e=[],r=0,i=Array.isArray(t)?t:[t];r<i.length;r++){var o=i[r];o=o.trim(),this.validateEventType(o);var u=s.randomString(),c=o.split(".");c&&2===c.length&&(o=c[0],u=c[1]),this.listeners[o]=this.listeners[o]||{},this.listeners[o][u]=n,e.push(this.unregisterCallback(o,u))}return e},t.prototype.once=function(t,n){var e=this;(Array.isArray(t)?t:[t]).forEach(function(t){var r,i=t.trim();e.validateEventType(i);r=e.on(i,function(t){null!=t?n(t):n(),r()})[0]})},t.prototype.dispatch=function(t){return r(this,void 0,void 0,function(){var n,e,r,s,o,u,c,a;return i(this,function(i){switch(i.label){case 0:for(this.validateEventType(t.type),n=this.listeners[t.type]||{},e=[],r=Object.keys(n),s=0,o=r;s<o.length;s++)u=o[s],c=n[u],null!=t.data?(a=Array.isArray(t.data)?t.data:[t.data],e.push(c.apply(void 0,a))):e.push(c());return[4,Promise.all(e)];case 1:return i.sent(),[2]}})})},t.prototype.unregisterCallback=function(t,n){var e=this;return function(){e.listeners[t][n]&&delete e.listeners[t][n]}},t.prototype.validateEventType=function(t){var n=-1===Object.keys(o.EventType).map(function(t){return o.EventType[t]}).indexOf(t),e=-1===Object.keys(o.AmpMessageTopic).map(function(t){return o.AmpMessageTopic[t]}).indexOf(t);if(n&&e)throw new u.InvalidEventException(t)},t}();n.EventDataProvider=c,n.EventManager=new c},"./src/sdk/data-providers/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/common/data-providers/api.data-provider.ts");n.ApiDataProvider=r.ApiDataProvider;var i=e("./src/sdk/data-providers/cookie.data-provider.ts");n.CookieDataProvider=i.CookieDataProvider;var s=e("./src/sdk/data-providers/event.data-provider.ts");n.EventDataProvider=s.EventDataProvider,n.EventManager=s.EventManager;var o=e("./src/common/data-providers/idb.data-provider.ts");n.IdbDataProvider=o.IdbDataProvider;var u=e("./src/sdk/data-providers/legacy-idb.data-provider.ts");n.LegacyIdbDataProvider=u.LegacyIdbDataProvider;var c=e("./src/sdk/data-providers/session.data-provider.ts");n.SessionDataProvider=c.SessionDataProvider},"./src/sdk/data-providers/legacy-idb.data-provider.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./node_modules/idb/build/idb.js"),o=e("./src/sdk/utils.ts"),u=e("./src/sdk/constants.ts"),c=function(){function t(t,n){void 0===n&&(n=1),this.dbName=t,this.version=n}return t.prototype.connect=function(){return r(this,void 0,void 0,function(){var t,n;return i(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,o.delayRandom(250)];case 1:return e.sent(),[4,s.openDb(this.dbName,this.version,function(t){switch(t.oldVersion){case 0:case 1:t.createObjectStore(u.PUSHLY_STORE_NAME,{keyPath:"env"})}})];case 2:return t=e.sent(),this.db=t,[3,4];case 3:throw n=e.sent(),console.log(n),n;case 4:return[2]}})})},t.prototype.deleteDb=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.db&&this.close(),[4,s.deleteDb(this.dbName)];case 1:return t.sent(),[2]}})})},t.prototype.get=function(t,n){return r(this,void 0,void 0,function(){var e;return i(this,function(r){switch(r.label){case 0:return this.db?[3,2]:[4,this.connect()];case 1:r.sent(),r.label=2;case 2:return e=this.db.transaction(t,"readonly"),[4,e.objectStore(t).get(n)];case 3:return[2,r.sent()||{}]}})})},t.prototype.close=function(){this.db&&(this.db.close(),this.db=void 0)},t}();n.LegacyIdbDP=c,n.LegacyIdbDataProvider=new c(u.PUSHLY_DB_NAME,1)},"./src/sdk/data-providers/session.data-provider.ts":function(t,n,e){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./src/sdk/services/logging.service.ts"),s=function(){function t(){}return Object.defineProperty(t.prototype,"currentSession",{get:function(){var t={sessionStart:Date.now(),pageViews:[]},n=this.store,e=n.getItem("pushly-session");if(e)try{e=JSON.parse(e)}catch(s){i.Logger.warn("Corrupt session encountered. Resetting current session."),e=r({},t),n.setItem("pushly-session",JSON.stringify(e))}else e=r({},t),n.setItem("pushly-session",JSON.stringify(e));return e.sessionStart||(i.Logger.warn("Corrupt session encountered. Resetting current session."),e=r({},t),n.setItem("pushly-session",JSON.stringify(e))),e},enumerable:!0,configurable:!0}),t.prototype.set=function(t,n){var e=this.currentSession;return e[t]=n,this.store.setItem("pushly-session",JSON.stringify(e)),this},t.prototype.get=function(t){return this.currentSession[t]},t.prototype.getCurrentTotalPageViews=function(){return(this.currentSession.pageViews||[]).length},Object.defineProperty(t.prototype,"store",{get:function(){return window.sessionStorage},enumerable:!0,configurable:!0}),t}();n.SessionDP=s,n.SessionDataProvider=new s},"./src/sdk/enums/amp-message-topic.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.CONNECT_HANDSHAKE="topic-connect-handshake",t.NOTIFICATION_PERMISSION_STATE="topic-notification-permission-state",t.SERVICE_WORKER_STATE="topic-service-worker-state",t.SERVICE_WORKER_REGISTRATION="topic-service-worker-registration",t.SERVICE_WORKER_QUERY="topic-service-worker-query",t.STORAGE_GET="topic-storage-get"}(n.AmpMessageTopic||(n.AmpMessageTopic={}))},"./src/sdk/enums/amp-worker-message-topic.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.AMP_SUBSCRIPTION_STATE="amp-web-push-subscription-state",t.AMP_SUBSCRIBE="amp-web-push-subscribe",t.AMP_UNSUBSCRIBE="amp-web-push-unsubscribe"}(n.AmpWorkerMessageTopic||(n.AmpWorkerMessageTopic={}))},"./src/sdk/enums/bell-prompt-display-behavior.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.ALWAYS="ALWAYS",t.PRE_SUBSCRIPTION="PRE_SUBSCRIPTION",t.POST_SUBSCRIPTION="POST_SUBSCRIPTION"}(n.BellPromptDisplayBehavior||(n.BellPromptDisplayBehavior={}))},"./src/sdk/enums/event-type.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.APPLICATION_LOAD="load",t.APPLICATION_LOADED="loaded",t.APPLICATION_LOAD_ERROR="load_error",t.APPLICATION_LOAD_FAILED="load_failed",t.APPLICATION_READY="ready",t.WEB_PUSH_SUPPORTED="web_push_supported",t.WEB_PUSH_NOT_SUPPORTED="web_push_unsupported",t.WEB_PUSH_NOT_CONFIGURED="web_push_not_configured",t.DOMAIN_APNS_NOT_CONFIGURED="apns_not_configured",t.DOMAIN_APNS_NOT_ENABLED="apns_not_enabled",t.DOMAIN_APNS_INVALID_CONFIG="apns_invalid_config",t.PROFILE_UPDATE="profile",t.PROFILE_UPDATE_EXTERNAL_ID="external_id",t.PROFILE_UPDATE_TAGS="tag",t.PROFILE_UPDATE_REMOVE_TAGS="untag",t.PROFILE_UPDATE_USER_EVENT="event",t.PROXY_PERMISSION_DIALOG_LOAD="proxy_permission_dialog",t.PROXY_FRAME_HELPER_LOAD="proxy_frame_helper",t.AMP_FRAME_HELPER_LOAD="amp_frame_helper",t.AMP_PERMISSION_DIALOG_LOAD="amp_permission_dialog",t.AMP_HANDSHAKE="handshake",t.AMP_CONNECT="connect",t.FLOW_LOADED="flow_loaded",t.PROMPT_ELIGIBLE="prompt_eligible",t.PROMPT_INELIGIBLE="prompt_ineligible",t.PROMPT_SHOW="show_prompt",t.PROMPT_SHOWN="prompt_shown",t.PROMPT_ALLOWED="prompt_allowed",t.PROMPT_DISMISSED="prompt_dismissed",t.PROMPT_HIDE="prompt_hide",t.FOLLOW_SHOWN="prompt_shown",t.FOLLOWED="followed",t.REGISTRATION_ATTEMPT="attempt_registration",t.REGISTRATION_SUBSCRIBED="subscribed",t.REGISTRATION_UNSUBSCRIBED="unsubscribed",t.REGISTRATION_MIGRATED="migrated",t.LEGACY_PERMISSION_DIALOG_SHOWN="permission_prompted",t.PERMISSION_DIALOG_SHOWN="permission_shown",t.LEGACY_PERMISSION_GRANTED="permission_accepted",t.PERMISSION_GRANTED="permission_allowed",t.PERMISSION_DISMISSED="permission_dismissed",t.PERMISSION_DENIED="permission_denied",t.FCM_TOKEN_REFRESH="token_refreshed"}(n.EventType||(n.EventType={}))},"./src/sdk/enums/exception-message.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.ENV_NOT_SUPPORTED="Environment is not supported.",t.SDK_ALREADY_LOADED="SDK has already been loaded.",t.WORKER_LOAD_FAILED="ServiceWorker could not be loaded.",t.DOMAIN_KEY_NOT_SPECIFIED="Domain key must be specified",t.DOMAIN_UNABLE_TO_LOAD="Domain settings could not be loaded.",t.DOMAIN_APNS_NOT_CONFIGURED="Domain is not configured for use with Safari.",t.DOMAIN_APNS_NOT_ENABLED="Domain is currently disabled on Safari.",t.DOMAIN_APNS_INVALID_CONFIG="Domain configuration is invalid.",t.MIXED_INTEGRATION="Domain was configured to use both a proxy integration and native prompt.",t.HOST_NOT_WHITELISTED="Current host is not whitelisted for use",t.DIRECT_INTEGRATION_NOT_SECURE="Environment is not secure. The ServiceWorker cannot be loaded.",t.USER_UNABLE_TO_LOAD="User could not be initialized.",t.USER_INVALID_PUSH_PACKAGE="Subscription state cannot be determined.",t.USER_STATE_DENIED="Subscription state is currently set to denied.",t.USER_STATE_DISMISSED="Subscription state is currently set to dismissed.",t.USER_STATE_UNSUBBED="Subscription state is currently set to unsubscribed.",t.FIREBASE_FAILED_TO_GET_GRANTED_TOKEN="Failed to fetch token from FCM after permission was granted. Exiting flow.",t.APNS_FAILED_TO_GET_GRANTED_TOKEN="Failed to fetch token from APNS after permission was granted. Exiting flow.",t.INVALID_TOKEN_TYPE="Token is not a valid string"}(n.ExceptionMessage||(n.ExceptionMessage={}))},"./src/sdk/enums/firebase-error.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t[t.PUSH_SERVICE_NOT_AVAILABLE=20]="PUSH_SERVICE_NOT_AVAILABLE",t.FIREBASE_DUPLICATE_APP="app/duplicate-app",t.FCM_NOTIFICATIONS_BLOCKED="messaging/notifications-blocked",t.FCM_NOTIFICATIONS_DEFAULT="messaging/notifications-default",t.FCM_FAILED_SERVICE_WORKER_REGISTRATION="messaging/failed-serviceworker-registration",t.FCM_SUBSCRIPTION_FAILED="messaging/token-subscribe-failed",t.FCM_TOKEN_UPDATE_FAILED="messaging/token-update-failed",t.FCM_DELETE_TOKEN_FAILED="messaging/delete-token-not-found",t.FCM_INCORRECT_GCM_SENDER_ID="messaging/incorrect-gcm-sender-id",t.PERMISSION_BLOCKED="messaging/permission-blocked",t.PERMISSION_DEFAULT="messaging/permission-default"}(n.FirebaseError||(n.FirebaseError={}))},"./src/sdk/enums/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/enums/event-type.enum.ts");n.EventType=r.EventType;var i=e("./src/sdk/enums/steamable-event-type.enum.ts");n.StreamableEventType=i.StreamableEventType;var s=e("./src/sdk/enums/prompt-style.enum.ts");n.PromptStyle=s.PromptStyle;var o=e("./src/sdk/enums/trackable-setting.enum.ts");n.TrackableSetting=o.TrackableSetting;var u=e("./src/sdk/enums/exception-message.enum.ts");n.ExceptionMessage=u.ExceptionMessage;var c=e("./src/sdk/enums/integration-type.enum.ts");n.IntegrationType=c.IntegrationType;var a=e("./src/sdk/enums/runtime-environment.enum.ts");n.RuntimeEnvironment=a.RuntimeEnvironment,n.RuntimeEnvironmentName=a.RuntimeEnvironmentName;var f=e("./src/sdk/enums/firebase-error.enum.ts");n.FirebaseError=f.FirebaseError;var h=e("./src/sdk/enums/prompt-referrer-condition.enum.ts");n.PromptReferrerCondition=h.PromptReferrerCondition;var d=e("./src/sdk/enums/notification-permission-state.enum.ts");n.NotificationPermissionState=d.NotificationPermissionState;var l=e("./src/sdk/enums/bell-prompt-display-behavior.enum.ts");n.BellPromptDisplayBehavior=l.BellPromptDisplayBehavior;var v=e("./src/sdk/enums/amp-message-topic.enum.ts");n.AmpMessageTopic=v.AmpMessageTopic;var p=e("./src/sdk/enums/amp-worker-message-topic.enum.ts");n.AmpWorkerMessageTopic=p.AmpWorkerMessageTopic},"./src/sdk/enums/integration-type.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.DIRECT="direct",t.PROXY="proxy"}(n.IntegrationType||(n.IntegrationType={}))},"./src/sdk/enums/notification-permission-state.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.DEFAULT="default",t.GRANTED="granted",t.DENIED="denied"}(n.NotificationPermissionState||(n.NotificationPermissionState={}))},"./src/sdk/enums/prompt-referrer-condition.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.ALLOW="allow",t.IGNORE="ignore",t.BLOCK="block"}(n.PromptReferrerCondition||(n.PromptReferrerCondition={}))},"./src/sdk/enums/prompt-style.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.Native="NATIVE",t.Custom="PUBLISHER_CUSTOM",t.Slide="SLIDE",t.Bell="BELL"}(n.PromptStyle||(n.PromptStyle={}))},"./src/sdk/enums/runtime-environment.enum.ts":function(t,n,e){"use strict";var r,i;Object.defineProperty(n,"__esModule",{value:!0}),function(t){t[t.DIRECT=100]="DIRECT",t[t.PROXY=200]="PROXY",t[t.PROXY_PERMISSION_DIALOG=201]="PROXY_PERMISSION_DIALOG",t[t.PROXY_FRAME_HELPER=202]="PROXY_FRAME_HELPER",t[t.AMP=300]="AMP",t[t.AMP_PERMISSION_DIALOG=301]="AMP_PERMISSION_DIALOG",t[t.AMP_FRAME_HELPER=302]="AMP_FRAME_HELPER",t[t.SERVICE_WORKER=1e3]="SERVICE_WORKER"}(i=n.RuntimeEnvironment||(n.RuntimeEnvironment={})),n.RuntimeEnvironmentName=((r={})[i.DIRECT]="Direct",r[i.PROXY]="Proxy",r[i.PROXY_PERMISSION_DIALOG]="Proxy Permission Dialog",r[i.PROXY_FRAME_HELPER]="Proxy Frame Helper",r[i.AMP]="AMP",r[i.AMP_PERMISSION_DIALOG]="AMP Permission Dialog",r[i.AMP_FRAME_HELPER]="AMP Frame Helper",r[i.SERVICE_WORKER]="Service Worker",r)},"./src/sdk/enums/steamable-event-type.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.ERROR="error",t.PAGE_VIEW="view_page",t.PROMPT_SHOWN="prompt_shown",t.PROMPT_ALLOWED="prompt_allow",t.PROMPT_DISMISSED="prompt_dismiss",t.PROMPT_NOT_SHOWN="prompt_not_shown",t.FOLLOW_SHOWN="follow_shown",t.FOLLOWED="follow",t.PERMISSION_PROMPTED="permission_prompted",t.PERMISSION_ACCEPTED="permission_accepted",t.PERMISSION_DENIED="permission_denied",t.PERMISSION_DISMISSED="permission_dismissed",t.SUBSCRIBED="subscribed",t.MIGRATED="migrated",t.SUBSCRIPTION_CHANGED="subscription_changed",t.TOKEN_REFRESHED="token_refreshed",t.UNSUBSCRIBED="unsubscribed",t.MANUAL_UNSUBSCRIBED="manual_unsubscribed",t.PROXY_WINDOW_BLOCKED="proxy_window_blocked",t.PROXY_WINDOW_OPENED="proxy_window_opened",t.PROXY_WINDOW_CLOSED="proxy_window_closed",t.PROFILE_UPDATE="profile",t.SDK_IMPRESSION="sdk_impression"}(n.StreamableEventType||(n.StreamableEventType={}))},"./src/sdk/enums/trackable-setting.enum.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.ALL="all",t.LOCATION="location",t.BROWSER="browser",t.PAGE_VIEW="page_view"}(n.TrackableSetting||(n.TrackableSetting={}))},"./src/sdk/exceptions/domain-load.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./src/sdk/enums/index.ts"),s=["Failed to Fetch","Retry fetch failed","NetworkError when attempting to fetch","Network request failed","The internet connection appears to be offline","A server with the specified hostname could not be found"],o=function(t){function n(e){var r=t.call(this,e,i.ExceptionMessage.DOMAIN_UNABLE_TO_LOAD,n)||this;return r.blacklistedErrors=s,r.name="DomainLoadException",r}return r(n,t),n}(e("./src/sdk/exceptions/pushly.exception.ts").PushlyException);n.DomainLoadException=o},"./src/sdk/exceptions/exit.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){function n(e,r){var i=this;return"string"==typeof e&&(r=e,e=null),(i=t.call(this,e,r,n)||this).name="ExitException",i}return r(n,t),n}(e("./src/sdk/exceptions/pushly.exception.ts").PushlyException);n.ExitException=i},"./src/sdk/exceptions/fail.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){function n(e,r){var i=this;return"string"==typeof e&&(r=e,e=null),(i=t.call(this,e,r,n)||this).name="FailException",i}return r(n,t),n}(e("./src/sdk/exceptions/pushly.exception.ts").PushlyException);n.FailException=i},"./src/sdk/exceptions/firebase.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./src/sdk/exceptions/pushly.exception.ts"),s=e("./src/sdk/enums/index.ts"),o=[s.ExceptionMessage.FIREBASE_FAILED_TO_GET_GRANTED_TOKEN],u=function(t){function n(e,r){var i=t.call(this,e,r,n)||this;return i.blacklistedErrors=o,i.name="FirebaseException",i}return r(n,t),n.prototype.shouldSuppress=function(){var n=!1;return this.originError&&(this.originError.code===s.FirebaseError.FCM_NOTIFICATIONS_BLOCKED?(this.message="Notification Permissions Blocked",n=!0):this.originError.code===s.FirebaseError.FCM_NOTIFICATIONS_DEFAULT?(this.message="Notification Permissions Dismissed",n=!0):this.originError.message&&/cannot read property .permission. of undefined/i.test(this.originError.message)&&(this.message="Firebase Internals Error",n=!0)),n||t.prototype.shouldSuppress.call(this)},n}(i.PushlyException);n.FirebaseException=u},"./src/sdk/exceptions/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/exceptions/pushly.exception.ts");n.PushlyException=r.PushlyException;var i=e("./src/sdk/exceptions/unhandled.exception.ts");n.UnhandledException=i.UnhandledException;var s=e("./src/sdk/exceptions/exit.exception.ts");n.ExitException=s.ExitException;var o=e("./src/sdk/exceptions/fail.exception.ts");n.FailException=o.FailException;var u=e("./src/sdk/exceptions/profile.exception.ts");n.ProfileException=u.ProfileException;var c=e("./src/sdk/exceptions/invalid-event.exception.ts");n.InvalidEventException=c.InvalidEventException;var a=e("./src/sdk/exceptions/firebase.exception.ts");n.FirebaseException=a.FirebaseException;var f=e("./src/sdk/exceptions/domain-load.exception.ts");n.DomainLoadException=f.DomainLoadException;var h=e("./src/sdk/exceptions/worker-registration.exception.ts");n.WorkerRegistrationException=h.WorkerRegistrationException},"./src/sdk/exceptions/invalid-event.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){function n(e){var r=t.call(this,null,"Invalid event '"+e+"' specified.",n)||this;return r.name="InvalidEventException",r}return r(n,t),n}(e("./src/sdk/exceptions/pushly.exception.ts").PushlyException);n.InvalidEventException=i},"./src/sdk/exceptions/profile.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){function n(e,r){var i=this;return"string"==typeof e&&(r=e,e=null),(i=t.call(this,e,r,n)||this).name="ProfileException",i}return r(n,t),n}(e("./src/sdk/exceptions/pushly.exception.ts").PushlyException);n.ProfileException=i},"./src/sdk/exceptions/pushly.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./src/common/utils.ts"),s=["Invalid argument","無効な引数です","参数无效","Недопустимый аргумент","Ungültiges Argument","Nieprawidłowy argument","Ongeldig argument","Ogiltigt argument","Argumento inválido","Virheellinen argumentti","Argument non valide"],o=function(t){function n(e,r,i){void 0===i&&(i=n);var s=t.call(this,r||e.message)||this;s.isPushlyException=!0,s.suppressed=!1,s.blacklistedErrors=[],s.name="PushlyException",s.originError=e;try{Object.setPrototypeOf(s,i.prototype)}catch(t){}return s}return r(n,t),n.prototype.shouldSuppress=function(){if(this.suppressed)return!0;var t=this.suppressed,n=this.originError||this;if(!t&&this.blacklistedErrors.length>0){var e=i.buildRegexFromArray(this.blacklistedErrors);t=e.test(this.name)||e.test(this.message)||e.test(n.name)||e.test(n.message)}if(!t){var r=i.buildRegexFromArray(s);t=r.test(this.name)||r.test(this.message)||r.test(n.name)||r.test(n.message)}return t},n}(Error);n.PushlyException=o},"./src/sdk/exceptions/unhandled.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(t){function n(e){var r=t.call(this,e,void 0,n)||this;return r.name="UnhandledException",r}return r(n,t),n}(e("./src/sdk/exceptions/pushly.exception.ts").PushlyException);n.UnhandledException=i},"./src/sdk/exceptions/worker-registration.exception.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./src/sdk/enums/index.ts"),s=["ServiceWorker script evaluation failed","An unknown error occurred when fetching the script","Encountered an error during installation","Operation has been aborted","Operation was aborted","ServiceWorker cannot be started","Timed out while trying to start the service worker","Worker system has shutdown","Could not find a renderer process to run a service worker","Request to fetch the script was interrupted","Resource is behind a redirect","HTTP response code .?(4|5)[\\d]{2}.? was received","An SSL certificate error occurred","An SSL error has occurred","SecurityError","Please ensure that .messagingSenderId. is set correctly","The expression cannot be converted to return the specified type"],o=function(t){function n(e){var r=t.call(this,e,i.ExceptionMessage.WORKER_LOAD_FAILED,n)||this;return r.blacklistedErrors=s,r.name="WorkerRegistrationException",r}return r(n,t),n}(e("./src/sdk/exceptions/pushly.exception.ts").PushlyException);n.WorkerRegistrationException=o},"./src/sdk/factories/flow.factory.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/enums/index.ts"),i=e("./src/sdk/flows/index.ts"),s=function(){function t(){}return t.getFlow=function(t){var n,e=t.user.env.primaryRuntimeEnvironment,s=t.user.env.subRuntimeEnvironment;return s&&(e=s),new(0,(n={},n[r.RuntimeEnvironment.DIRECT]=i.DirectFlow,n[r.RuntimeEnvironment.PROXY]=i.ProxyFlow,n[r.RuntimeEnvironment.PROXY_PERMISSION_DIALOG]=i.ProxyPermissionDialogFlow,n[r.RuntimeEnvironment.AMP_PERMISSION_DIALOG]=i.AmpPermissionDialogFlow,n[r.RuntimeEnvironment.AMP_FRAME_HELPER]=i.AmpFrameHelperFlow,n)[e])(t)},t}();n.FlowFactory=s},"./src/sdk/factories/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/factories/flow.factory.ts");n.FlowFactory=r.FlowFactory;var i=e("./src/sdk/factories/prompt.factory.ts");n.PromptFactory=i.PromptFactory},"./src/sdk/factories/prompt.factory.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./src/sdk/enums/index.ts"),s=e("./src/sdk/prompts/index.ts"),o=e("./src/sdk/models/index.ts"),u=e("./src/sdk/services/index.ts"),c=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.getPrompts=function(t,n){var e=this;void 0===n&&(n={});var r=[];if(!n.isAmp){var i=this._selectEligiblePrompts(t);i.length>0?i.forEach(function(n){var i=e._selectPromptClass(n.prompt.style);r.push(new i(t,n))}):(this.debugPromptNotShown(t,"no_eligible_prompts"),u.Logger.info("No eligible prompts found"))}return r},n.getPromptById=function(t,n){var e,r={};(r.prompt=t.domain.prompts.find(function(t){return t.id.toString()===n.toString()}),r.prompt&&(r.group=t.domain.promptGroups.find(function(t){return t.id.toString()===r.prompt.prompt_group_id.toString()})),r.group)&&(e=new(this._selectPromptClass(r.prompt.style))(t,r));return e},n._selectPromptClass=function(t){var n;return(n={},n[i.PromptStyle.Native]=s.NativePrompt,n[i.PromptStyle.Slide]=s.SlidePrompt,n[i.PromptStyle.Bell]=s.BellPrompt,n[i.PromptStyle.Custom]=s.CustomPrompt,n)[t]},n._selectEligiblePrompts=function(t){var n,e=this,r=[],i=t.user.env.getCurrentLocation().href||"",s=t.user.env.getCurrentMetaKeywords(),o=t.user.env.getBrowser(),u=t.domain.promptGroups,c=t.domain.prompts;if(u.sort(function(t,n){return t.priority>n.priority?1:t.priority<n.priority?-1:0}).some(function(n){var u,a=c.filter(function(t){return t.prompt_group_id===n.id}),f=!0;if(n.conditions_json&&((u=e._validatePromptConditions(t,n,o,i,s)).matched||(f=!1)),f&&a.length>0){var h=1===a.length?a[0]:e._pickWeightedRandomPrompt(a);return r.push({group:n,prompt:h}),!0}if(u&&u.stopEvaluation)return!0}),r.length>0&&(n=r[0]),n&&n.group&&void 0!==n.group.display_to_pct){var a=n.group.display_to_pct;if(a<100)Math.floor(100*Math.random())>a&&(n=void 0)}return n?[n]:[]},n._validatePromptConditions=function(t,n,e,r,i){var s={matched:!0,stopEvaluation:!1};if(n.conditions_json){var o=n.conditions_json.display||{},u=n.conditions_json.page||{};if((s=this._validateDisplayConditions(o,e)).matched){var c=this._validateMetaKeywordConditions(u,i);s.matched=c.matched}if(s.matched){var a=this._validatePageUrlConditions(u,r);s.matched=a.matched}}return s.stopEvaluation&&s.stopEvaluationReason&&this.debugPromptNotShown(t,s.stopEvaluationReason),s},n._validateDisplayConditions=function(t,n){var e={matched:!0,stopEvaluation:!1};if(t.mobile||t.desktop){var r="desktop"===(n.platform||{}).type;!r&&e.matched&&t.mobile&&("pass"===t.mobile&&(e.matched=!1),"disabled"===t.mobile&&(e.matched=!1,e.stopEvaluation=!0,e.stopEvaluationReason="platform_disabled_mobile")),r&&e.matched&&t.desktop&&("pass"===t.desktop&&(e.matched=!1),"disabled"===t.desktop&&(e.matched=!1,e.stopEvaluation=!0,e.stopEvaluationReason="platform_disabled_desktop"))}return e},n._validateMetaKeywordConditions=function(t,n){var e={matched:!0,stopEvaluation:!1};if(e.matched&&Array.isArray(t.keywords))if(0===n.length)e.matched=!1;else{var r=!1;t.keywords.some(function(t){if(-1!==n.indexOf(t))return r=!0,!0}),e.matched=r}return e},n._validatePageUrlConditions=function(t,n){var e={matched:!0,stopEvaluation:!1};if(e.matched&&t.excluded_page_urls){var r=!1;Array.isArray(t.excluded_page_urls)&&t.excluded_page_urls.length>0&&t.excluded_page_urls.some(function(t){if(new RegExp(t.replace(/\+/,"\\+"),"i").test(n))return r=!0,!0}),e.matched=!r}if(e.matched&&t.page_urls){var i=!1;Array.isArray(t.page_urls)&&t.page_urls.length>0?t.page_urls.some(function(t){if(new RegExp(t.replace(/\+/,"\\+"),"i").test(n))return i=!0,!0}):i=!0,e.matched=i}return e},n._pickWeightedRandomPrompt=function(t){for(var n=[],e=0,r=t;e<r.length;e++)for(var i=r[e],s=0;s<i.weight;s++)n.push(i);return n[Math.floor(Math.random()*n.length)]},n}(o.Events.EventableModel);n.PromptFactory=c},"./src/sdk/flows/amp-frame-helper.flow.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/enums/index.ts"),u=e("./src/sdk/services/index.ts"),c=e("./src/sdk/flows/amp.flow.ts"),a=e("./src/sdk/models/index.ts"),f=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._wireEvents=function(){var t=this._handlePermissionStateMessage.bind(this),n=this._handleWorkerStateMessage.bind(this),e=this._handleStorageGetMessage.bind(this),r=this._handleWorkerRegistrationMessage.bind(this),i=this._handleWorkerQueryMessage.bind(this);this.messenger.watch(o.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,t),this.messenger.watch(o.AmpMessageTopic.SERVICE_WORKER_STATE,n),this.messenger.watch(o.AmpMessageTopic.SERVICE_WORKER_REGISTRATION,r),this.messenger.watch(o.AmpMessageTopic.SERVICE_WORKER_QUERY,i),this.messenger.watch(o.AmpMessageTopic.STORAGE_GET,e),this.messenger.listen()},n.prototype.run=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,u.WorkerService.registerWorker(this.context)];case 1:return t.sent(),[4,this.dispatch(new a.Events.EventModel(o.EventType.FLOW_LOADED))];case 2:return t.sent(),[2]}})})},n.prototype._handlePermissionStateMessage=function(t){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,t.reply(!0)];case 1:return n.sent(),[2]}})})},n.prototype._handleWorkerStateMessage=function(t){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,t.reply({isControllingFrame:!!window.navigator.serviceWorker.controller,url:window.navigator.serviceWorker.controller?window.navigator.serviceWorker.controller.scriptURL:null,state:window.navigator.serviceWorker.controller?window.navigator.serviceWorker.controller.state:null})];case 1:return n.sent(),[2]}})})},n.prototype._handleWorkerRegistrationMessage=function(t){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,t.reply()];case 1:return n.sent(),[2]}})})},n.prototype._handleWorkerQueryMessage=function(t){return i(this,void 0,void 0,function(){var n,e,r;return s(this,function(i){switch(i.label){case 0:switch(n=this.context.user,e=t.data,r=null,e.topic){case o.AmpWorkerMessageTopic.AMP_SUBSCRIPTION_STATE:return[3,1];case o.AmpWorkerMessageTopic.AMP_UNSUBSCRIBE:return[3,2];case o.AmpWorkerMessageTopic.AMP_SUBSCRIBE:return[3,4]}return[3,5];case 1:return r=n.isSubscribed(),[3,5];case 2:return[4,u.RegistrationService.unsubscribe(this.context)];case 3:return i.sent(),[3,5];case 4:return[3,5];case 5:return[4,t.reply(r)];case 6:return i.sent(),[2]}})})},n.prototype._handleStorageGetMessage=function(t){return i(this,void 0,void 0,function(){var n,e;return s(this,function(r){switch(r.label){case 0:return n=this.context.user,e=o.NotificationPermissionState.DEFAULT,n.isSubscribed()?(e=o.NotificationPermissionState.GRANTED,"subscribed"===n.subscriberState?[3,3]:[4,u.UserService.reloadUserWithCachePriority(n)]):[3,3];case 1:return r.sent(),[4,this.dispatch(new a.Events.EventModel(o.EventType.REGISTRATION_SUBSCRIBED,n.token))];case 2:r.sent(),r.label=3;case 3:return n.isBlocked()||n.isDismissed()?(e=o.NotificationPermissionState.DENIED,"none"!==n.subscriberState?[3,5]:[4,this.dispatch(new a.Events.EventModel(o.EventType.PERMISSION_DENIED))]):[3,5];case 4:r.sent(),r.label=5;case 5:return[4,t.reply(e)];case 6:return r.sent(),[2]}})})},n}(c.AmpFlow);n.AmpFrameHelperFlow=f},"./src/sdk/flows/amp-permission-dialog.flow.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/enums/index.ts"),u=e("./src/sdk/services/index.ts"),c=e("./src/sdk/flows/amp.flow.ts"),a=e("./src/sdk/constants.ts"),f=e("./src/sdk/models/index.ts"),h=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._wireEvents=function(){var t=this._handlePermissionGranted.bind(this),n=this._handlePermissionDenied.bind(this);this.watch(o.EventType.REGISTRATION_SUBSCRIBED,t),this.watch(o.EventType.PERMISSION_DENIED,n),this.watch(o.EventType.PERMISSION_DISMISSED,n)},n.prototype.run=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,u.WorkerService.registerWorker(this.context)];case 1:return t.sent(),this._loadFrameHelper(),[4,this.dispatch(new f.Events.EventModel(o.EventType.FLOW_LOADED))];case 2:return t.sent(),[2]}})})},n.prototype._loadFrameHelper=function(){var t=this;if(window.opener){this.messenger.connect(window.opener);var n=this.context.domain.domainKey,e=document.createElement("iframe"),r=a.PROXY_URL+"/amp/"+n+"?pushly_domain_key="+n;e.addEventListener("load",function(){return i(t,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this._initializeDialogContent(e.contentWindow),[4,u.RegistrationService.performManualRegistrationAttempt(this.context,999)];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),u.Logger.error(this.context,t),[3,3];case 3:return[2]}})})}),e.setAttribute("src",r),e.setAttribute("frame-border","0"),e.setAttribute("style","width: 100vw; height: 100vh; border: none;"),document.body.appendChild(e)}},n.prototype._initializeDialogContent=function(t){t.postMessage({action:"lite-reboot",data:{context:this.context}},"*")},n.prototype._handlePermissionGranted=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.messenger.send(o.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,o.NotificationPermissionState.GRANTED)];case 1:return t.sent(),window.close(),[2]}})})},n.prototype._handlePermissionDenied=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.messenger.send(o.AmpMessageTopic.NOTIFICATION_PERMISSION_STATE,o.NotificationPermissionState.DENIED)];case 1:return t.sent(),window.close(),[2]}})})},n}(c.AmpFlow);n.AmpPermissionDialogFlow=h},"./src/sdk/flows/amp.flow.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./src/sdk/services/index.ts"),s=function(t){function n(n){var e=t.call(this,n,!0)||this;return e._setAmpMessenger(),e._wireEvents(),e}return r(n,t),n.prototype._setAmpMessenger=function(){this.messenger=i.AmpMessagingService},n}(e("./src/sdk/flows/base.flow.ts").BaseFlow);n.AmpFlow=s},"./src/sdk/flows/base.flow.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/utils.ts"),u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/models/index.ts"),a=e("./src/sdk/services/index.ts"),f=e("./src/sdk/data-providers/index.ts"),h=function(t){function n(n,e){void 0===e&&(e=!1);var r=t.call(this)||this;return r.context=n,r.isAmp=e,r.isAmp||r._wireEvents(),r}return r(n,t),n.prototype._startPageChangeTracker=function(){var t,n=this,e=function(){var e=n.context.user.env.getCurrentLocation().href;e!=t&&(n._logSessionPageView(e),n.context.user.isSubscribed({websitePushId:n.context.domain.getWebsitePushId()})&&n.post(new c.Events.StreamableEventModel(u.StreamableEventType.PAGE_VIEW,{},n.context))),t=e};setInterval(function(){return e()},100),e()},n.prototype._logSessionPageView=function(t){return i(this,void 0,void 0,function(){var n,e,r,i,u;return s(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),n=o.hashFromString(t),e=f.SessionDataProvider.currentSession.pageViews||[],r=0===e.length,i=!r&&e[e.length-1]!==n,(r||i)&&(u=e.concat([n]),f.SessionDataProvider.set("pageViews",u)),[4,this._updateUserLifetimeViewedKeywordMap()];case 1:return s.sent(),[3,3];case 2:return s.sent(),[3,3];case 3:return[2]}})})},n.prototype._updateUserLifetimeViewedKeywordMap=function(){return i(this,void 0,void 0,function(){var t,n,e,r,i;return s(this,function(s){switch(s.label){case 0:for(t=this.context.user.env.getCurrentMetaKeywords(),n=this.context.user.lifetimeViewedKeywordMap||{},e=0,r=t;e<r.length;e++)i=r[e],n[i]=(n[i]||0)+1;return[4,a.UserService.setLifetimeViewedKeywordMap(this.context.user,n)];case 1:return s.sent(),[2]}})})},n}(c.Events.EventableModel);n.BaseFlow=h},"./src/sdk/flows/direct.flow.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/flows/base.flow.ts"),u=e("./src/sdk/exceptions/index.ts"),c=e("./src/sdk/enums/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/services/index.ts"),h=e("./src/sdk/constants.ts"),d=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._wireEvents=function(){},n.prototype.run=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:if(this.context.user.env.primaryRuntimeEnvironment===c.RuntimeEnvironment.PROXY)return[3,4];if(this.context.user.env.isSafari())return[3,2];if(!this.context.user.env.isHTTPS())throw new u.ExitException(c.ExceptionMessage.DIRECT_INTEGRATION_NOT_SECURE);return[4,f.WorkerService.registerWorker(this.context)];case 1:t.sent(),t.label=2;case 2:return[4,f.RegistrationService.tryMigration(this.context)];case 3:t.sent(),t.label=4;case 4:return this._startPageChangeTracker(),[4,this._initStylesheet()];case 5:return t.sent(),[4,this.dispatch(new a.Events.EventModel(c.EventType.FLOW_LOADED))];case 6:return t.sent(),[2]}})})},n.prototype._initStylesheet=function(){return i(this,void 0,void 0,function(){var t,n,e=this;return s(this,function(r){return t=this.context.user.env,n=t.getCurrentDocument(),[2,new Promise(function(r,i){var s=n.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=h.CSS_URL+"?domain_key="+e.context.domain.domainKey,t.isLocal()&&t.isHTTPS()&&/http:/i.test(s.href)&&(s.href=s.href.replace("http:","https:")),s.addEventListener("load",function(){return r()}),n.head.appendChild(s)}).then(function(){}).catch(function(t){return f.Logger.error(t)})]})})},n}(o.BaseFlow);n.DirectFlow=d},"./src/sdk/flows/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/flows/base.flow.ts");n.Flow=r.BaseFlow;var i=e("./src/sdk/flows/direct.flow.ts");n.DirectFlow=i.DirectFlow;var s=e("./src/sdk/flows/proxy.flow.ts");n.ProxyFlow=s.ProxyFlow;var o=e("./src/sdk/flows/proxy-permission-dialog.flow.ts");n.ProxyPermissionDialogFlow=o.ProxyPermissionDialogFlow;var u=e("./src/sdk/flows/amp-permission-dialog.flow.ts");n.AmpPermissionDialogFlow=u.AmpPermissionDialogFlow;var c=e("./src/sdk/flows/amp-frame-helper.flow.ts");n.AmpFrameHelperFlow=c.AmpFrameHelperFlow},"./src/sdk/flows/proxy-permission-dialog.flow.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/services/index.ts"),u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/flows/base.flow.ts"),a=e("./src/sdk/models/index.ts"),f=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._wireEvents=function(){var t=this._handlePermissionPrompted.bind(this),n=this._handlePermissionGranted.bind(this),e=this._handlePermissionDismissed.bind(this),r=this._handlePermissionDenied.bind(this);this.watch(u.EventType.PERMISSION_DIALOG_SHOWN,t),this.watch(u.EventType.REGISTRATION_SUBSCRIBED,n),this.watch(u.EventType.PERMISSION_DISMISSED,e),this.watch(u.EventType.PERMISSION_DENIED,r)},n.prototype.run=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.context.user.env.isSafari()?[3,2]:[4,o.WorkerService.registerWorker(this.context)];case 1:t.sent(),t.label=2;case 2:return[4,this.dispatch(new a.Events.EventModel(u.EventType.FLOW_LOADED))];case 3:return t.sent(),[2]}})})},n.prototype._handlePermissionPrompted=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return this._postMessage(u.EventType.PERMISSION_DIALOG_SHOWN,void 0,!1),[2]})})},n.prototype._handlePermissionGranted=function(t){return i(this,void 0,void 0,function(){return s(this,function(n){return this._postMessage(u.EventType.REGISTRATION_SUBSCRIBED,t),[2]})})},n.prototype._handlePermissionDismissed=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return this._postMessage(u.EventType.PERMISSION_DISMISSED),[2]})})},n.prototype._handlePermissionDenied=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return this._postMessage(u.EventType.PERMISSION_DENIED),[2]})})},n.prototype._postMessage=function(t,n,e){void 0===e&&(e=!0);try{window.opener.postMessage({action:t,data:n},"*")}catch(t){o.Logger.warn(t)}finally{e&&this._closeWindow()}},n.prototype._closeWindow=function(){setTimeout(function(){window.close()})},n}(c.BaseFlow);n.ProxyPermissionDialogFlow=f},"./src/sdk/flows/proxy.flow.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/services/index.ts"),u=e("./src/sdk/models/index.ts"),c=e("./src/sdk/enums/index.ts"),a=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._wireEvents=function(){var t=this._handleWindowMessage.bind(this);window.addEventListener("message",t)},n.prototype.run=function(){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,o.UserService.reloadUserWithCachePriority(this.context.user)];case 1:return n.sent(),[4,t.prototype.run.call(this)];case 2:return n.sent(),[2]}})})},n.prototype._handleWindowMessage=function(t){return i(this,void 0,void 0,function(){var n,e,r,i;return s(this,function(s){switch(s.label){case 0:if(s.trys.push([0,12,,13]),n=this.context.domain,!(-1!==t.origin.indexOf(n.customAllowDomain)))return[3,11];switch(e=t.data.action,r=t.data.data,o.Logger.info("Got message from proxy window: "+e),e){case c.EventType.PERMISSION_DIALOG_SHOWN:return[3,1];case c.EventType.REGISTRATION_SUBSCRIBED:return[3,3];case c.EventType.PERMISSION_DISMISSED:return[3,5];case c.EventType.PERMISSION_DENIED:return[3,7]}return[3,9];case 1:return[4,this._handlePermissionPrompted()];case 2:return s.sent(),[3,9];case 3:return[4,this._handlePermissionAccepted(r)];case 4:return s.sent(),[3,9];case 5:return[4,this._handlePermissionDismissed()];case 6:return s.sent(),[3,9];case 7:return[4,this._handlePermissionDenied()];case 8:return s.sent(),[3,9];case 9:return[4,this.dispatch(new u.Events.EventModel(e,r))];case 10:s.sent(),s.label=11;case 11:return[3,13];case 12:return i=s.sent(),o.Logger.error(this.context,i),[3,13];case 13:return[2]}})})},n.prototype._handlePermissionPrompted=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return this.dispatch(new u.Events.EventModel(c.EventType.PERMISSION_DIALOG_SHOWN,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),[2]})})},n.prototype._handlePermissionAccepted=function(t){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return this.dispatch(new u.Events.EventModel(c.EventType.PERMISSION_GRANTED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),[4,o.UserService.setSubscriptionState(this.context.user,"subscribed",t)];case 1:return n.sent(),[2]}})})},n.prototype._handlePermissionDismissed=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.dispatch(new u.Events.EventModel(c.EventType.PERMISSION_DISMISSED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),[4,o.UserService.setSubscriptionState(this.context.user,"dismissed")];case 1:return t.sent(),[2]}})})},n.prototype._handlePermissionDenied=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.dispatch(new u.Events.EventModel(c.EventType.PERMISSION_DENIED,this._buildClientFeedbackEventPack(this.context.user.lastSeenPromptId))),[4,o.UserService.setSubscriptionState(this.context.user,"blocked")];case 1:return t.sent(),[2]}})})},n.prototype._buildClientFeedbackEventPack=function(t,n){return void 0===t&&(t=null),void 0===n&&(n=[]),{prompt:{id:t,keywords:n}}},n}(e("./src/sdk/flows/direct.flow.ts").DirectFlow);n.ProxyFlow=a},"./src/sdk/models/application/app.model.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/constants.ts"),i=function(){return function(){this.env=r.ENV_NAME,this.version=r.PUSHLY_APPLICATION_VERSION,this.classNames={},this.isLoaded=!1,this.isDisabled=!1,this.isVisibleLoggingEnabled=!1,this.isLocalProfileHashed=!0,this.isFirebaseAppInitialized=!1}}();n.AppModel=i},"./src/sdk/models/application/environment.model.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./src/sdk/utils.ts"),o=e("./node_modules/bowser/es5.js"),u=function(){function t(){}return t.prototype.getBrowser=function(){return o.getParser(window.navigator.userAgent).parsedResult||{}},t.prototype.getNavigator=function(){return self.navigator},t.prototype.getCurrentLocation=function(){return self.location},t.prototype.getCurrentDocument=function(){return self.document},t.prototype.getCurrentReferrer=function(){return(self.document||{}).referrer},t.prototype.getCurrentMetaTags=function(){var t,n=this.getCurrentDocument();return n&&(t=n.getElementsByTagName("meta")),t},t.prototype.getCurrentMetaKeywords=function(){var t=[],n=this.getCurrentMetaTags();if(n&&n.keywords){var e=n.keywords.content.split(",").map(function(t){return t.toString().trim().toLowerCase()});e&&e.length>0&&(t=e)}return t},t.prototype.getQueryString=function(){return s.parseQueryString(self.location.search)},t.prototype.getGlobalScope=function(){return this.inWorkerGlobalScope()?self:window},t.prototype.inWorkerGlobalScope=function(){return"WorkerGlobalScope"in self},t.prototype.isSafari=function(){return"safari"in self},t.prototype.isSafariPushCapable=function(){return this.isSafari()&&"pushNotification"in self.safari},t.prototype.isArrayFullySupported=function(){return"Array"in self&&"from"in Array&&"some"in[]},t.prototype.isSecure=function(){return this.isHTTPS()||this.isLocal()},t.prototype.isHTTPS=function(){return"https:"===self.location.protocol},t.prototype.isLocal=function(){return"localhost"===self.location.hostname||"127.0.0.1"===self.location.hostname},t.prototype.isCookieCapable=function(){return!this.inWorkerGlobalScope()},t.prototype.getPushPermission=function(t){void 0===t&&(t={});var n={permission:"default"};if(this.isSafari()){if(!("websitePushId"in t))throw new Error("websitePushId must be provided for Safari permission check.");n=self.safari.pushNotification.permission(t.websitePushId)||n}else n=self.Notification||n;return n},t.prototype.getPushPermissionState=function(t){return void 0===t&&(t={}),this.getPushPermission(t).permission},t.prototype.isPushPermissionGranted=function(t){return void 0===t&&(t={}),"granted"===this.getPushPermissionState(t)},t.prototype.isPushSupported=function(){return r(this,void 0,void 0,function(){var t,n,e,r,s;return i(this,function(i){switch(i.label){case 0:if(t="location"in self&&"navigator"in self&&"userAgent"in self.navigator&&"indexedDB"in self&&self.navigator.cookieEnabled&&this.isArrayFullySupported())try{t=t&&!!self.location.host&&!!self.location.hostname&&!!self.location.hostname.split("")}catch(n){t=!1}return t&&(e=(n=/bot|HeadlessChrome|googlebot|crawler|spider|robot|crawling/im).test(self.navigator.userAgent)||n.test(self.navigator.appVersion)||n.test(self.navigator.appCodeName)||n.test(self.navigator.product),r=/iphone|ipad/i.test(self.navigator.userAgent)||self.navigator.platform&&/iphone|ipad/i.test(self.navigator.platform),t=t&&!e&&!r),t?"webkitRequestFileSystem"in self?(s=t)?[4,new Promise(function(t,n){self.webkitRequestFileSystem(0,0,function(){return t(!0)},function(){return t(!1)})})]:[3,2]:[3,3]:[3,3];case 1:s=i.sent(),i.label=2;case 2:t=s,i.label=3;case 3:return t?this.isSafari()?(t=this.isSafariPushCapable(),[3,9]):[3,4]:[3,9];case 4:if(!(t="navigator"in self&&"PushManager"in self)||!this.isHTTPS())return[3,9];t=t&&"ServiceWorker"in self&&"serviceWorker"in self.navigator,i.label=5;case 5:return i.trys.push([5,8,,9]),t?[4,navigator.serviceWorker.getRegistration()]:[3,7];case 6:i.sent(),i.label=7;case 7:return[3,9];case 8:return i.sent(),t=!1,[3,9];case 9:return[2,t]}})})},t}();n.EnvironmentModel=u},"./src/sdk/models/application/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/models/application/app.model.ts");n.AppModel=r.AppModel;var i=e("./src/sdk/models/application/environment.model.ts");n.EnvironmentModel=i.EnvironmentModel},"./src/sdk/models/context.model.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(){}}();n.ContextModel=r},"./src/sdk/models/domains/domain.model.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.DAYS="days",t.HOURS="hours",t.MINUTES="minutes"}(n.DomainFrequencyCapMetric||(n.DomainFrequencyCapMetric={}));var r=function(){function t(){this.flags=[],this.promptGroups=[],this.prompts=[],this.isCached=!1}return t.prototype.shouldUseCustomVapidKey=function(){return Array.isArray(this.flags)&&-1!==this.flags.indexOf("FEAT_CUSTOM_VAPID")&&!!this.vapidPublicKey},t.prototype.hasApnsConfig=function(){return!!this.apnsConfiguration},t.prototype.isApnsConfigEnabled=function(){return this.hasApnsConfig()&&!0===this.apnsConfiguration.is_active},t.prototype.getPushPackageSettings=function(){return(this.apnsConfiguration||{}).push_package||{}},t.prototype.getWebsitePushId=function(){return this.getPushPackageSettings().website_push_id},t}();n.DomainModel=r},"./src/sdk/models/domains/global-prompt-referrer-conditions.model.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/enums/index.ts").PromptReferrerCondition.IGNORE,i=function(){function t(){this.persist_ttl_seconds=259200}return t.parse=function(n){var e=new t;return n=n||{},e.enabled=n.enabled||!1,e.persist_ttl_seconds=n.persist_ttl_seconds||e.persist_ttl_seconds,e.when_self=n.when_self||r,e.when_blank=n.when_blank||r,e.allowed=n.allowed||void 0,e.blocked=n.blocked||void 0,e},t}();n.GlobalPromptReferrerConditionsModel=i},"./src/sdk/models/domains/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/models/domains/domain.model.ts");n.DomainModel=r.DomainModel;var i=e("./src/sdk/models/domains/global-prompt-referrer-conditions.model.ts");n.GlobalPromptReferrerConditionsModel=i.GlobalPromptReferrerConditionsModel},"./src/sdk/models/events/event.model.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];this.type=t,this.data=n}}();n.EventModel=r},"./src/sdk/models/events/eventable.model.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./src/sdk/utils.ts"),o=e("./src/sdk/enums/index.ts"),u=e("./src/sdk/data-providers/index.ts"),c=e("./src/sdk/models/events/streamable-event.model.ts"),a=e("./src/sdk/constants.ts"),f=e("./src/sdk/data-providers/index.ts"),h=function(){function t(){this.e=s.randomString()}return t.post=function(t,n){return r(this,void 0,void 0,function(){var e;return i(this,function(r){switch(r.label){case 0:return[4,t.getRequestObject(n)];case 1:return e=r.sent(),[2,f.ApiDataProvider.exec(e.endpoint,e.method,e.headers,e.body)]}})})},t.debug=function(t,n,e,s){return r(this,void 0,void 0,function(){var r,s,f,h,d,l,v,p,b;return i(this,function(i){try{if(-1!==a.DEBUG_EVENT_DOMAIN_WHITELIST.indexOf(t.domainKey)&&(r=!0,s="pushly.user_debugEvent",f=String(n),h={},n===o.StreamableEventType.PROMPT_NOT_SHOWN&&(s="pushly.user_promptNotShownReason",f=e,h={prompt_not_shown_reason:e||"unknown"}),d=new RegExp(s+"=([^;]+)","i"),(l=document.cookie.match(d))&&l[1]&&l[1]===f&&(r=!1),r))return v=new Date,p=Date.UTC(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate()+1),b=new Date(p).toUTCString(),u.CookieDataProvider.setWithRawExpires(s,f,b),[2,this.post(new c.StreamableEventModel(n,{meta:h},t))]}catch(t){}return[2]})})},t.debugPromptNotShown=function(t,n){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,this.debug(t,o.StreamableEventType.PROMPT_NOT_SHOWN,n)]})})},t.prototype.watch=function(t,n){u.EventManager.on(t,n)},t.prototype.watchOnce=function(t,n){u.EventManager.once(t,n)},t.prototype.unwatch=function(t,n){u.EventManager.unregisterCallback(t,n)},t.prototype.dispatch=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,u.EventManager.dispatch(t)];case 1:return n.sent(),[2]}})})},t.prototype.post=function(n,e){return r(this,void 0,void 0,function(){return i(this,function(r){return[2,t.post(n,e)]})})},t.prototype.debug=function(n,e,s,o){return r(this,void 0,void 0,function(){return i(this,function(r){return[2,t.debug(n,e,s,o)]})})},t.prototype.debugPromptNotShown=function(n,e){return r(this,void 0,void 0,function(){return i(this,function(r){return[2,t.debugPromptNotShown(n,e)]})})},t}();n.EventableModel=h},"./src/sdk/models/events/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/models/events/event.model.ts");n.EventModel=r.EventModel;var i=e("./src/sdk/models/events/eventable.model.ts");n.EventableModel=i.EventableModel;var s=e("./src/sdk/models/events/streamable-event.model.ts");n.StreamableEventModel=s.StreamableEventModel},"./src/sdk/models/events/streamable-event.model.ts":function(t,n,e){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/utils.ts"),u=e("./src/sdk/constants.ts"),c=e("./src/sdk/data-providers/index.ts"),a=function(){function t(t,n,e){this.type=t,this.id=o.randomString(),this.featFlags=[],e=e||{};var i,s,a,f,h,d,l,v,p=this.featFlags;if(e.domain&&(i=e.domain.id,p=e.domain.flags||p),e.user){s=e.user.doNotTrackFlags,a=e.user.puuid,f=e.user.token,h=e.user.lastSeenPromptId,d=e.user.isPageViewTrackable()?e.user.env.getCurrentLocation().href:void 0;try{l=Intl.DateTimeFormat().resolvedOptions().locale,v=e.user.isLocationTrackable()?Intl.DateTimeFormat().resolvedOptions().timeZone:void 0}catch(t){}}if(!a)try{var b=c.CookieDataProvider.get("pushly.user_puuid");b||(b=o.randomString(),c.CookieDataProvider.set("pushly.user_puuid",b)),a=b}catch(t){}this.data=r({},n,{action:t,domain_id:i,domain_key:e.domainKey,event_date:(new Date).toISOString(),do_not_track:s,meta:r({},n.meta,{event_id:this.id,source:{application:u.PUSHLY_SDK_APPLICATION_NAME,version:u.PUSHLY_APPLICATION_VERSION},pushly_unique_user_id:a})}),"safari"in self?this.data.meta.apns_token=f:this.data.meta.fcm_subscription_id=f,n.meta&&(this.data.meta.prompt_id=n.meta.promptId,this.data.meta.prompt_id||(this.data.meta.prompt_id=h),delete this.data.meta.promptId),this.data.meta.page_url=d,this.data.meta.language=l,this.data.meta.time_zone=v,this.featFlags=p}return t.prototype.getRequestObject=function(t){return i(this,void 0,void 0,function(){return s(this,function(n){return[2,{endpoint:t||u.EVENTS_ENDPOINT,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(this.data)}]})})},t}();n.StreamableEventModel=a},"./src/sdk/models/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/models/application/index.ts");n.Application=r;var i=e("./src/sdk/models/domains/index.ts");n.Domain=i;var s=e("./src/sdk/models/users/index.ts");n.User=s;var o=e("./src/sdk/models/events/index.ts");n.Events=o;var u=e("./src/sdk/models/context.model.ts");n.ContextModel=u.ContextModel},"./src/sdk/models/users/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/models/users/user.model.ts");n.UserModel=r.UserModel},"./src/sdk/models/users/user.model.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(){this.doNotTrackFlags=[],this.createdAt=(new Date).getTime(),this.updatedAt=(new Date).getTime(),this.subscriberState="none"}return t.of=function(n){var e=new t;return Object.assign(e,n),e.subscriberState||(e.subscriberState="none"),e},t.prototype.isUnsubscribed=function(t){return void 0===t&&(t={}),"unsubscribed"===this.subscriberState&&"default"===this.env.getPushPermissionState(t)},t.prototype.isSubscribed=function(t){return void 0===t&&(t={}),"subscribed"===this.subscriberState||this.env.isPushPermissionGranted(t)},t.prototype.isDismissed=function(){return"dismissed"===this.subscriberState},t.prototype.isBlocked=function(){return"blocked"===this.subscriberState},t.prototype.isEligibleToPrompt=function(t){return void 0===t&&(t={}),!this.isSubscribed(t)&&!this.isDismissed()&&!this.isBlocked()},t.prototype.isLocationTrackable=function(){return-1===(this.doNotTrackFlags||[]).indexOf("location")},t.prototype.isPageViewTrackable=function(){return-1===(this.doNotTrackFlags||[]).indexOf("page_view")},t}();n.UserModel=r},"./src/sdk/prompts/base.prompt.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},s=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var u=e("./src/sdk/utils.ts"),c=e("./src/sdk/enums/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/services/index.ts"),h=e("./src/sdk/data-providers/index.ts"),d=function(t){function n(n,e,r){void 0===r&&(r=!0);var i=t.call(this)||this;return i.context=n,i.settings=e,i.envSupported=r,i.userReferrerIsAllowed=!0,i.bypassEligibilityCheck=!1,r&&(f.Logger.info("Preloading "+i.style+" prompt "+i.promptId+", "+i.name),i._wireEvents()),i}return r(n,t),Object.defineProperty(n.prototype,"groupId",{get:function(){return this.settings.group.id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"promptId",{get:function(){return this.settings.prompt.id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"style",{get:function(){return this.settings.prompt.style},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){var t=this.settings.group.name;return this.settings.prompt.name&&(t=t+" - "+this.settings.prompt.name),t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"promptConfig",{get:function(){return this.settings.prompt.config||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"promptConditions",{get:function(){return this.settings.prompt.conditions_json||{}},enumerable:!0,configurable:!0}),n.prototype.isNativePrompt=function(){return this.style===c.PromptStyle.Native},n.prototype.isSlidePrompt=function(){return this.style===c.PromptStyle.Slide},n.prototype.isBellPrompt=function(){return this.style===c.PromptStyle.Bell},Object.defineProperty(n.prototype,"isUserSubscribed",{get:function(){return this.context.user.isSubscribed({websitePushId:this.context.domain.getWebsitePushId()})},enumerable:!0,configurable:!0}),n.prototype.run=function(t){return s(this,void 0,void 0,function(){var n;return o(this,function(e){switch(e.label){case 0:return this.bypassEligibilityCheck=!!t&&!!t.bypassEligibilityCheck,n=this,[4,this._evaluateCurrentReferrer()];case 1:return n.userReferrerIsAllowed=e.sent(),[2]}})})},n.prototype._show=function(){return s(this,void 0,void 0,function(){return o(this,function(t){return f.Logger.info("Showing prompt "+this.promptId+", "+this.name),this.dispatch(new a.Events.EventModel(c.EventType.PROMPT_SHOWN,this._buildDispatchEventPack())),this._incrementUserPromptCount(),this._setLastSeenPromptId(),[2]})})},n.prototype._buildDispatchEventPack=function(){return{prompt:{id:this.promptId,keywords:[]},subscribed:this.isUserSubscribed}},n.prototype._buildPostEventPack=function(){return{meta:{promptId:this.promptId,subscribed:this.isUserSubscribed}}},n.prototype._incrementUserPromptCount=function(){try{var t=this.isNativePrompt()||this.isSlidePrompt(),n=!!this.context.domain&&!!this.context.domain.frequencyCaps&&!!this.context.domain.frequencyCaps.prompt;if(t&&n){var e=this.context.domain.frequencyCaps.prompt.fcap_seconds;if(e>0){var r=this.context.user.promptCountState,i=0,s=new Date;if(s.setTime(s.getTime()+1e3*e),r){var o=r.split("|");2===o.length&&(i=parseInt(o[0],10),s=o[1])}s instanceof Date&&(s=s.toUTCString()),f.UserService.setPromptState(this.context.user,e,i+1+"|"+s,s)}}}catch(t){f.Logger.warn("Encountered an error while updating prompt frequency cap",t)}},n.prototype._setLastSeenPromptId=function(){this.isUserSubscribed||f.UserService.setLastSeenPromptId(this.context.user,this.promptId)},n.prototype._canShow=function(){var t=this._isPlacementEnabled();return this._isUserEligibleToPrompt()&&t},n.prototype._isPlacementEnabled=function(){var t=!1,n="desktop"===(this.context.user.env.getBrowser().platform||{}).type,e=this.promptConfig.position||{},r="disabled"!==e.desktop,i="disabled"!==e.mobile;return(n&&r||!n&&i)&&(t=!0),t},n.prototype._isUserEligibleToPrompt=function(){var t=!1,n=this.context.user,e={websitePushId:this.context.domain.getWebsitePushId()};if(this.bypassEligibilityCheck)t=!0;else{var r=this.isBellPrompt()||this.context.user.isEligibleToPrompt({websitePushId:this.context.domain.getWebsitePushId()}),i=!0;r&&(this.isNativePrompt()||this.isSlidePrompt())&&(i=this._evaluateFcapConditions()),this.userReferrerIsAllowed?r?i?t=!0:this.debugPromptNotShown(this.context,"prompt_ineligible_fcap"):n.isBlocked()?this.debugPromptNotShown(this.context,"user_permission_denied"):n.isDismissed()?this.debugPromptNotShown(this.context,"user_permission_dismissed"):n.isSubscribed(e)?this.debugPromptNotShown(this.context,"user_permission_granted"):this.debugPromptNotShown(this.context,"user_ineligible"):this.debugPromptNotShown(this.context,"referrer_"+this.userReferrerState)}return t},n.prototype._evaluateRunConditions=function(){return s(this,void 0,void 0,function(){var t,n=this;return o(this,function(e){return t=1e3,[2,new Promise(function(e){return s(n,void 0,void 0,function(){var n,r,i,c,a,h,d,l,v=this;return o(this,function(p){switch(p.label){case 0:return n=this.promptConfig.behavior||{},r=this.promptConditions.visitor||{},i=!!r.time_on_page_seconds,c=!!r.session_page_views,a=!!r.session_time_on_site_seconds,c?(f.Logger.info("Prompt condition: Page views [at least "+r.session_page_views+" pages]"),[4,this._evaluateSessionPageViewConditions()]):[3,2];case 1:return p.sent()?e():h=setInterval(function(){return s(v,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this._evaluateSessionPageViewConditions()];case 1:return t.sent()&&(clearInterval(h),e()),[2]}})})},t),[3,6];case 2:return a?(f.Logger.info("Prompt condition: Time on site [at least "+r.session_time_on_site_seconds+" seconds]"),[4,this._evaluateSessionTimeOnSiteConditions()]):[3,4];case 3:return p.sent()?e():d=setInterval(function(){return s(v,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this._evaluateSessionTimeOnSiteConditions()];case 1:return t.sent()&&(clearInterval(d),e()),[2]}})})},t),[3,6];case 4:return l=n.delay_seconds||0,i&&(l=r.time_on_page_seconds||0,f.Logger.info("Prompt condition: Time on page [at least "+l+" seconds]")),[4,u.delay(1e3*l)];case 5:p.sent(),e(),p.label=6;case 6:return[2]}})})})]})})},n.prototype._evaluateSessionPageViewConditions=function(){return s(this,void 0,void 0,function(){var t,n;return o(this,function(e){switch(e.label){case 0:return t=!1,n=this.promptConditions.visitor.session_page_views,h.SessionDataProvider.getCurrentTotalPageViews()>=n&&(t=!0),t?[4,this._evaluateVisitorKeywordConstraint()]:[3,2];case 1:t=e.sent(),e.label=2;case 2:return[2,t]}})})},n.prototype._evaluateSessionTimeOnSiteConditions=function(){return s(this,void 0,void 0,function(){var t,n,e,r,i;return o(this,function(s){switch(s.label){case 0:return t=!1,n=Date.now(),e=h.SessionDataProvider.currentSession.sessionStart,r=(n-e)/1e3,i=this.promptConditions.visitor.session_time_on_site_seconds,r>=i&&(t=!0),t?[4,this._evaluateVisitorKeywordConstraint()]:[3,2];case 1:t=s.sent(),s.label=2;case 2:return[2,t]}})})},n.prototype._evaluateVisitorKeywordConstraint=function(){return s(this,void 0,void 0,function(){var t,n,e,r;return o(this,function(i){return t=!0,(n=this.promptConditions.visitor.viewed_keyword_constraint)&&n.keywords&&(Array.isArray(n.keywords)||(n.keywords=[n.keywords]),e=this.context.user.lifetimeViewedKeywordMap,!e||0===Object.keys(e).length?t=!1:(r=Object.keys(e).reduce(function(t,r){return-1!==n.keywords.indexOf(r)&&(t+=e[r]),t},0),void 0!==n.min_views&&n.min_views>0&&r<n.min_views&&(t=!1),void 0!==n.max_views&&n.max_views>0&&r>n.max_views&&(t=!1))),[2,t]})})},n.prototype._evaluateFcapConditions=function(){var t=!0,n=0;try{var e=this.isNativePrompt()||this.isSlidePrompt(),r=!!this.context.domain&&!!this.context.domain.frequencyCaps&&!!this.context.domain.frequencyCaps.prompt;if(e)if(r){var i=this.context.domain.frequencyCaps.prompt,s=this.context.user.promptCountState,o=this.context.user.promptFcapSeconds;if(String(o)!==String(i.fcap_seconds))f.UserService.clearPromptFcapState();else if(s){var c=s.split("|");if(2===c.length){var a=c[1];if((u.tryParseInt(c[0])||0)>=i.occurrences){t=!1;try{n=Math.floor((Date.parse(a)-(new Date).getTime())/1e3)}catch(t){}}}}}else f.UserService.clearPromptFcapState()}catch(t){f.Logger.warn("Encountered an error while checking prompt frequency cap")}return t||f.Logger.info("Prompt frequency cap has been met"+(n>0?" - "+n+" seconds remain":"")),t},n.prototype._evaluateCurrentReferrer=function(){return s(this,void 0,void 0,function(){var t,n,e,r,i;return o(this,function(s){switch(s.label){case 0:return t=!0,!0===this.bypassEligibilityCheck?[3,2]:(n=this.context.domain.globalPromptSettings)&&n.referrers?(e=n.referrers,(r=a.Domain.GlobalPromptReferrerConditionsModel.parse(e)).enabled?[4,this._evaluateReferrerConditions(r)]:[3,2]):[3,2];case 1:i=s.sent(),this.userReferrerState=i.referrerResponse,t=i.pass,s.label=2;case 2:return t||f.Logger.info("Based on client referrer, prompt, "+this.promptId+", is currently disabled"),[2,t]}})})},n.prototype._evaluateReferrerConditions=function(t){return s(this,void 0,void 0,function(){var n,e,r,i,s,u,a;return o(this,function(o){switch(o.label){case 0:return n={pass:!0,referrerResponse:c.PromptReferrerCondition.ALLOW},e=this.context.user.env.getCurrentReferrer(),r=this.context.user.lastReferrerState,[4,this._evaluateExistingReferrerState(t,r,e)];case 1:return i=o.sent(),r&&!i.updateRequired&&(e=i.referrer),s=!e||""===e,u=String(e),a=!s&&-1!==u.indexOf(this.context.domain.name),n=s?this._evaluateSimpleReferrerCondition(t.when_blank,n):a?this._evaluateSimpleReferrerCondition(t.when_self,n):this._evaluateExternalReferrerConditions(t,n,e),n.referrerResponse===c.PromptReferrerCondition.IGNORE||!i.updateRequired?[3,3]:[4,f.UserService.setLastReferrerState(this.context.user,u)];case 2:o.sent(),o.label=3;case 3:return[2,n]}})})},n.prototype._evaluateExistingReferrerState=function(t,n,e){return s(this,void 0,void 0,function(){var r,i,s,u;return o(this,function(o){switch(o.label){case 0:return r={referrer:e,updateRequired:!1},n&&n.lastSetAt?(i=new Date,s=(i.getTime()-n.lastSetAt)/1e3,u=t.persist_ttl_seconds||0,s>u?[3,1]:(r.referrer=n.referrer,[3,3])):[3,3];case 1:return[4,f.UserService.clearLastReferrerState(this.context.user)];case 2:o.sent(),r.updateRequired=!0,o.label=3;case 3:return[2,r]}})})},n.prototype._evaluateSimpleReferrerCondition=function(t,n){var e=i({},n);switch(t){case c.PromptReferrerCondition.IGNORE:e.pass=!1,e.referrerResponse=c.PromptReferrerCondition.IGNORE;break;case c.PromptReferrerCondition.BLOCK:e.pass=!1,e.referrerResponse=c.PromptReferrerCondition.BLOCK}return e},n.prototype._evaluateExternalReferrerConditions=function(t,n,e){var r=i({},n),s=!0,o=!0,u=!1,a=!1;return t.allowed&&(Array.isArray(t.allowed.contains)&&(o=t.allowed.contains.some(function(t){return-1!==e.indexOf(t)})),Array.isArray(t.allowed.exact)&&(s=t.allowed.exact.some(function(t){return e===t}))),t.blocked&&(Array.isArray(t.blocked.contains)&&(a=t.blocked.contains.some(function(t){return-1!==e.indexOf(t)})),Array.isArray(t.blocked.exact)&&(u=t.blocked.exact.some(function(t){return e===t}))),(s||o)&&!(u||a)||(r.pass=!1,r.referrerResponse=c.PromptReferrerCondition.BLOCK),r},n}(a.Events.EventableModel);n.BasePrompt=d},"./src/sdk/prompts/bell.prompt.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/prompts/dom.prompt.ts"),u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/services/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/constants.ts"),h={"top-left":"d-top-left","top-right":"d-top-right","bottom-right":"d-bottom-right","bottom-left":"d-bottom-left",disabled:"d-disabled"},d={"top-left":"m-top-left","top-right":"m-top-right","bottom-right":"m-bottom-right","bottom-left":"m-bottom-left",disabled:"m-disabled"},l=null,v=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._wireEvents=function(){var t=this._handleFlowLoaded.bind(this),n=this._handleShowPrompt.bind(this),e=this._handleHidePrompt.bind(this),r=this._handleSubscription.bind(this),i=this._handleUnsubscription.bind(this),s=[u.EventType.REGISTRATION_SUBSCRIBED,u.EventType.REGISTRATION_MIGRATED],o=[u.EventType.PERMISSION_DISMISSED,u.EventType.PERMISSION_DENIED];this.watch(u.EventType.FLOW_LOADED,t),this.watch(u.EventType.PROMPT_SHOW,n),this.watch(o,e),this.watch(s,r),this.watch(u.EventType.REGISTRATION_UNSUBSCRIBED,i)},n.prototype._wireElementEvents=function(){var t=this._handleButtonMouseOver.bind(this),n=this._handleButtonMouseOut.bind(this),e=this._handleButtonClick.bind(this),r=this._handleWindowResize.bind(this);this.svgBtn.addEventListener("mouseover",t),this.svgBtn.addEventListener("mouseout",n),this.svgBtn.addEventListener("click",e),!0===this.promptConfig.preview_mode&&this.svgBtn.removeEventListener("click",e),window.addEventListener("resize",r)},n.prototype.attachToDom=function(n){return i(this,void 0,void 0,function(){var e;return s(this,function(r){switch(r.label){case 0:return[4,t.prototype.attachToDom.call(this,n)];case 1:return r.sent(),this.parentReady&&(e=this._buildTemplate(),this.parent.appendChild(e),this._wireElementEvents()),[2]}})})},n.prototype.run=function(n){return void 0===n&&(n={}),i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,t.prototype.run.call(this,n)];case 1:return e.sent(),this._canShow()?(this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),[4,this._attemptToShow(!!this.bypassEligibilityCheck)]):[3,3];case 2:return e.sent(),[3,4];case 3:this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())),e.label=4;case 4:return[2]}})})},n.prototype._attemptToShow=function(t){return void 0===t&&(t=!1),i(this,void 0,void 0,function(){var n;return s(this,function(e){switch(e.label){case 0:return n=this.settings.prompt.is_auto_show||t,this._isPlacementEnabled()?[3,1]:(c.Logger.info("Current prompt is not enabled for this placement"),[3,4]);case 1:return this._canShow()&&n?[4,this._evaluateRunConditions()]:[3,4];case 2:return e.sent(),[4,this._show()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.prototype._show=function(){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,t.prototype._show.call(this)];case 1:return n.sent(),[2]}})})},n.prototype._buildTemplate=function(){if(this.element)return this.element;var t=["pushly_bell",this.isUserSubscribed?"subscribed":"not-subscribed",this.promptConfig.managed?"managed":"non-managed",h[this.promptTheme.position.desktop],d[this.promptTheme.position.mobile]];return this.element=this._createDivElement({className:t.join(" ")}),this.svgBtn=this._createSvgElement("0 0 512 512"),this.svgBtn.innerHTML=('\n<circle fill="'+this.promptTheme.primary_color+'" cx="256" cy="256" r="255.059" />\n<path fill="'+this.promptTheme.accent_color+'" d="M256,46.349C140.398,46.349,46.349,140.398,46.349,256c0,115.603,94.049,209.651,209.651,209.651\n    c115.603,0,209.651-94.049,209.651-209.651C465.651,140.398,371.603,46.349,256,46.349z M256,450.411\n    c-107.198,0-194.41-87.213-194.41-194.411c0-107.198,87.212-194.41,194.41-194.41c107.198,0,194.411,87.212,194.411,194.41\n    C450.411,363.198,363.198,450.411,256,450.411z" />\n<g>\n    <path fill="'+this.promptTheme.accent_color+'" d="M341.024,293.378v-58.851c0-41.452-28.823-76.096-67.492-85.197c-0.235-10.897-9.101-19.647-20.033-19.647\n        c-10.941,0-19.847,8.789-20.076,19.647c-38.669,9.101-67.495,43.745-67.495,85.197v58.851c-14.569,0-26.369,11.797-26.369,26.365\n        v18.603h227.829v-18.603C367.389,305.175,355.596,293.378,341.024,293.378z" />\n    <path fill="'+this.promptTheme.accent_color+'" d="M253.5,381.699c17.454,0,32.062-11.757,36.661-27.781h-73.376C221.393,369.942,236,381.699,253.5,381.699z" />\n</g>\n        ').trim(),this.tooltipContainer=this._createDivElement({className:"pushly_bell-tooltip-container"}),this.tooltipContainer.innerHTML=('\n<div class="pushly_bell-tooltip pushly_bell-tooltip-subscribed" '+(this.promptTheme.tooltip.subscribed?"":'style="display: none;"')+'>\n    <div class="pushly_bell-tooltip-arrow" style="background-color: '+this.promptTheme.primary_color+';"></div>\n    <div class="pushly_bell-tooltip-text" style="background-color: '+this.promptTheme.primary_color+"; color: "+this.promptTheme.accent_color+';">'+this.promptTheme.tooltip.subscribed+'</div>\n</div>\n<div class="pushly_bell-tooltip pushly_bell-tooltip-notsubscribed" '+(this.promptTheme.tooltip.unsubscribed?"":'style="display: none;"')+'>\n    <div class="pushly_bell-tooltip-arrow" style="background-color: '+this.promptTheme.primary_color+';"></div>\n    <div class="pushly_bell-tooltip-text" style="background-color: '+this.promptTheme.primary_color+"; color: "+this.promptTheme.accent_color+';">'+this.promptTheme.tooltip.unsubscribed+"</div>\n</div>\n        ").trim(),this.element.appendChild(this.svgBtn),this.element.appendChild(this.tooltipContainer),this._updateSize(),this.element},n.prototype._updateSize=function(){var t=this.promptTheme.size;window.innerWidth<f.MOBILE_MAX_SIZE&&this.promptTheme.mobile_size&&(t=this.promptTheme.mobile_size),this.svgBtn.setAttribute("height",t),this.svgBtn.style.height=t,this.svgBtn.setAttribute("width",t),this.svgBtn.style.width=t},n.prototype._handleFlowLoaded=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.run()];case 1:return t.sent(),[2]}})})},n.prototype._handleShowPrompt=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.context.app.loadConfig.manualPromptMode?[3,2]:this.element.classList.contains(f.DEFAULT_CLASSNAME_PROMPT_VISIBLE)?[3,2]:[4,this._attemptToShow(!0)];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype._handleHidePrompt=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._hide()];case 1:return t.sent(),[2]}})})},n.prototype._handleSubscription=function(){return i(this,void 0,void 0,function(){var t,n,e;return s(this,function(r){switch(r.label){case 0:return this.element.classList.add("subscribed"),(t=this.promptConfig.behavior)?(n=t.display_behavior===u.BellPromptDisplayBehavior.PRE_SUBSCRIPTION,e=t.display_behavior===u.BellPromptDisplayBehavior.POST_SUBSCRIPTION,n?[4,this._hide()]:[3,2]):[3,4];case 1:return r.sent(),[3,4];case 2:return e?[4,this._attemptToShow()]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},n.prototype._handleUnsubscription=function(){return i(this,void 0,void 0,function(){var t,n,e;return s(this,function(r){switch(r.label){case 0:return this.element.classList.remove("subscribed"),(t=this.promptConfig.behavior)?(n=t.display_behavior===u.BellPromptDisplayBehavior.PRE_SUBSCRIPTION,e=t.display_behavior===u.BellPromptDisplayBehavior.POST_SUBSCRIPTION,n?[4,this._attemptToShow()]:[3,2]):[3,4];case 1:return r.sent(),[3,4];case 2:return e?[4,this._hide()]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},n.prototype._handleButtonClick=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.isUserSubscribed?[3,2]:[4,this._allow()];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype._handleButtonMouseOver=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return this.element.classList.add("hover"),[2]})})},n.prototype._handleButtonMouseOut=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return this.element.classList.remove("hover"),[2]})})},n.prototype._handleWindowResize=function(){return i(this,void 0,void 0,function(){var t=this;return s(this,function(n){return l&&clearTimeout(l),l=setTimeout(function(){l=null,t._updateSize()},50),[2]})})},n}(o.DomPrompt);n.BellPrompt=v},"./src/sdk/prompts/custom.prompt.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/prompts/dom.prompt.ts"),u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/services/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/constants.ts"),h=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._wireEvents=function(){var t=this._handleShowPrompt.bind(this),n=this._handlePermissionGranted.bind(this),e=this._handlePermissionDenied.bind(this),r=[u.EventType.REGISTRATION_SUBSCRIBED,u.EventType.REGISTRATION_MIGRATED,u.EventType.PERMISSION_GRANTED,u.EventType.FOLLOWED],i=[u.EventType.PROMPT_DISMISSED,u.EventType.PERMISSION_DISMISSED,u.EventType.PERMISSION_DENIED];this.watch(u.EventType.PROMPT_SHOW,t),this.watch(r,n),this.watch(i,e)},n.prototype._locateAndAssignElement=function(){var t=this,n=setInterval(function(){var e=t.parent.getElementsByClassName(f.DEFAULT_CLASSNAME_PROMPT_CUSTOM);e&&e.length>0&&(clearInterval(n),t.element=e[0],t.envSupported?(t._setSupportedClassname(),t._setInitialSubscriptionClassname(),t._resolveKeywords(),t._assignButtonElements()):t._setUnsupportedClassname())},500)},n.prototype.attachToDom=function(){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,t.prototype.attachToDom.call(this)];case 1:return n.sent(),this._locateAndAssignElement(),[2]}})})},n.prototype.runInUnsupportedMode=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.attachToDom()];case 1:return t.sent(),[2]}})})},n.prototype._run=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return c.Logger.info("Custom prompt ready"),this._isUserEligibleToPrompt()?(this._setPromptEligibleClassname(),this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),[4,this._attemptToShow()]):[3,2];case 1:return t.sent(),[3,3];case 2:this._setPromptIneligibleClassname(),this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())),t.label=3;case 3:return[2]}})})},n.prototype._attemptToShow=function(t){return void 0===t&&(t=!1),i(this,void 0,void 0,function(){return s(this,function(t){return[2]})})},n.prototype._show=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return[2]})})},n.prototype._assignButtonElements=function(){var t=this.element.getElementsByClassName(f.DEFAULT_CLASSNAME_PROMPT_BTN_ALLOW),n=this.element.getElementsByClassName(f.DEFAULT_CLASSNAME_PROMPT_BTN_DISMISS);t&&t.length>0?(this.allowBtn=t[0],this.allowBtn.addEventListener("click",this._allow.bind(this))):c.Logger.warn("Prompt allow button cannot be located"),n&&n.length>0?(this.dismissBtn=n[0],this.dismissBtn.addEventListener("click",this._dismiss.bind(this))):c.Logger.warn("Prompt dismiss button cannot be located"),this._run()},n.prototype._getConfigClassNames=function(){return this.context.app.classNames||{}},n.prototype._setUnsupportedClassname=function(){var t=this._getConfigClassNames().webPushUnsupported||f.DEFAULT_CLASSNAME_WEB_PUSH_UNSUPPORTED;this.element.classList.contains(t)||this.element.classList.add(t)},n.prototype._setSupportedClassname=function(){var t=this._getConfigClassNames().webPushSupported||f.DEFAULT_CLASSNAME_WEB_PUSH_SUPPORTED;this.element.classList.contains(t)||this.element.classList.add(t)},n.prototype._setInitialSubscriptionClassname=function(){var t=this._getConfigClassNames().subscriptionNone||f.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE;this.context.user.isBlocked()||this.context.user.isDismissed()?t=this._getConfigClassNames().subscriptionDenied||f.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED:this.isUserSubscribed&&(t=this._getConfigClassNames().subscriptionSubscribed||f.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE),this.element.classList.contains(t)||this.element.classList.add(t)},n.prototype._setPromptEligibleClassname=function(){var t=this._getConfigClassNames().promptEligible||f.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE;this.element.classList.add(t)},n.prototype._setPromptIneligibleClassname=function(){var t=this._getConfigClassNames().promptIneligible||f.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE;this.element.classList.add(t)},n.prototype._setPromptCompositeSubscribedClassnames=function(){var t=this._getConfigClassNames().promptEligible||f.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE,n=this._getConfigClassNames().subscriptionNone||f.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE,e=this._getConfigClassNames().promptIneligible||f.DEFAULT_CLASSNAME_PROMPT_INELIGIBLE,r=this._getConfigClassNames().subscriptionSubscribed||f.DEFAULT_CLASSNAME_SUBSCRIPTION_TRUE;this.element.classList.remove(n),this.element.classList.add(r),this.element.classList.remove(t),this.element.classList.add(e)},n.prototype._setSubscriptionDeniedClassnames=function(){var t=this._getConfigClassNames().promptEligible||f.DEFAULT_CLASSNAME_PROMPT_ELIGIBLE,n=this._getConfigClassNames().subscriptionNone||f.DEFAULT_CLASSNAME_SUBSCRIPTION_NONE,e=this._getConfigClassNames().subscriptionDenied||f.DEFAULT_CLASSNAME_SUBSCRIPTION_DENIED;this.element.classList.remove(t),this.element.classList.remove(n),this.element.classList.add(e)},n.prototype._handleShowPrompt=function(){return i(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return this.context.app.loadConfig.manualPromptMode?[3,3]:(t=!this.element.classList.contains(f.DEFAULT_CLASSNAME_PROMPT_VISIBLE))?[4,this._isUserEligibleToPrompt()]:[3,2];case 1:t=n.sent(),n.label=2;case 2:t&&(c.Logger.info("Prompt manually triggered"),this._attemptToShow(!0)),n.label=3;case 3:return[2]}})})},n.prototype._handlePermissionGranted=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this._setPromptCompositeSubscribedClassnames(),[4,this._hide()];case 1:return t.sent(),[2]}})})},n.prototype._handlePermissionDenied=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this._setSubscriptionDeniedClassnames(),[4,this._hide()];case 1:return t.sent(),[2]}})})},n}(o.DomPrompt);n.CustomPrompt=h},"./src/sdk/prompts/dom.prompt.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/prompts/base.prompt.ts"),u=e("./src/sdk/utils.ts"),c=e("./src/sdk/models/index.ts"),a=e("./src/sdk/enums/index.ts"),f=e("./src/sdk/services/index.ts"),h=e("./src/sdk/constants.ts"),d=0,l=function(t){function n(n,e,r){void 0===r&&(r=!0);var i=t.call(this,n,e,r)||this;return i.parentReady=!1,r&&i._wireRenderEvent(),i}return r(n,t),n.prototype._wireRenderEvent=function(){var t=this._handleFlowLoadedRender.bind(this);this.watchOnce(a.EventType.FLOW_LOADED,t)},Object.defineProperty(n.prototype,"promptTheme",{get:function(){return this.promptConfig.theme||{}},enumerable:!0,configurable:!0}),n.prototype.attachToDom=function(t){return i(this,void 0,void 0,function(){var n;return s(this,function(e){switch(e.label){case 0:return this.element?[2]:(n=this.context.user.env.getCurrentDocument().body,this.parent=t||n,this.parent?[3,5]:d<5?(f.Logger.info("Prompt parent element, "+String(this.parent)+", could not be resolved. Attempts: "+d),d++,[4,u.delay(100*d*2)]):[3,3]);case 1:return e.sent(),[4,this.attachToDom(t)];case 2:return e.sent(),[3,4];case 3:f.Logger.warn("Prompt parent element, "+String(this.parent)+", unavailable"),e.label=4;case 4:return[3,6];case 5:this.parentReady=!0,e.label=6;case 6:return[2]}})})},n.prototype._canShow=function(){return!!this.element&&t.prototype._canShow.call(this)},n.prototype._show=function(){return i(this,void 0,void 0,function(){var t;return s(this,function(n){return f.Logger.info("Showing prompt "+this.promptId+", "+this.name),this._incrementUserPromptCount(),this._setLastSeenPromptId(),this._addVisibleClassName(),t=this._buildPostEventPack(),this._hasKeywords()&&(t.meta.keywords=this.keywords),this.isUserSubscribed?this.style===a.PromptStyle.Custom&&(this.dispatch(new c.Events.EventModel(a.EventType.FOLLOW_SHOWN,this._buildDispatchEventPack())),this.post(new c.Events.StreamableEventModel(a.StreamableEventType.FOLLOW_SHOWN,t,this.context))):(this.dispatch(new c.Events.EventModel(a.EventType.PROMPT_SHOWN,this._buildDispatchEventPack())),this.post(new c.Events.StreamableEventModel(a.StreamableEventType.PROMPT_SHOWN,t,this.context))),[2]})})},n.prototype._hide=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return this._removeVisibleClassName(),this.dispatch(new c.Events.EventModel(a.EventType.PROMPT_HIDE,this._buildDispatchEventPack())),[2]})})},n.prototype._allow=function(t){return i(this,void 0,void 0,function(){var t;return s(this,function(n){return t=this._buildPostEventPack(),this._hasKeywords()&&(t.meta.keywords=this.keywords),this.isUserSubscribed?this.style===a.PromptStyle.Custom&&(this.dispatch(new c.Events.EventModel(a.EventType.FOLLOWED,this._buildDispatchEventPack())),this.post(new c.Events.StreamableEventModel(a.StreamableEventType.FOLLOWED,t,this.context))):(this.dispatch(new c.Events.EventModel(a.EventType.PROMPT_ALLOWED,this._buildDispatchEventPack(),this.context,this)),this.post(new c.Events.StreamableEventModel(a.StreamableEventType.PROMPT_ALLOWED,t,this.context))),[2]})})},n.prototype._dismiss=function(t){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.dispatch(new c.Events.EventModel(a.EventType.PROMPT_DISMISSED,this._buildDispatchEventPack())),this.post(new c.Events.StreamableEventModel(a.StreamableEventType.PROMPT_DISMISSED,this._buildPostEventPack(),this.context)),[4,f.UserService.setPromptDismissed(this.context.user,this)];case 1:return t.sent(),this._hide(),[2]}})})},n.prototype._addVisibleClassName=function(){this.element.classList.add(h.DEFAULT_CLASSNAME_PROMPT_VISIBLE)},n.prototype._removeVisibleClassName=function(){this.element.classList.remove(h.DEFAULT_CLASSNAME_PROMPT_VISIBLE)},n.prototype._resolveKeywords=function(){try{if(this.element){var t=(this.element.dataset||{}).keywords||"";if(""!==t.trim()){var n=t.toString().split(",").map(function(t){return t.toString().trim()});this.keywords=Array.from(new Set(n)).slice()}}}catch(t){f.Logger.warn("Could not resolve prompt keywords - "+t.message)}},n.prototype._hasKeywords=function(){return!!this.keywords&&Array.isArray(this.keywords)&&this.keywords.length>0},n.prototype._buildDispatchEventPack=function(){var n=t.prototype._buildDispatchEventPack.call(this);return n.keywords=this.keywords||[],n},n.prototype._handleFlowLoadedRender=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.attachToDom()];case 1:return t.sent(),[2]}})})},n.prototype._createDivElement=function(t){return void 0===t&&(t={}),this._createDomElement("div",t)},n.prototype._createButtonElement=function(t){return void 0===t&&(t={}),this._createDomElement("button",t)},n.prototype._createImgElement=function(t){var n=this._createDomElement("img");return t&&(n.src=t),n},n.prototype._createSvgElement=function(t){var n=this.context.user.env.getCurrentDocument().createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("viewBox",t),n},n.prototype._createDomElement=function(t,n){void 0===n&&(n={});var e=this.context.user.env.getCurrentDocument().createElement(t);return n.className&&e.setAttribute("class",n.className),n.style&&e.setAttribute("style",n.style),n.innerText&&(e.innerText=n.innerText),e},n}(o.BasePrompt);n.DomPrompt=l},"./src/sdk/prompts/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/prompts/base.prompt.ts");n.Prompt=r.BasePrompt;var i=e("./src/sdk/prompts/dom.prompt.ts");n.DomPrompt=i.DomPrompt;var s=e("./src/sdk/prompts/native.prompt.ts");n.NativePrompt=s.NativePrompt;var o=e("./src/sdk/prompts/slide.prompt.ts");n.SlidePrompt=o.SlidePrompt;var u=e("./src/sdk/prompts/bell.prompt.ts");n.BellPrompt=u.BellPrompt;var c=e("./src/sdk/prompts/custom.prompt.ts");n.CustomPrompt=c.CustomPrompt},"./src/sdk/prompts/native.prompt.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/prompts/base.prompt.ts"),u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/exceptions/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/services/index.ts"),h=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._wireEvents=function(){var t=this._handleFlowLoaded.bind(this),n=this._handleShowPrompt.bind(this);this.watch(u.EventType.FLOW_LOADED,t),this.watch(u.EventType.PROMPT_SHOW,n)},n.prototype._handleFlowLoaded=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.run()];case 1:return t.sent(),[2]}})})},n.prototype._handleShowPrompt=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.context.app.loadConfig.manualPromptMode?[3,2]:[4,this._attemptToShow(!0)];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype.run=function(n){return void 0===n&&(n={}),i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,t.prototype.run.call(this,n)];case 1:return e.sent(),this._runMixedIntegrationCheck(),this._canShow()?(this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),[4,this._attemptToShow(!!n.bypassEligibilityCheck)]):[3,3];case 2:return e.sent(),[3,4];case 3:this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())),e.label=4;case 4:return[2]}})})},n.prototype._attemptToShow=function(t){return void 0===t&&(t=!1),i(this,void 0,void 0,function(){var n;return s(this,function(e){switch(e.label){case 0:return n=this.settings.prompt.is_auto_show||t,this._isPlacementEnabled()?[3,1]:(f.Logger.info("Current prompt is not enabled for this placement"),[3,4]);case 1:return this._canShow()&&n?[4,this._evaluateRunConditions()]:[3,4];case 2:return e.sent(),[4,this._show()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.prototype._show=function(){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,t.prototype._show.call(this)];case 1:return n.sent(),[4,this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_ALLOWED,this._buildDispatchEventPack(),this.context,this))];case 2:return n.sent(),[2]}})})},n.prototype._runMixedIntegrationCheck=function(){var t=this.context.domain.integrationType;if(this.context.user.env.primaryRuntimeEnvironment===u.RuntimeEnvironment.DIRECT&&t===u.IntegrationType.PROXY)throw this.debugPromptNotShown(this.context,"mixed_integration"),new c.FailException(null,u.ExceptionMessage.MIXED_INTEGRATION)},n}(o.BasePrompt);n.NativePrompt=h},"./src/sdk/prompts/slide.prompt.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/prompts/dom.prompt.ts"),u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/services/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/constants.ts"),h={top:"d-top",bottom:"d-bottom",disabled:"d-disabled"},d={top:"m-top",bottom:"m-bottom",disabled:"m-disabled"},l=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),Object.defineProperty(n.prototype,"promptImage",{get:function(){return this.promptTheme.image},enumerable:!0,configurable:!0}),n.prototype._wireEvents=function(){var t=this._handleFlowLoaded.bind(this),n=this._handlePromptHide.bind(this),e=this._handleShowPrompt.bind(this),r=[u.EventType.PROMPT_ALLOWED,u.EventType.PROMPT_DISMISSED,u.EventType.PERMISSION_DIALOG_SHOWN,u.EventType.PERMISSION_DENIED,u.EventType.REGISTRATION_SUBSCRIBED,u.EventType.REGISTRATION_MIGRATED];this.watch(u.EventType.FLOW_LOADED,t),this.watch(r,n),this.watch(u.EventType.PROMPT_SHOW,e)},n.prototype._handleFlowLoaded=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.run()];case 1:return t.sent(),[2]}})})},n.prototype._handlePromptHide=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._hide()];case 1:return t.sent(),[2]}})})},n.prototype._handleShowPrompt=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.context.app.loadConfig.manualPromptMode?[3,2]:this.element.classList.contains(f.DEFAULT_CLASSNAME_PROMPT_VISIBLE)?[3,2]:[4,this._attemptToShow(!0)];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype._wireElementEvents=function(){this.allowBtn.addEventListener("click",this._allow.bind(this)),this.dismissBtn.addEventListener("click",this._dismiss.bind(this))},n.prototype.attachToDom=function(n){return i(this,void 0,void 0,function(){var e,r;return s(this,function(i){switch(i.label){case 0:return[4,t.prototype.attachToDom.call(this,n)];case 1:return i.sent(),this.parentReady&&(e=this._buildTemplate(),r=["pushly_popover","pushly-prompt-window",this.promptTheme.layout||"normal",this.promptConfig.managed?"managed":"non-managed",h[this.promptTheme.position.desktop],d[this.promptTheme.position.mobile]],(this.element=this._createDivElement({className:r.join(" ")})).appendChild(e),this.parent.appendChild(this.element),this._wireElementEvents()),[2]}})})},n.prototype._buildTemplate=function(){var t=this._createDivElement({className:"pushly_popover-box pushly-prompt-slide",style:"background-color: "+this.promptTheme.background_color}),n=this._createDivElement({className:"pushly_popover-first pushly-prompt-icon"});if(t.appendChild(n),this.promptImage){var e=this._createImgElement(this.promptImage);n.appendChild(e)}else n.style.display="none";var r=this._createDivElement({className:"pushly_popover-second pushly-prompt-content"});t.appendChild(r);var i=this._createDivElement({className:"pushly_popover-message pushly-prompt-message"});r.appendChild(i);var s=this._createDivElement({className:"pushly_popover-message-headline pushly-prompt-message-headline",style:"color: "+this.promptTheme.title.text_color,innerText:this.promptTheme.title.text});i.appendChild(s);var o=this._createDivElement({className:"pushly_popover-message-headline pushly-prompt-message-headline",style:"color: "+this.promptTheme.subtitle.text_color,innerText:this.promptTheme.subtitle.text});i.appendChild(o);var u=this._createDivElement({className:"pushly_popover-buttons pushly-prompt-actions"});return r.appendChild(u),this.dismissBtn=this._createButtonElement({className:"pushly_popover-buttons-dismiss pushly-prompt-buttons-dismiss",style:"color: "+this.promptTheme.dismiss_button.text_color+"; background-color: "+this.promptTheme.dismiss_button.background_color+";",innerText:this.promptTheme.dismiss_button.text}),u.appendChild(this.dismissBtn),this.allowBtn=this._createButtonElement({className:"pushly_popover-buttons-allow pushly-prompt-buttons-allow",style:"color: "+this.promptTheme.allow_button.text_color+"; background-color: "+this.promptTheme.allow_button.background_color+";",innerText:this.promptTheme.allow_button.text}),u.appendChild(this.allowBtn),t},n.prototype.run=function(n){return void 0===n&&(n={}),i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,t.prototype.run.call(this,n)];case 1:return e.sent(),this._canShow()?(this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_ELIGIBLE,this._buildDispatchEventPack())),[4,this._attemptToShow(!!this.bypassEligibilityCheck)]):[3,3];case 2:return e.sent(),[3,4];case 3:this.dispatch(new a.Events.EventModel(u.EventType.PROMPT_INELIGIBLE,this._buildDispatchEventPack())),e.label=4;case 4:return[2]}})})},n.prototype._attemptToShow=function(t){return void 0===t&&(t=!1),i(this,void 0,void 0,function(){var n;return s(this,function(e){switch(e.label){case 0:return n=this.settings.prompt.is_auto_show||t,this._isPlacementEnabled()?[3,1]:(c.Logger.info("Current prompt is not enabled for this placement"),[3,4]);case 1:return this._canShow()&&n?[4,this._evaluateRunConditions()]:[3,4];case 2:return e.sent(),[4,this._show()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.prototype._show=function(){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return[4,t.prototype._show.call(this)];case 1:return n.sent(),[2]}})})},n}(o.DomPrompt);n.SlidePrompt=l},"./src/sdk/repositories/application.repository.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=this&&this.__rest||function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&(e[r[i]]=t[r[i]])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/utils.ts"),u=e("./src/sdk/data-providers/index.ts"),c=e("./src/sdk/services/index.ts"),a=function(){function t(){}return t.get=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return t={},u.IdbDataProvider.isEnabled()?(c.Logger.info("Data mode: IDM"),[4,u.IdbDataProvider.get("application")]):[3,2];case 1:return t=n.sent(),[3,3];case 2:c.Logger.info("Data mode: CDM"),n.label=3;case 3:return t.isVisibleLoggingEnabled=o.tryParseJSON(u.CookieDataProvider.get("pushly.app_visibleLogs",!1))||!1,t.workerVersion=t.workerVersion||u.CookieDataProvider.get("pushly.app_workerVersion"),t.isVisibleLoggingEnabled||(o.tryParseJSON(u.CookieDataProvider.get("pushly_view_logs",!1))||!1)&&(t.isVisibleLoggingEnabled=!0),[2,t]}})})},t.set=function(t){return r(this,void 0,void 0,function(){var n,e;return i(this,function(r){switch(r.label){case 0:return t.loadConfig,t.classNames,t.isDisabled,t.isLoaded,t.isFirebaseAppInitialized,t.workerSessionId,n=t.isVisibleLoggingEnabled,e=s(t,["loadConfig","classNames","isDisabled","isLoaded","isFirebaseAppInitialized","workerSessionId","isVisibleLoggingEnabled"]),u.IdbDataProvider.isEnabled()?[4,u.IdbDataProvider.set("application",e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return u.CookieDataProvider.set("pushly.app_version",t.version),u.CookieDataProvider.set("pushly.app_workerVersion",t.workerVersion),u.CookieDataProvider.set("pushly.app_visibleLogs",!0===n),u.CookieDataProvider.set("pushly.app_env",t.env),u.CookieDataProvider.set("pushly_view_logs",t.isVisibleLoggingEnabled),[2,this]}})})},t}();n.ApplicationRepository=a},"./src/sdk/repositories/domain.repository.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},o=this&&this.__rest||function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&(e[r[i]]=t[r[i]])}return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("./src/sdk/data-providers/index.ts"),c=e("./src/sdk/utils.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/services/index.ts"),h=e("./src/sdk/constants.ts"),d=e("./src/sdk/exceptions/index.ts"),l=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.get=function(t){return i(this,void 0,void 0,function(){var n,e,r,i,l,v,p,b;return s(this,function(s){switch(s.label){case 0:return n={},(e=u.IdbDataProvider.isEnabled())?[4,u.IdbDataProvider.get("domain")]:[3,2];case 1:return r=s.sent(),r.entityType,i=o(r,["entityType"]),n=i,[3,3];case 2:try{n=c.simpleUnHash(u.CookieDataProvider.get("pushly.domain"))}catch(t){}s.label=3;case 3:if(l=new a.Domain.DomainModel,Object.assign(l,n),l.isCached=!!e&&u.CookieDataProvider.get("pushly.domain_cached"),l.isCached)return[3,7];f.Logger.info("Updating domain cache"),s.label=4;case 4:return s.trys.push([4,6,,7]),[4,u.ApiDataProvider.get(h.SETTINGS_ENDPOINT+"/"+t)];case 5:return(v=s.sent())&&(p=v.domain,l.id=p.id,l.name=p.name,l.domainKey=t,l.senderId=p.sender_id,l.customAllowDomain=p.custom_allow_domain,l.frequencyCaps=p.frequency_caps,l.globalPromptSettings=p.global_prompt_settings,l.integrationType=p.integration_type,l.whitelistDomains=p.whitelist_domains,l.apnsConfiguration=p.apns_configuration,l.flags=p.flags||l.flags,l.vapidPublicKey=p.vapid_public_key,l.promptGroups=v.prompt_groups,l.prompts=v.prompts),[3,7];case 6:throw b=s.sent(),f.Logger.warn("Unable to load remote domain settings.",b),this.debugPromptNotShown({domainKey:t},"load_failed"),new d.DomainLoadException(b);case 7:return[2,l]}})})},n.set=function(t,n){return void 0===n&&(n=!1),i(this,void 0,void 0,function(){var e;return s(this,function(r){switch(r.label){case 0:return t.isCached,e=o(t,["isCached"]),u.IdbDataProvider.isEnabled()?[4,u.IdbDataProvider.set("domain",e)]:[3,2];case 1:r.sent(),n&&(t.isCached=!0,u.CookieDataProvider.set("pushly.domain_cached",!0,h.PUSHLY_SETTINGS_CACHED_COOKIE_TIMEOUT)),r.label=2;case 2:return[2,this]}})})},n}(a.Events.EventableModel);n.DomainRepository=l},"./src/sdk/repositories/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/repositories/application.repository.ts");n.ApplicationRepository=r.ApplicationRepository;var i=e("./src/sdk/repositories/domain.repository.ts");n.DomainRepository=i.DomainRepository;var s=e("./src/sdk/repositories/user.repository.ts");n.UserRepository=s.UserRepository},"./src/sdk/repositories/user.repository.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=this&&this.__rest||function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&(e[r[i]]=t[r[i]])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/data-providers/index.ts"),u=e("./src/sdk/utils.ts"),c=e("./src/sdk/models/index.ts"),a=e("./src/sdk/prompts/index.ts"),f=e("./src/sdk/constants.ts"),h=function(){function t(){}return t.get=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return t={},o.IdbDataProvider.isEnabled()?[4,o.IdbDataProvider.get("user")]:[3,2];case 1:t=n.sent()||t,n.label=2;case 2:return t.puuid=t.puuid||o.CookieDataProvider.get("pushly.user_puuid"),t.createdAt=t.createdAt||o.CookieDataProvider.get("pushly.user_createdAt"),t.updatedAt=t.updatedAt||o.CookieDataProvider.get("pushly.user_updatedAt"),t.doNotTrackFlags=t.doNotTrackFlags||o.CookieDataProvider.get("pushly.user_doNotTrackFlags"),t.subscriberState=t.subscriberState||o.CookieDataProvider.get("pushly.user_subscriberState"),t.lastSeenPromptId=t.lastSeenPromptId||o.CookieDataProvider.get("pushly.user_lastSeenPromptId"),t.lifetimeViewedKeywordMap={},t.profileDocument=t.profileDocument||u.simpleUnHash(o.CookieDataProvider.get("pushly.user_profile")),"subscribed"===t.subscriberState&&(t.token=t.token||o.CookieDataProvider.get("pushly.user_token")),t.promptFcapSeconds=o.CookieDataProvider.get("pushly.user_promptFcapSeconds"),t.promptCountState=o.CookieDataProvider.get("pushly.user_promptCountState"),[2,c.User.UserModel.of(t)]}})})},t.set=function(t){return r(this,void 0,void 0,function(){var n,e;return i(this,function(r){switch(r.label){case 0:return t.env,t.promptFcapSeconds,t.promptCountState,t.subscriptionRegistered,t.lifetimeViewedKeywordMap,n=s(t,["env","promptFcapSeconds","promptCountState","subscriptionRegistered","lifetimeViewedKeywordMap"]),o.IdbDataProvider.isEnabled()?[4,o.IdbDataProvider.set("user",n)]:[3,2];case 1:r.sent(),r.label=2;case 2:return e=new Date,o.CookieDataProvider.clear("pushly.user_lifetimeViewedKeywordMap"),o.CookieDataProvider.set("pushly.user_puuid",t.puuid),o.CookieDataProvider.set("pushly.user_createdAt",t.createdAt),o.CookieDataProvider.set("pushly.user_updatedAt",e.getTime()),o.CookieDataProvider.set("pushly.user_doNotTrackFlags",(t.doNotTrackFlags||[]).join(",")),o.CookieDataProvider.set("pushly.user_subscriberState",t.subscriberState),o.CookieDataProvider.set("pushly.user_lastSeenPromptId",t.lastSeenPromptId),t.profileDocument&&"undefined"!==t.profileDocument?o.CookieDataProvider.set("pushly.user_profile",u.simpleHash(t.profileDocument)):o.CookieDataProvider.clear("pushly.user_profile"),o.CookieDataProvider.set("pushly_uqid",t.puuid),o.CookieDataProvider.set("pushly_uqid_timestamp",t.createdAt),o.CookieDataProvider.set("pushly_subscriber_data_updated_at",e.toISOString()),o.CookieDataProvider.set("pushly_do_not_track",(t.doNotTrackFlags||[]).join(",")),t.token?(o.CookieDataProvider.set("pushly.user_token",t.token),"safari"in self?o.CookieDataProvider.set("pushly_apns_token",t.token):o.CookieDataProvider.set("pushly_fcm_token",t.token),o.CookieDataProvider.set("pushly_subscribed",!0)):o.CookieDataProvider.clear("pushly.user_token"),[2,this]}})})},t.getWithCachePriority=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(n){switch(n.label){case 0:return t={},o.IdbDataProvider.isEnabled()?[4,o.IdbDataProvider.get("user")]:[3,2];case 1:t=n.sent()||t,n.label=2;case 2:return t.puuid=o.CookieDataProvider.get("pushly.user_puuid")||t.puuid,t.createdAt=o.CookieDataProvider.get("pushly.user_createdAt")||t.createdAt,t.updatedAt=o.CookieDataProvider.get("pushly.user_updatedAt")||t.updatedAt,t.doNotTrackFlags=o.CookieDataProvider.get("pushly.user_doNotTrackFlags")||t.doNotTrackFlags,t.subscriberState=o.CookieDataProvider.get("pushly.user_subscriberState")||t.subscriberState,t.lastSeenPromptId=o.CookieDataProvider.get("pushly.user_lastSeenPromptId")||t.lastSeenPromptId,t.lifetimeViewedKeywordMap={},t.profileDocument=u.simpleUnHash(o.CookieDataProvider.get("pushly.user_profile"))||t.profileDocument,"subscribed"===t.subscriberState&&(t.token=o.CookieDataProvider.get("pushly.user_token")||t.token),t.promptFcapSeconds=o.CookieDataProvider.get("pushly.user_promptFcapSeconds"),t.promptCountState=o.CookieDataProvider.get("pushly.user_promptCountState"),[2,c.User.UserModel.of(t)]}})})},t.setPromptState=function(t,n){return r(this,void 0,void 0,function(){var e,r;return i(this,function(i){return e=t.promptFcapSeconds,r=t.promptCountState,o.CookieDataProvider.setWithRawExpires("pushly.user_promptFcapSeconds",e,n),o.CookieDataProvider.setWithRawExpires("pushly.user_promptCountState",r,n),[2,this]})})},t.clearPromptState=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return o.CookieDataProvider.clear("pushly.user_promptFcapSeconds"),o.CookieDataProvider.clear("pushly.user_promptCountState"),[2,this]})})},t.setPromptDismissedState=function(t,n){return r(this,void 0,void 0,function(){var e,r,s,u;return i(this,function(i){switch(i.label){case 0:return e=f.PUSHLY_PROMPT_DISMISSED_COOKIE_TIMEOUT,r="d",s={},"cookie_length_seconds"in(s=n instanceof a.Prompt?n.promptConfig.behavior||{}:n.promptBehavior||{})&&void 0!==(u=s.cookie_length_seconds)&&null!==u&&(e=u,r="s"),0!==e?(t.subscriberState="dismissed",o.CookieDataProvider.set("pushly.prompt_dismissed",!0,e,r)):t.subscriberState="none",[4,this.set(t)];case 1:return i.sent(),[2,self]}})})},t.getPromptDismissedState=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(n){return[2,"true"===(t=o.CookieDataProvider.get("pushly.prompt_dismissed",!1))||!0===t]})})},t}();n.UserRepository=h},"./src/sdk/sdk.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},s=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/services/index.ts"),a=e("./src/sdk/exceptions/index.ts"),f=e("./src/sdk/models/index.ts"),h=e("./src/sdk/constants.ts"),d=function(t){function n(n){var e=t.call(this)||this;return e.context=n,e.u(),e}return r(n,t),n.prototype.push=function(t){return s(this,void 0,void 0,function(){var n,e,r,i;return o(this,function(s){switch(s.label){case 0:n=t[0],e=/^on_/i,s.label=1;case 1:return s.trys.push([1,5,,6]),e.test(n)?(n=n.replace(e,""),this.watch(n,t[1]),[3,4]):[3,2];case 2:return r=new f.Events.EventModel(n,t[1]),[4,this.dispatch(r)];case 3:s.sent(),s.label=4;case 4:return[3,6];case 5:if(!((i=s.sent())instanceof a.InvalidEventException))throw i;return c.Logger.warn(i.message),[3,6];case 6:return[2]}})})},n.prototype.on=function(t,n){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.push(["on_"+t,n])];case 1:return e.sent(),[2]}})})},n.prototype.trigger=function(t,n){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.push([t,n])];case 1:return e.sent(),[2]}})})},n.prototype.showLogs=function(t){return void 0===t&&(t=!0),s(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return this.context.app.isVisibleLoggingEnabled=!!t,[4,c.AppService.saveApp(this.context.app)];case 1:return n.sent(),c.Logger.setVisibleLogsEnabled(t),[2]}})})},n.prototype.getLogs=function(){return c.Logger.logs},n.prototype.load=function(t){return s(this,void 0,void 0,function(){var n,e;return o(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,5]),[4,this.f(t)];case 1:return r.sent(),[3,5];case 2:return n=r.sent(),e=!1,n instanceof a.FailException||n instanceof a.DomainLoadException||n instanceof a.WorkerRegistrationException?(e=!0,c.Logger.error(this.context,n)):(n instanceof a.PushlyException||n&&n.isPushlyException)&&(e=!0,c.Logger.warn(n.message)),e?[3,4]:[4,this.h(n)];case 3:r.sent(),r.label=4;case 4:return[3,5];case 5:return[2]}})})},n.prototype.requestNotificationPermission=function(t,n){return void 0===t&&(t=0),s(this,void 0,void 0,function(){return o(this,function(e){return[2,c.RegistrationService.performManualRegistrationAttempt(this.context,t,n)]})})},n.prototype.f=function(t){return s(this,void 0,void 0,function(){var n,e,r,i,s,h;return o(this,function(o){switch(o.label){case 0:if(this.context.app&&this.context.app.isLoaded)throw new a.ExitException(null,u.ExceptionMessage.SDK_ALREADY_LOADED);if(!t.domainKey||""===t.domainKey.trim())throw new a.ExitException(null,u.ExceptionMessage.DOMAIN_KEY_NOT_SPECIFIED);return this.context.domainKey=t.domainKey,this.debug(this.context,u.StreamableEventType.SDK_IMPRESSION),c.Logger.info("Loading:",this.context.domainKey),[4,c.EnvironmentService.loadEnv()];case 1:return n=o.sent(),[4,c.EnvironmentService.verifyEnvironmentSupport(t,n)];case 2:return o.sent(),[4,c.DataMigrationService.isMigrationRequired()];case 3:return o.sent()?[4,c.DataMigrationService.migrate()]:[3,5];case 4:o.sent(),o.label=5;case 5:return e=this.context,[4,c.AppService.loadApp(t)];case 6:return e.app=o.sent(),c.Logger.setVisibleLogsEnabled(this.context.app.isVisibleLoggingEnabled),c.Logger.info("Version:",this.context.app.version),r=this.context,[4,c.DomainService.loadDomain(this.context.domainKey)];case 7:return r.domain=o.sent(),[4,c.DomainService.verifyEnvironmentSupport(this.context,n)];case 8:return o.sent(),i=this.context,[4,c.UserService.loadUser(t,n)];case 9:if(i.user=o.sent(),!this.context.user)throw new a.FailException(null,u.ExceptionMessage.USER_UNABLE_TO_LOAD);return c.EnvironmentService.configureRuntimeEnvironments(this.context),[4,c.UserService.verifyUserSubscriptionState(this.context)];case 10:return o.sent(),this.context.app.isLoaded=!0,c.Logger.info("Loaded"),this.dispatch(new f.Events.EventModel(u.EventType.APPLICATION_LOADED)),t.disableWebFlow?[4,this.b()]:[3,12];case 11:return o.sent(),[3,14];case 12:return s=c.FlowService.loadFlow(this.context),t.manualPromptMode||(h={isAmp:s.isAmp},c.PromptService.loadPrompts(this.context,h)),[4,s.run()];case 13:o.sent(),o.label=14;case 14:return[2]}})})},n.prototype.u=function(){if(!this.context.app||!this.context.app.isLoaded){var t=this.b.bind(this),n=this.w.bind(this),e=this.y.bind(this),r=this._.bind(this),i=this.k.bind(this),s=this.g.bind(this);this.watchOnce(u.EventType.APPLICATION_LOAD,e),this.watchOnce(u.EventType.AMP_FRAME_HELPER_LOAD,r),this.watchOnce(u.EventType.AMP_PERMISSION_DIALOG_LOAD,i),this.watchOnce(u.EventType.PROXY_PERMISSION_DIALOG_LOAD,s),this.watchOnce(u.EventType.FLOW_LOADED,t),this.watch(u.EventType.PROMPT_SHOW,n),c.UserService.wireProfileEvents(this.context)}},n.prototype.y=function(t){this.load(t)},n.prototype._=function(t){t._subRuntimeEnvironmentOverride=u.RuntimeEnvironment.AMP_FRAME_HELPER,this.load(t)},n.prototype.k=function(t){t._subRuntimeEnvironmentOverride=u.RuntimeEnvironment.AMP_PERMISSION_DIALOG,this.load(t)},n.prototype.g=function(t){t._subRuntimeEnvironmentOverride=u.RuntimeEnvironment.PROXY_PERMISSION_DIALOG,this.load(t)},n.prototype.w=function(t){return s(this,void 0,void 0,function(){var n,e;return o(this,function(r){return n=!!this.context.app.loadConfig.manualPromptMode,(e=t?t.id:void 0)&&(n?c.PromptService.performManualPromptLoad(this.context,e):c.Logger.warn("Manual prompt mode is not enabled.")),[2]})})},n.prototype.b=function(){return s(this,void 0,void 0,function(){return o(this,function(t){return c.Logger.info("Ready"),this.dispatch(new f.Events.EventModel(u.EventType.APPLICATION_READY,this.context)),[2]})})},n.prototype.h=function(t){return s(this,void 0,void 0,function(){var n;return o(this,function(e){return t.context=i({},t.context,{sw_error:!1}),(n=new RegExp(h.UNCAUGHT_ERROR_BLACKLIST.map(function(t){return"("+t+")"}).join("|"),"i")).test(t.name)||n.test(t.message)?c.Logger.warn(this.context,t):c.Logger.error(this.context,t),[2]})})},n}(f.Events.EventableModel);n.SDK=d},"./src/sdk/services/amp-messaging.service.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/enums/index.ts"),u=e("./src/sdk/utils.ts"),c=e("./src/sdk/models/index.ts"),a=e("./src/sdk/services/logging.service.ts"),f=function(t){function n(){var n=t.call(this)||this;return n.rand=u.randomString(5),n.isHost=!1,n.listeners={},n._listenForHandshake(),n}return r(n,t),n.prototype.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];a.Logger.info.apply(a.Logger,["[amp-"+this.rand+"]"].concat(t))},n.prototype.listen=function(){this.port?(this.log("Messenger is listening"),this._bindPortEvents(),this.send(o.AmpMessageTopic.CONNECT_HANDSHAKE)):a.Logger.warn("Unable to listen for amp messages. Handshake was never received.")},n.prototype.connect=function(t){a.Logger.info("Connecting to opener");try{var n=new MessageChannel;this.isHost=!0,this.port=n.port1,this.port.start(),this._bindPortEvents(),t.postMessage({topic:o.AmpMessageTopic.CONNECT_HANDSHAKE,data:{}},"*",[n.port2])}catch(t){a.Logger.error(t)}},n.prototype.send=function(t,n,e,r){void 0===n&&(n=null),void 0===e&&(e=null),void 0===r&&(r=!1);try{var i=e||crypto.getRandomValues(new Uint8Array(10)).join("");this.port.postMessage({id:i,topic:t,data:n,isReply:r});var s=new Promise(function(t){return t()});if(!r){var o=void 0;s=new Promise(function(t){return o=t}),this.listeners[i]=o}return s}catch(t){a.Logger.error(t)}},n.prototype._listenForHandshake=function(){window.addEventListener("message",this._handleHandshakeEvent.bind(this))},n.prototype._bindPortEvents=function(){this.port.onmessage=this._handleMessageEvent.bind(this)},n.prototype._handleHandshakeEvent=function(t){return i(this,void 0,void 0,function(){var n;return s(this,function(e){switch(e.label){case 0:return e.trys.push([0,5,,6]),t.data&&t.data.topic?t.data.topic!==o.AmpMessageTopic.CONNECT_HANDSHAKE?[3,4]:(this.log("Got handshake",t),this.isHost?[3,2]:(this.port=t.ports[0],[4,this.dispatch(new c.Events.EventModel(o.EventType.AMP_HANDSHAKE))])):[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.dispatch(new c.Events.EventModel(o.EventType.AMP_CONNECT))];case 3:e.sent(),e.label=4;case 4:return[3,6];case 5:return n=e.sent(),a.Logger.error(n),[3,6];case 6:return[2]}})})},n.prototype._handleMessageEvent=function(t){var n=this;try{if(t.data&&t.data.topic){var e=t.data.topic,r=t.data.data,o=t.data.id;if(o in this.listeners)this.listeners[o](r),delete this.listeners[o];else{this.log("Got message "+e),this.dispatch(new c.Events.EventModel(e,{port:t.ports[0],data:r,reply:function(t){return i(n,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return this.log("Replying to "+e,t),[4,this.send(e,{success:!0,result:t},o,!0)];case 1:return n.sent(),[2]}})})}}))}}}catch(t){a.Logger.error(t)}},n}(c.Events.EventableModel);n.AmpMessagingSvc=f,n.AmpMessagingService=new f},"./src/sdk/services/app.service.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./src/sdk/repositories/index.ts"),o=e("./src/sdk/constants.ts"),u=function(){function t(){}return t.prototype.loadApp=function(t){return r(this,void 0,void 0,function(){var n;return i(this,function(e){switch(e.label){case 0:return[4,s.ApplicationRepository.get()];case 1:return(n=e.sent()).loadConfig=t,n.loadConfig.classNames=n.loadConfig.classNames||{},n.env=o.ENV_NAME,n.version=o.PUSHLY_APPLICATION_VERSION,[4,this.saveApp(n)];case 2:return e.sent(),n.classNames=t.classNames,[2,n]}})})},t.prototype.saveApp=function(t){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return[4,s.ApplicationRepository.set(t)];case 1:return n.sent(),[2,t]}})})},t}();n.AppService=new u},"./src/sdk/services/data-migration.service.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./src/sdk/utils.ts"),o=e("./src/sdk/data-providers/index.ts"),u=e("./src/sdk/repositories/index.ts"),c=e("./src/sdk/services/logging.service.ts"),a=e("./src/sdk/constants.ts"),f=function(){function t(){}return t.isMigrationRequired=function(){return r(this,void 0,void 0,function(){var t,n,e,r,s,u;return i(this,function(i){switch(i.label){case 0:t=o.IdbDataProvider.isEnabled(),n={},i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o.LegacyIdbDataProvider.get(a.PUSHLY_STORE_NAME,a.ENV_NAME)];case 2:return n=i.sent(),[3,4];case 3:return i.sent(),[3,4];case 4:return e=Object.keys(n).length>0,t?[4,o.IdbDataProvider.get("application")]:[3,6];case 5:return r=i.sent(),s=Object.keys(r).length>0,e&&s&&o.CookieDataProvider.set("pushly.v1_migrated",1),[2,e&&!s];case 6:return u=o.CookieDataProvider.get("pushly.v1_migrated",0),[2,e&&!u]}})})},t.migrate=function(){return r(this,void 0,void 0,function(){var t,n,e,r,f,h;return i(this,function(i){switch(i.label){case 0:return c.Logger.info("Migrating legacy data"),[4,o.LegacyIdbDataProvider.get(a.PUSHLY_STORE_NAME,a.ENV_NAME)];case 1:return t=i.sent(),[4,o.CookieDataProvider.getAll()];case 2:return n=i.sent(),e={workerVersion:t.worker_version},[4,u.ApplicationRepository.set(e)];case 3:return i.sent(),r={id:t.domain_id},t.pushly_settings&&(f=t.pushly_settings.domain,r.domainKey=f.domain_key,r.name=f.name,r.customAllowDomain=f.custom_allow_domain,r.integrationType=f.integration_type,r.whitelistDomains=f.whitelist_domains,r.apnsConfiguration=f.apns_configuration,r.defaultIconUrl=f.default_icon_url,r.globalPromptSettings=f.global_prompt_settings,r.frequencyCaps=f.frequency_caps,r.promptGroups=t.pushly_settings.prompt_groups,r.prompts=t.pushly_settings.prompts,r.welcomeNotification=t.pushly_settings.welcome_notification),[4,u.DomainRepository.set(r)];case 4:return i.sent(),!(h={puuid:t.unique_user_id||n.pushly_uqid,createdAt:t.unique_user_first_appearance||s.tryParseInt(n.pushly_uqid_timestamp),updatedAt:(new Date).getTime(),doNotTrackFlags:t.doNotTrack,lastSeenPromptId:t.last_seen_prompt_id,isLocalProfileDocumentHashed:t.hash_local_profile_values,lifetimeViewedKeywordMap:t.lifetime_viewed_keyword_map,sessionViewedPromptCount:n.pushly_user_prompt_count,token:t.fcm_subscription_id||t.apns_token,profileDocument:t.local_profile_document}).doNotTrackFlags&&n.pushly_do_not_track&&(h.doNotTrackFlags=n.pushly_do_not_track.split(",").map(function(t){return t.trim()})),h.subscriberState="none","true"===n.pushly_subscribed&&(h.subscriberState="subscribed"),"true"===n.pushly_unsubscribed&&(h.subscriberState="unsubscribed"),"true"===n.pushly_prompt_blocked&&(h.subscriberState="blocked"),"true"===n.pushly_prompt_dismissed&&(h.subscriberState="dismissed"),h.token||(h.token=n.pushly_fcm_token||n.pushly_apns_token),h.token&&"none"===h.subscriberState&&(h.subscriberState="subscribed"),[4,u.UserRepository.set(h)];case 5:return i.sent(),o.CookieDataProvider.set("pushly.v1_migrated",1),[2]}})})},t}();n.DataMigrationService=f},"./src/sdk/services/domain.service.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/models/index.ts"),u=e("./src/sdk/repositories/index.ts"),c=e("./src/sdk/enums/index.ts"),a=e("./src/sdk/exceptions/index.ts"),f=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype.loadDomain=function(t){return i(this,void 0,void 0,function(){var n;return s(this,function(e){switch(e.label){case 0:return[4,u.DomainRepository.get(t)];case 1:return(n=e.sent()).isCached?[3,3]:[4,u.DomainRepository.set(n,!0)];case 2:e.sent(),e.label=3;case 3:return[2,n]}})})},n.prototype.verifyEnvironmentSupport=function(t,n){return i(this,void 0,void 0,function(){return s(this,function(e){if(n.isSafari()){if(!t.domain.hasApnsConfig())throw this.debugPromptNotShown(t,"apns_not_configured"),this.dispatch(new o.Events.EventModel(c.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.Events.EventModel(c.EventType.DOMAIN_APNS_NOT_CONFIGURED)),new a.ExitException(null,c.ExceptionMessage.DOMAIN_APNS_NOT_CONFIGURED);if(!t.domain.isApnsConfigEnabled())throw this.debugPromptNotShown(t,"apns_not_enabled"),this.dispatch(new o.Events.EventModel(c.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.Events.EventModel(c.EventType.DOMAIN_APNS_NOT_ENABLED)),new a.ExitException(null,c.ExceptionMessage.DOMAIN_APNS_NOT_ENABLED);if(!t.domain.getWebsitePushId())throw this.debugPromptNotShown(t,"apns_invalid_config"),this.dispatch(new o.Events.EventModel(c.EventType.WEB_PUSH_NOT_CONFIGURED)),this.dispatch(new o.Events.EventModel(c.EventType.DOMAIN_APNS_INVALID_CONFIG)),new a.ExitException(null,c.ExceptionMessage.DOMAIN_APNS_INVALID_CONFIG)}return this.validateHostAvailability(t),[2]})})},n.prototype.validateHostAvailability=function(t){var n=!0,e=t.domain.whitelistDomains;if(e)if(Array.isArray(e)&&0!==e.length){var r=location.protocol+"//"+location.hostname,i=location.protocol+"//"+location.host,s=location.href;n=!e.concat(["localhost","127.0.0.1"]).some(function(t){/^\*/.test(t)&&(t="."+t);var n=new RegExp("^(http[s]?://)?"+t+"$","i");return n.test(r)||n.test(i)||n.test(s)})}else n=!1;else n=!1;if(n)throw this.debugPromptNotShown(t,"host_not_whitelisted"),new a.ExitException(null,c.ExceptionMessage.HOST_NOT_WHITELISTED)},n}(o.Events.EventableModel);n.DomainService=new f},"./src/sdk/services/environment.service.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/services/logging.service.ts"),u=e("./src/sdk/models/index.ts"),c=e("./src/sdk/enums/index.ts"),a=e("./src/sdk/exceptions/index.ts"),f=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype.loadEnv=function(){return i(this,void 0,void 0,function(){return s(this,function(t){return[2,new u.Application.EnvironmentModel]})})},n.prototype.verifyEnvironmentSupport=function(t,n){return i(this,void 0,void 0,function(){var e,r,i;return s(this,function(s){switch(s.label){case 0:return(r=!!n)?[4,n.isPushSupported()]:[3,2];case 1:r=s.sent(),s.label=2;case 2:if(!(e=r))throw i={domainKey:t.domainKey},this.debugPromptNotShown(i,"web_push_unsupported"),this.dispatch(new u.Events.EventModel(c.EventType.WEB_PUSH_NOT_SUPPORTED,void 0,t,n)),new a.ExitException(null,c.ExceptionMessage.ENV_NOT_SUPPORTED);return this.dispatch(new u.Events.EventModel(c.EventType.WEB_PUSH_SUPPORTED)),[2,e]}})})},n.prototype.configureRuntimeEnvironments=function(t){var n=t.app,e=t.domain,r=t.user,i=e.integrationType===c.IntegrationType.DIRECT;if(n.loadConfig._subRuntimeEnvironmentOverride){var s=n.loadConfig._subRuntimeEnvironmentOverride;s!==c.RuntimeEnvironment.AMP_FRAME_HELPER&&s!==c.RuntimeEnvironment.AMP_PERMISSION_DIALOG||(r.env.primaryRuntimeEnvironment=c.RuntimeEnvironment.AMP,r.env.subRuntimeEnvironment=n.loadConfig._subRuntimeEnvironmentOverride),s===c.RuntimeEnvironment.PROXY_PERMISSION_DIALOG&&(r.env.primaryRuntimeEnvironment=c.RuntimeEnvironment.PROXY,r.env.subRuntimeEnvironment=n.loadConfig._subRuntimeEnvironmentOverride)}if(!r.env.primaryRuntimeEnvironment){var u=e.integrationType===c.IntegrationType.PROXY;r.env.primaryRuntimeEnvironment=u?c.RuntimeEnvironment.PROXY:c.RuntimeEnvironment.DIRECT}i&&e.customAllowDomain&&!r.env.isHTTPS()&&(r.env.primaryRuntimeEnvironment=c.RuntimeEnvironment.PROXY);var a=c.RuntimeEnvironmentName[r.env.primaryRuntimeEnvironment];r.env.subRuntimeEnvironment&&(a=c.RuntimeEnvironmentName[r.env.subRuntimeEnvironment]),o.Logger.info("Current runtime environment: "+a)},n}(u.Events.EventableModel);n.EnvironmentService=new f},"./src/sdk/services/flow.service.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/factories/index.ts"),i=function(){function t(){}return t.prototype.loadFlow=function(t){return r.FlowFactory.getFlow(t)},t}();n.FlowService=new i},"./src/sdk/services/helpers/apns.service-helpers.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./src/sdk/enums/index.ts"),o=e("./src/sdk/exceptions/index.ts"),u=e("./src/sdk/services/logging.service.ts"),c=e("./src/sdk/constants.ts"),a=function(){function t(){}return t.getToken=function(t){var n,e=t.user.env.getPushPermission({websitePushId:t.domain.getWebsitePushId()});return e.deviceToken&&(n=e.deviceToken),n},t.requestNotificationPermission=function(t,n,e){return r(this,void 0,void 0,function(){var r,c,a,f;return i(this,function(i){switch(i.label){case 0:return r={permissionState:"default"},c=t.getWebsitePushId(),u.Logger.info("APNS checking permission for",c),a=n.env.getPushPermission({websitePushId:t.getWebsitePushId()}),r.permissionState=a.permission,r.permissionState!==s.NotificationPermissionState.GRANTED?[3,1]:(u.Logger.info("APNS permission already granted"),r.token=a.deviceToken,[3,3]);case 1:return[4,this._checkRemotePermission(t,n,r,e)];case 2:if(f=i.sent(),r.permissionState=f.permission,u.Logger.info("APNS response",f),f.permission===s.NotificationPermissionState.GRANTED&&(r.token=f.deviceToken,!r.token))throw new o.FailException(null,s.ExceptionMessage.APNS_FAILED_TO_GET_GRANTED_TOKEN);i.label=3;case 3:return[2,r]}})})},t._checkRemotePermission=function(t,n,e,o){return r(this,void 0,void 0,function(){return i(this,function(r){if(null===e||e.permissionState===s.NotificationPermissionState.DEFAULT){if(o)try{o()}catch(t){}return[2,this._requestSafariPermissions(t,n)]}return[2,e]})})},t._requestSafariPermissions=function(t,n){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,new Promise(function(e){u.Logger.info("Requesting permission"),n.env.getGlobalScope().safari.pushNotification.requestPermission(c.APNS_URL,t.getWebsitePushId(),{domain_key:t.domainKey,pushly_unique_user_id:n.puuid},e)})]})})},t}();n.ApnsServiceHelpers=a},"./src/sdk/services/helpers/firebase.service-helpers.ts":function(t,n,e){"use strict";var r=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},i=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./node_modules/@firebase/app/dist/index.cjs.js");e("./node_modules/@firebase/messaging/dist/index.esm.js");var o=e("./src/sdk/enums/index.ts"),u=e("./src/sdk/exceptions/index.ts"),c=e("./src/sdk/utils.ts"),a=e("./src/sdk/services/logging.service.ts"),f=function(){function t(){}return t.getToken=function(){return r(this,void 0,void 0,function(){return i(this,function(t){try{return[2,s.default.messaging().getToken()]}catch(t){throw t=t||{},a.Logger.warn({code:t.code,message:t.message,error:t}),new u.FirebaseException(t)}return[2]})})},t.requestNotificationPermission=function(t,n){return r(this,void 0,void 0,function(){var e,r,f,h,d,l,v,p,b;return i(this,function(i){switch(i.label){case 0:t.user.env.getGlobalScope(),e=s.default.messaging(),r={permissionState:"default"},i.label=1;case 1:return i.trys.push([1,3,,4]),n(),[4,e.requestPermission()];case 2:return i.sent(),[3,4];case 3:if(!("code"in(f=i.sent())))throw f;if(f.code!==o.FirebaseError.PERMISSION_BLOCKED&&f.code!==o.FirebaseError.PERMISSION_DEFAULT)throw new u.FirebaseException(f);return[3,4];case 4:if(r.permissionState=t.user.env.getPushPermissionState(),r.permissionState!==o.NotificationPermissionState.GRANTED)return[3,13];h=void 0,d=void 0,l=400,v=0,i.label=5;case 5:if(!(v<4))return[3,12];i.label=6;case 6:return i.trys.push([6,8,,9]),[4,this.getToken()];case 7:return(h=i.sent())?[3,12]:[3,9];case 8:return p=i.sent(),v<3?a.Logger.warn(p):d=p,[3,9];case 9:return a.Logger.info("Retrying fetch token"),l*=2,[4,c.delay(l)];case 10:i.sent(),i.label=11;case 11:return v++,[3,5];case 12:if(!h)throw new u.FirebaseException(d,o.ExceptionMessage.FIREBASE_FAILED_TO_GET_GRANTED_TOKEN);if("string"!=typeof h)throw(b=new u.FailException(null,o.ExceptionMessage.INVALID_TOKEN_TYPE)).context={token:h},b;r.token=h,i.label=13;case 13:return[2,r]}})})},t}();n.FirebaseServiceHelpers=f},"./src/sdk/services/helpers/user-profile.service-helpers.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},s=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/utils.ts"),a=e("./src/sdk/exceptions/index.ts"),f=e("./src/sdk/models/index.ts"),h=e("./src/sdk/repositories/index.ts"),d=e("./src/sdk/data-providers/index.ts"),l=e("./src/sdk/constants.ts"),v=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.saveUserTags=function(t,n,e){return void 0===e&&(e=0),s(this,void 0,void 0,function(){return o(this,function(r){switch(r.label){case 0:return Array.isArray(n)||(n=[n]),[4,this.patchProfile(t,{tag:n},e)];case 1:return r.sent(),[2]}})})},n.removeUserTags=function(t,n,e){return void 0===e&&(e=0),s(this,void 0,void 0,function(){return o(this,function(t){return[2]})})},n.saveUserEvent=function(t,n){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.patchProfile(t,{event:[n]})];case 1:return e.sent(),[2]}})})},n.saveUserProfileData=function(t,n){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.patchProfile(t,{profile:n})];case 1:return e.sent(),[2]}})})},n.saveExternalUserId=function(t,n){return s(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,this.patchProfile(t,{profile:{external_user_id:n}})];case 1:return e.sent(),[2]}})})},n.patchProfile=function(t,n,e){return void 0===e&&(e=0),s(this,void 0,void 0,function(){var r,s;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,6,,7]),e&&e>0?[4,c.delayRandom(e)]:[3,2];case 1:o.sent(),o.label=2;case 2:return[4,this.upsertLocalProfileDocument(t,n)];case 3:return o.sent()?(n.domain_id=t.domain.id,n.pushly_unique_user_id=t.user.puuid,r=t.user.doNotTrackFlags,t.user.env.isSafari()?n.apns_token=t.user.token:n.fcm_subscription_id=t.user.token,[4,d.ApiDataProvider.post(l.EVENTS_ENDPOINT,i({action:u.StreamableEventType.PROFILE_UPDATE,event_date:(new Date).toISOString(),do_not_track:r},n))]):[3,5];case 4:o.sent(),o.label=5;case 5:return[3,7];case 6:throw s=o.sent(),new a.ProfileException(s);case 7:return[2]}})})},n.upsertLocalProfileDocument=function(t,n){return s(this,void 0,void 0,function(){var e,r,s,u,a,f,d,l,v,p,b,w,m;return o(this,function(o){switch(o.label){case 0:return e=!1,r=i({},n),s=r.event,delete r.event,u=r.tag,delete r.tag,s?(e=!0,[3,3]):[3,1];case 1:if(a=this.flattenObject(r,[]),f=t.user.profileDocument||{},u){for(d=f.tags||[],l=0,v=u;l<v.length;l++)p=v[l],b=p,-1===d.indexOf(b)&&(e=!0,d.push(b));f.tags=d}if(!e)for(w in a)if(a[w]!==f[w]){e=!0;break}return e?(t.user.profileDocument=i({},f,a),[4,h.UserRepository.set(t.user)]):[3,3];case 2:o.sent(),o.label=3;case 3:return m=c.randomString(),n.meta=i({},n.meta,{event_id:m}),[2,e]}})})},n.flattenObject=function(t,n){void 0===n&&(n=[]);for(var e=i({},t),r=0,s=Object.keys(e);r<s.length;r++){var o=s[r],u=e[o];if(delete e[o],u instanceof Object&&!(u instanceof Array))e=i({},e,this.flattenObject(u,n.concat(o)));else e[n.concat(o).join(".")]=u}return e},n}(f.Events.EventableModel);n.UserProfileServiceHelpers=v},"./src/sdk/services/index.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/services/logging.service.ts");n.Logger=r.Logger;var i=e("./src/sdk/services/environment.service.ts");n.EnvironmentService=i.EnvironmentService;var s=e("./src/sdk/services/app.service.ts");n.AppService=s.AppService;var o=e("./src/sdk/services/domain.service.ts");n.DomainService=o.DomainService;var u=e("./src/sdk/services/user.service.ts");n.UserService=u.UserService;var c=e("./src/sdk/services/data-migration.service.ts");n.DataMigrationService=c.DataMigrationService;var a=e("./src/sdk/services/flow.service.ts");n.FlowService=a.FlowService;var f=e("./src/sdk/services/prompt.service.ts");n.PromptService=f.PromptService;var h=e("./src/sdk/services/registration.service.ts");n.RegistrationService=h.RegistrationService;var d=e("./src/sdk/services/worker.service.ts");n.WorkerService=d.WorkerService;var l=e("./src/sdk/services/amp-messaging.service.ts");n.AmpMessagingService=l.AmpMessagingService,n.AmpMessagingSvc=l.AmpMessagingSvc},"./src/sdk/services/logging.service.ts":function(t,n,e){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./node_modules/error-stack-parser/error-stack-parser.js"),u=e("./src/sdk/utils.ts"),c=e("./src/sdk/enums/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/constants.ts"),h=e("./src/sdk/exceptions/index.ts"),d=["test",f.ENV_NAME_DEV,f.ENV_NAME_LOCAL,f.ENV_NAME_STAGING],l=["test",f.ENV_NAME_LOCAL_PRODUCTION,f.ENV_NAME_PRODUCTION],v=function(){function t(){this.logs=[],this.applicationName=f.PUSHLY_SDK_APPLICATION_NAME,this.plugins=[],this.visibleLogsEnabled=!1;var t="WorkerGlobalScope"in self?self:window;try{if("navigator"in t&&"plugins"in t.navigator)for(var n=0;n<t.navigator.plugins.length;n++)this.plugins.push(t.navigator.plugins[n].name)}catch(t){this.plugins.push("unable to collect plugin information")}}return t.prototype.setVisibleLogsEnabled=function(t){this.visibleLogsEnabled=t},t.prototype.print=function(t,n){var e=Array.isArray(n)?n:[n];console[t].apply(console,["["+this.applicationName+"]"].concat(e))},t.prototype.getBacktrace=function(t){var n=[];try{o.parse(t).forEach(function(t){n.push({file:t.fileName,line:t.lineNumber,column:t.columnNumber,function:t.functionName})})}catch(t){this.warn(t),n.push({file:"logging.service.ts",line:"1",function:"getBacktrace"})}return n},t.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.logs=Array.prototype.concat(this.logs,t.map(function(t){return["debug",t]})),(this.visibleLogsEnabled||-1!==d.indexOf(f.ENV_NAME))&&this.print("debug",t)},t.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.logs=Array.prototype.concat(this.logs,t.map(function(t){return["info",t]})),(this.visibleLogsEnabled||-1!==d.indexOf(f.ENV_NAME))&&this.print("log",t)},t.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.logs=Array.prototype.concat(this.logs,t.map(function(t){return["warn",t]})),(this.visibleLogsEnabled||-1!==d.indexOf(f.ENV_NAME))&&this.print("warn",t)},t.prototype.error=function(){for(var t,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(n[0]instanceof a.ContextModel&&(t=n.shift()),this.logs=Array.prototype.concat(this.logs,n.map(function(t){return["error",t]})),(this.visibleLogsEnabled||-1!==d.indexOf(f.ENV_NAME))&&this.print("error",n),t&&n.length>0){var i=0,s=[];this.logs.forEach(function(t){var n=t[0],e=t[1]instanceof Error?t[1].message:t[1];s.push([n,e])}),n.length>1&&-1===(i=n.findIndex(function(t){return t instanceof Error}))&&(i=0);var o=n.splice(i,1);o&&o.length>0?o=o[0]:(o=new Error("Cannot resolve error from logs")).code="sw/cannot-resolve-error-from-logs";var u=o instanceof Error?o:new Error(o);if(u instanceof Error){var c=!1,l={error_type:u.name,error_message:u.message,backtrace:this.getBacktrace(u),logs:Array.from(s).splice(s.length-15,15),plugins:this.plugins};u instanceof h.PushlyException&&(c=u.shouldSuppress(),"originError"in u&&u.originError instanceof Error&&(l.error_message!=u.originError.message&&(l.error_message=l.error_message+"; "+u.originError.message),l.backtrace=this.getBacktrace(u.originError)));var v=u,p=v.context,b=v.code;b&&(l.error_code=b),l.context={suppressed:c||!1,originError:u.originError||null};try{l.context=r({},l.context,p)}catch(t){}var w=!1;-1!==f.DEBUG_EVENT_DOMAIN_WHITELIST.indexOf(t.domainKey)&&(w=!0),c&&!w||this.streamError(t,l)}}},t.prototype.streamError=function(t,n){return i(this,void 0,void 0,function(){var e,i,o,a;return s(this,function(s){return e=t.domain||{},i=t.user||{},n=r({},n,{sdk_version:2,source:{application:this.applicationName,version:f.PUSHLY_APPLICATION_VERSION},page_url:self.location.toString(),pushly_unique_user_id:i.puuid}),o="safari"in self?"apns_token":"fcm_subscription_id",n[o]=i.token,a={action:c.StreamableEventType.ERROR,domain_id:e.id,domain_key:t.domainKey,event_date:(new Date).toISOString(),meta:n},-1!==l.indexOf(f.ENV_NAME)?u.retryFetch(f.EVENTS_ENDPOINT,{headers:{"content-type":"application/json"},method:"POST",body:JSON.stringify(a)},function(){}):console.log(a),[2]})})},t}();n.Logger=new v},"./src/sdk/services/prompt.service.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/enums/index.ts"),u=e("./src/sdk/models/index.ts"),c=e("./src/sdk/factories/index.ts"),a=e("./src/sdk/prompts/index.ts"),f=e("./src/sdk/constants.ts"),h=e("./src/sdk/services/logging.service.ts"),d=function(t){function n(){var n=t.call(this)||this;return n.O=[],n._wireEvents(),n}return r(n,t),n.prototype._wireEvents=function(){var t=this._handleWebPushNotSupported.bind(this);this.watch(o.EventType.WEB_PUSH_NOT_SUPPORTED,t)},n.prototype._handleWebPushNotSupported=function(t,n,e){this.setCustomPromptUnsupportedClassname(n,e)},n.prototype.performManualPromptLoad=function(t,n){return i(this,void 0,void 0,function(){var e;return s(this,function(r){switch(r.label){case 0:return(e=this.O.find(function(t){return t.promptId.toString()===n.toString()}))?(h.Logger.warn("Prompt, "+n+", is already running."),[3,5]):[3,1];case 1:return(e=c.PromptFactory.getPromptById(t,n))?(this.O.push(e),e instanceof a.DomPrompt?[4,e.attachToDom()]:[3,3]):[3,5];case 2:r.sent(),r.label=3;case 3:return[4,e.run({bypassEligibilityCheck:!0})];case 4:r.sent(),r.label=5;case 5:return[2]}})})},n.prototype.loadPrompts=function(t,n){void 0===n&&(n={});var e=c.PromptFactory.getPrompts(t,n);return this.O=e.slice(),e},n.prototype.setCustomPromptUnsupportedClassname=function(t,n){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this._locateCustomPrompt()];case 1:return e.sent()&&this._loadUnsupportedCustomPrompt(t,n),[2]}})})},n.prototype._locateCustomPrompt=function(){return i(this,void 0,void 0,function(){var t,n;return s(this,function(e){return t=20,n=0,[2,new Promise(function(e,r){var i=setInterval(function(){if(n>=t&&(clearInterval(i),e(!1)),n++,document){var r=document.getElementsByClassName(f.DEFAULT_CLASSNAME_PROMPT_CUSTOM);r&&r.length>0&&(clearInterval(i),e(!0))}},500)})]})})},n.prototype._loadUnsupportedCustomPrompt=function(t,n){var e={app:{loadConfig:t},user:{env:n}};new a.CustomPrompt(e,{},!1).runInUnsupportedMode()},n}(u.Events.EventableModel);n.PromptService=new d},"./src/sdk/services/registration.service.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},s=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},o=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var u=e("./src/sdk/utils.ts"),c=e("./src/sdk/enums/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/prompts/index.ts"),h=e("./src/sdk/repositories/index.ts"),d=e("./src/sdk/constants.ts"),l=e("./src/sdk/services/helpers/firebase.service-helpers.ts"),v=e("./src/sdk/services/helpers/apns.service-helpers.ts"),p=e("./src/sdk/services/logging.service.ts"),b=e("./src/sdk/services/user.service.ts"),w=e("./src/sdk/services/worker.service.ts"),m=function(t){function n(){var n=t.call(this)||this;return n._wireEvents(),n}return r(n,t),n.prototype._wireEvents=function(){var t=this._handlePromptAllowed.bind(this);this.watch(c.EventType.PROMPT_ALLOWED,t)},n.prototype._handlePromptAllowed=function(t,n,e){return s(this,void 0,void 0,function(){return o(this,function(t){return[2,this._tryRegistration(n,e)]})})},n.prototype.tryMigration=function(t){return s(this,void 0,void 0,function(){var n,e,r,i,s,u,a,f;return o(this,function(o){switch(o.label){case 0:return n=t.domain,e=t.user,r=e.env,i={websitePushId:n.getWebsitePushId()},r.primaryRuntimeEnvironment===c.RuntimeEnvironment.PROXY||e.isUnsubscribed(i)?[2]:r.isSafari()?[4,v.ApnsServiceHelpers.getToken(t)]:[3,2];case 1:return s=o.sent(),[3,4];case 2:return[4,l.FirebaseServiceHelpers.getToken()];case 3:s=o.sent(),o.label=4;case 4:return s&&s!==e.token?(p.Logger.info("Subscription token refreshed by the remote end. Migrating subscription."),u=e.isSubscribed(i),a=e.token,e.token=s,[4,h.UserRepository.set(e)]):[3,8];case 5:return o.sent(),[4,this._getSubscriptionEndpoint(t)];case 6:return f=o.sent(),[4,this._sendSubscriptionToRemote(t,{subscription_endpoint:f,token:s,previous_token:a,domain_key:n.domainKey,amp:r.primaryRuntimeEnvironment===c.RuntimeEnvironment.AMP,migrated:!0,pushly_subscriber_data_present:u})];case 7:o.sent(),o.label=8;case 8:return[2]}})})},n.prototype._shouldOpenProxyRegistrationWindow=function(t){return t.user.env.primaryRuntimeEnvironment===c.RuntimeEnvironment.PROXY&&t.user.env.subRuntimeEnvironment!==c.RuntimeEnvironment.PROXY_PERMISSION_DIALOG},n.prototype._tryRegistration=function(t,n){return s(this,void 0,void 0,function(){var e;return o(this,function(r){return e=this._getPromptRegistrationData(t,n),this._shouldOpenProxyRegistrationWindow(t)?[2,this._openProxyRegistrationWindow(t,e)]:[2,this._register(t,e)]})})},n.prototype.performManualRegistrationAttempt=function(t,n,e){return s(this,void 0,void 0,function(){var r;return o(this,function(i){switch(i.label){case 0:return t.app.isFirebaseAppInitialized?[3,2]:[4,w.WorkerService.registerWorker(t)];case 1:i.sent(),i.label=2;case 2:return r=this._getPromptRegistrationData(t,{promptId:n,promptKeywords:e}),this._shouldOpenProxyRegistrationWindow(t)?[2,this._openProxyRegistrationWindow(t,r)]:[2,this._register(t,r)]}})})},n.prototype.unsubscribe=function(t,n){return void 0===n&&(n="blocked"),s(this,void 0,void 0,function(){var e,r,i;return o(this,function(s){switch(s.label){case 0:return e=t.user.env.isSafari(),t.user.isSubscribed({websitePushId:t.domain.getWebsitePushId()})?e?[3,4]:t.user.env.primaryRuntimeEnvironment===c.RuntimeEnvironment.PROXY?[3,4]:[4,window.navigator.serviceWorker.getRegistration()]:[3,6];case 1:return(r=s.sent())?[4,r.pushManager.getSubscription()]:[3,4];case 2:return(i=s.sent())?(p.Logger.info("Processing subscription unsubscribe request"),[4,i.unsubscribe()]):[3,4];case 3:s.sent(),s.label=4;case 4:return[4,b.UserService.setSubscriptionState(t.user,n)];case 5:s.sent(),this.post(new a.Events.StreamableEventModel(c.StreamableEventType.MANUAL_UNSUBSCRIBED,this._buildPromptPermissionEventPack(),t)),this.dispatch(new a.Events.EventModel(c.EventType.REGISTRATION_UNSUBSCRIBED,this._buildClientFeedbackEventPack())),p.Logger.info("User has been unsubscribed from notifications"),s.label=6;case 6:return[2]}})})},n.prototype._register=function(t,n){return s(this,void 0,void 0,function(){var e,r;return o(this,function(i){switch(i.label){case 0:return r=this._handlePermissionPrompted.bind(this,t,n),t.user.env.isSafari()?[4,v.ApnsServiceHelpers.requestNotificationPermission(t.domain,t.user,r)]:[3,2];case 1:return e=i.sent(),[3,4];case 2:return[4,l.FirebaseServiceHelpers.requestNotificationPermission(t,r)];case 3:e=i.sent(),i.label=4;case 4:return"granted"!==e.permissionState?[3,6]:[4,this._handlePermissionGranted(t,e.token,n)];case 5:return i.sent(),[3,7];case 6:"default"===e.permissionState?this._handlePermissionDismissed(t,n):"denied"===e.permissionState?this._handlePermissionDenied(t,n):p.Logger.warn("Unknown"),i.label=7;case 7:return[2]}})})},n.prototype._sendSubscriptionToRemote=function(t,n){return s(this,void 0,void 0,function(){var e;return o(this,function(r){switch(r.label){case 0:return t.user.subscriptionRegistered?(p.Logger.error(t,"Attempt to register subscription token more than once detected"),[2]):(e=new a.Events.StreamableEventModel(c.StreamableEventType.SUBSCRIBED,{meta:i({},n)},t),n.previous_token&&(e.data.meta.migrated=!0),!0!==e.data.meta.migrated&&(e.data.meta.subscribed_referrer=(t.user.lastReferrerState||{}).referrer),[4,this.post(e,d.ALLOW_ENDPOINT)]);case 1:return r.sent(),t.user.subscriptionRegistered=!0,[4,h.UserRepository.set(t.user)];case 2:return r.sent(),[2]}})})},n.prototype._handlePermissionPrompted=function(t,n){this.post(new a.Events.StreamableEventModel(c.StreamableEventType.PERMISSION_PROMPTED,i({},n.streamPack),t)),this.dispatch(new a.Events.EventModel(c.EventType.LEGACY_PERMISSION_DIALOG_SHOWN)),this.dispatch(new a.Events.EventModel(c.EventType.PERMISSION_DIALOG_SHOWN,n.clientPack))},n.prototype._handlePermissionGranted=function(t,n,e){return s(this,void 0,void 0,function(){var r,s,u,f,h,l;return o(this,function(o){switch(o.label){case 0:return p.Logger.info("Got token: "+n),t.user.token=n,s=t.user.env.isSafari()?"apns_token":"fcm_subscription_id",[4,this._getSubscriptionEndpoint(t)];case 1:return u=o.sent(),f=t.user.env.getQueryString(),h=t.user.env.getCurrentLocation().href,d.PUSHLY_SUBSCRIBED_URL_QS in f&&(h=decodeURIComponent(f[d.PUSHLY_SUBSCRIBED_URL_QS])),(r={})[s]=n,r.subscription_endpoint=u,r.subscribed_url=h,r.prompt_id=e.promptId,r.domain_key=t.domain.domainKey,r.amp=t.user.env.primaryRuntimeEnvironment===c.RuntimeEnvironment.AMP,l=r,e.promptId&&e.promptKeywords&&(l.tag=e.promptKeywords,l.keywords=e.promptKeywords),this.post(new a.Events.StreamableEventModel(c.StreamableEventType.PERMISSION_ACCEPTED,i({},e.streamPack),t)),this.dispatch(new a.Events.EventModel(c.EventType.LEGACY_PERMISSION_GRANTED)),this.dispatch(new a.Events.EventModel(c.EventType.PERMISSION_GRANTED,e.clientPack)),[4,this._sendSubscriptionToRemote(t,l)];case 2:return o.sent(),b.UserService.setSubscriptionState(t.user,"subscribed",n),this.dispatch(new a.Events.EventModel(c.EventType.REGISTRATION_SUBSCRIBED,n)),[2]}})})},n.prototype._handlePermissionDismissed=function(t,n){this.post(new a.Events.StreamableEventModel(c.StreamableEventType.PERMISSION_DISMISSED,i({},n.streamPack),t)),b.UserService.setSubscriptionState(t.user,"dismissed",null,n),this.dispatch(new a.Events.EventModel(c.EventType.PERMISSION_DISMISSED,n.clientPack))},n.prototype._handlePermissionDenied=function(t,n){this.post(new a.Events.StreamableEventModel(c.StreamableEventType.PERMISSION_DENIED,i({},n.streamPack),t)),b.UserService.setSubscriptionState(t.user,"blocked",null,n),this.dispatch(new a.Events.EventModel(c.EventType.PERMISSION_DENIED,n.clientPack))},n.prototype._getPromptRegistrationData=function(t,n){var e={},r=t.user.env.getQueryString();return n instanceof f.Prompt?(e.promptId=n?n.promptId:void 0,e.promptBehavior=n?n.promptConfig.behavior:void 0,n&&n instanceof f.DomPrompt&&(e.promptKeywords=n.keywords)):(e.promptId=(n||{}).promptId,e.promptKeywords=(n||{}).promptKeywords),d.PUSHLY_PROMPT_ID_QS in r&&(e.promptId=u.tryParseInt(r[d.PUSHLY_PROMPT_ID_QS])),e.streamPack=this._buildPromptPermissionEventPack(e.promptId,e.promptKeywords),e.clientPack=this._buildClientFeedbackEventPack(e.promptId,e.promptKeywords),e},n.prototype._getSubscriptionEndpoint=function(t){return s(this,void 0,void 0,function(){var n,e,r,i;return o(this,function(s){switch(s.label){case 0:return(n=t.user.env).isSafari()?[3,3]:[4,n.getNavigator().serviceWorker.getRegistration()];case 1:return(r=s.sent())?[4,r.pushManager.getSubscription()]:[3,3];case 2:(i=s.sent())&&(e=i.endpoint),s.label=3;case 3:return[2,e]}})})},n.prototype._openProxyRegistrationWindow=function(t,n){return s(this,void 0,void 0,function(){var e,r,i,s,f,h,l,v,p,b,w,m=this;return o(this,function(o){for(p in e=t.user.env.getCurrentDocument(),r=t.domain.customAllowDomain,i="Push Notification Registration",s="directories=0,toolbar=0,status=0,menubar=0,width=680,height=550",f=e.createElement("a"),h="https://"+r+"/"+t.domain.domainKey,f.href=h,(l=u.parseQueryString(f.search))[d.PUSHLY_SUBSCRIBED_URL_QS]=encodeURIComponent(window.location.toString()),l[d.PUSHLY_UNIQUE_USER_ID_QS]=t.user.puuid,l[d.PUSHLY_UNIQUE_USER_FIRST_APPEARANCE_QS]=t.user.createdAt,l[d.PUSHLY_DOMAIN_KEY_QS]=t.domain.domainKey,l[d.PUSHLY_PROMPT_ID_QS]=n.promptId,v=[],l)v.push(p+"="+l[p]);return h=f.protocol+"//"+f.host+f.pathname+"?"+v.join("&"),(b=window.open(h,i,s))?(this.post(new a.Events.StreamableEventModel(c.StreamableEventType.PROXY_WINDOW_OPENED,{meta:{promptId:n.promptId}},t)),w=window.setInterval(function(){b.closed&&(clearInterval(w),m.post(new a.Events.StreamableEventModel(c.StreamableEventType.PROXY_WINDOW_CLOSED,{meta:{promptId:n.promptId}},t)))},1e3)):this.post(new a.Events.StreamableEventModel(c.StreamableEventType.PROXY_WINDOW_BLOCKED,{meta:{promptId:n.promptId}},t)),[2]})})},n.prototype._buildPromptPermissionEventPack=function(t,n){void 0===t&&(t=null);var e={meta:{promptId:t}};return t&&n&&(e.meta.keywords=n),e},n.prototype._buildClientFeedbackEventPack=function(t,n){return void 0===t&&(t=null),void 0===n&&(n=[]),{prompt:{id:t,keywords:n}}},n}(a.Events.EventableModel);n.RegistrationService=new m},"./src/sdk/services/user.service.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./src/sdk/utils.ts"),u=e("./src/sdk/models/index.ts"),c=e("./src/sdk/repositories/index.ts"),a=e("./src/sdk/enums/index.ts"),f=e("./src/sdk/exceptions/index.ts"),h=e("./src/sdk/services/logging.service.ts"),d=e("./src/sdk/services/index.ts"),l=e("./src/sdk/services/helpers/user-profile.service-helpers.ts"),v=e("./src/sdk/services/index.ts"),p=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.userProfileEventsWired=!1,n}return r(n,t),n.prototype.loadUser=function(t,n){return i(this,void 0,void 0,function(){var e,r,i,u;return s(this,function(s){switch(s.label){case 0:return[4,c.UserRepository.get()];case 1:return e=s.sent(),r=!e.puuid,n.inWorkerGlobalScope()||(i=n.getQueryString().pushly_unique_user_id,u=o.tryParseInt(n.getQueryString().pushly_unique_user_first_appearance)),e.env=n,e.doNotTrackFlags=this._parseTrackableFlags(t.doNotTrack),r?(e.puuid=i||o.randomString(),e.createdAt=u||(new Date).getTime(),[4,c.UserRepository.set(e)]):[3,3];case 2:s.sent(),s.label=3;case 3:return e.doNotTrackFlags.length>0&&h.Logger.info("Tracking disabled for the following settings: "+e.doNotTrackFlags.join(", ")),[4,c.UserRepository.getPromptDismissedState()];case 4:return s.sent()||!e.isDismissed()?[3,6]:(e.subscriberState="none",[4,c.UserRepository.set(e)]);case 5:s.sent(),s.label=6;case 6:return[2,e]}})})},n.prototype.reloadUserWithCachePriority=function(t){return i(this,void 0,void 0,function(){var n;return s(this,function(e){switch(e.label){case 0:return[4,c.UserRepository.getWithCachePriority()];case 1:return n=e.sent(),t.puuid=n.puuid||t.puuid,t.subscriberState=n.subscriberState||t.subscriberState,t.token=n.token||t.token,[2,t]}})})},n.prototype.wireProfileEvents=function(t){var n=this;this.userProfileEventsWired||(this.userProfileEventsWired=!0,[a.EventType.PROFILE_UPDATE,a.EventType.PROFILE_UPDATE_EXTERNAL_ID,a.EventType.PROFILE_UPDATE_USER_EVENT,a.EventType.PROFILE_UPDATE_TAGS,a.EventType.PROFILE_UPDATE_REMOVE_TAGS].forEach(function(e){n._wireProfileEvent(t,e)}))},n.prototype.verifyUserSubscriptionState=function(t){return i(this,void 0,void 0,function(){var n,e,r,i,o,u,d,l;return s(this,function(s){switch(s.label){case 0:return n=t.domain,e=t.user,r={websitePushId:n.getWebsitePushId()},o=e.env.isHTTPS(),u="subscribed"===e.subscriberState,d="blocked"===e.subscriberState,l="dismissed"===e.subscriberState,o&&(i=e.env.getPushPermissionState(r),u=e.isSubscribed(r),d=e.isBlocked(),l=e.isDismissed()),h.Logger.info("Verifying user subscription state"),d?i&&"denied"!==i?"granted"!==i?[3,2]:[4,v.RegistrationService.performManualRegistrationAttempt(t,e.lastSeenPromptId)]:[3,5]:[3,7];case 1:return s.sent(),[3,4];case 2:return"default"!==i?[3,4]:[4,this.setSubscriptionState(e,"none")];case 3:s.sent(),s.label=4;case 4:return[3,6];case 5:throw"blocked"!==e.subscriberState&&(e.subscriberState="blocked"),this.debugPromptNotShown(t,"user_permission_denied"),new f.ExitException(null,a.ExceptionMessage.USER_STATE_DENIED);case 6:return[3,21];case 7:return l?i&&"default"!==i?"granted"!==i?[3,9]:[4,v.RegistrationService.performManualRegistrationAttempt(t,e.lastSeenPromptId)]:[3,12]:[3,14];case 8:return s.sent(),[3,11];case 9:return"denied"!==i?[3,11]:[4,this.setSubscriptionState(e,"blocked")];case 10:throw s.sent(),this.debugPromptNotShown(t,"user_permission_denied"),new f.ExitException(null,a.ExceptionMessage.USER_STATE_DENIED);case 11:return[3,13];case 12:throw"dismissed"!==e.subscriberState&&(e.subscriberState="dismissed"),this.debugPromptNotShown(t,"user_permission_dismissed"),new f.ExitException(null,a.ExceptionMessage.USER_STATE_DISMISSED);case 13:return[3,21];case 14:return u?("subscribed"!==e.subscriberState&&(e.subscriberState="subscribed"),h.Logger.info("Subscription state is currently set to subscribed."),[3,21]):[3,15];case 15:return i&&"default"!==i?"granted"!==i?[3,17]:[4,v.RegistrationService.performManualRegistrationAttempt(t,e.lastSeenPromptId)]:[3,20];case 16:return s.sent(),[3,19];case 17:return"denied"!==i?[3,19]:[4,this.setSubscriptionState(e,"blocked")];case 18:throw s.sent(),this.debugPromptNotShown(t,"user_permission_denied"),new f.ExitException(null,a.ExceptionMessage.USER_STATE_DENIED);case 19:return[3,21];case 20:"none"!==e.subscriberState&&(e.subscriberState="none"),s.label=21;case 21:return[4,c.UserRepository.set(e)];case 22:return s.sent(),[2]}})})},n.prototype.setToken=function(t,n){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return t.token=n,[4,c.UserRepository.set(t)];case 1:return e.sent(),[2]}})})},n.prototype.setSubscriptionState=function(t,n,e,r){return i(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return h.Logger.info("Updating subscriber state to "+n),t.subscriberState=n,e?t.token=e:delete t.token,[4,c.UserRepository.set(t)];case 1:return i.sent(),"dismissed"===n&&r?[4,c.UserRepository.setPromptDismissedState(t,r)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},n.prototype.setLastSeenPromptId=function(t,n){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return t.lastSeenPromptId=n,[4,c.UserRepository.set(t)];case 1:return e.sent(),[2]}})})},n.prototype.setPromptState=function(t,n,e,r){return i(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return t.promptFcapSeconds=n,t.promptCountState=e,[4,c.UserRepository.setPromptState(t,r)];case 1:return i.sent(),[2]}})})},n.prototype.clearPromptFcapState=function(){return i(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,c.UserRepository.clearPromptState()];case 1:return t.sent(),[2]}})})},n.prototype.setPromptDismissed=function(t,n){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,c.UserRepository.setPromptDismissedState(t,n)];case 1:return e.sent(),[2]}})})},n.prototype.setLifetimeViewedKeywordMap=function(t,n){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return t.lifetimeViewedKeywordMap=n,[4,c.UserRepository.set(t)];case 1:return e.sent(),[2]}})})},n.prototype.setLastReferrerState=function(t,n){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return t.lastReferrerState={referrer:n,lastSetAt:(new Date).getTime()},[4,c.UserRepository.set(t)];case 1:return e.sent(),[2]}})})},n.prototype.clearLastReferrerState=function(t){return i(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return delete t.lastReferrerState,[4,c.UserRepository.set(t)];case 1:return n.sent(),[2]}})})},n.prototype._parseTrackableFlags=function(t){var n=[],e=Object.keys(a.TrackableSetting).map(function(t){return a.TrackableSetting[t]});return t&&("string"==typeof t&&(t=String(t).split(",").map(function(t){return t.toLowerCase().trim()})),Array.isArray(t)&&t.length>0&&(n=t.map(function(t){return t.toLowerCase()}).filter(function(t){return-1!==e.indexOf(t)}))),n},n.prototype._wireProfileEvent=function(t,n){var e=this;this.watch(n,function(r){var o=function(){return i(e,void 0,void 0,function(){var e;return s(this,function(i){switch(i.label){case 0:return t.app&&t.app.isLoaded?[3,1]:(this.watchOnce(a.EventType.APPLICATION_LOADED,o),[3,15]);case 1:return t.user.isSubscribed({websitePushId:t.domain.getWebsitePushId()})?[3,2]:(this.watchOnce(a.EventType.REGISTRATION_SUBSCRIBED,o),[3,15]);case 2:switch(i.trys.push([2,14,,15]),n){case a.EventType.PROFILE_UPDATE:return[3,3];case a.EventType.PROFILE_UPDATE_EXTERNAL_ID:return[3,5];case a.EventType.PROFILE_UPDATE_USER_EVENT:return[3,7];case a.EventType.PROFILE_UPDATE_TAGS:return[3,9];case a.EventType.PROFILE_UPDATE_REMOVE_TAGS:return[3,11]}return[3,13];case 3:return[4,l.UserProfileServiceHelpers.saveUserProfileData(t,r)];case 4:return i.sent(),[3,13];case 5:return[4,l.UserProfileServiceHelpers.saveExternalUserId(t,r)];case 6:return i.sent(),[3,13];case 7:return[4,l.UserProfileServiceHelpers.saveUserEvent(t,r)];case 8:return i.sent(),[3,13];case 9:return[4,l.UserProfileServiceHelpers.saveUserTags(t,r)];case 10:return i.sent(),[3,13];case 11:return[4,l.UserProfileServiceHelpers.removeUserTags(t,r)];case 12:return i.sent(),[3,13];case 13:return[3,15];case 14:return e=i.sent(),d.Logger.error(t,e),[3,15];case 15:return[2]}})})};o()})},n}(u.Events.EventableModel);n.UserService=new p},"./src/sdk/services/worker.service.ts":function(t,n,e){"use strict";var r=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),i=this&&this.__awaiter||function(t,n,e,r){return new(e||(e=Promise))(function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function u(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){t.done?i(t.value):new e(function(n){n(t.value)}).then(o,u)}c((r=r.apply(t,n||[])).next())})},s=this&&this.__generator||function(t,n){var e,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=n.call(t,o)}catch(t){s=[6,t],r=0}finally{e=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./node_modules/@firebase/app/dist/index.cjs.js");e("./node_modules/@firebase/messaging/dist/index.esm.js");var u=e("./src/sdk/enums/index.ts"),c=e("./src/sdk/exceptions/index.ts"),a=e("./src/sdk/models/index.ts"),f=e("./src/sdk/repositories/index.ts"),h=e("./src/sdk/constants.ts"),d=e("./src/sdk/services/logging.service.ts"),l=e("./src/sdk/services/user.service.ts"),v=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return r(n,t),n.prototype._installPushlyServiceWorker=function(t,n){return void 0===n&&(n=!1),i(this,void 0,void 0,function(){var e,r,i;return s(this,function(s){switch(s.label){case 0:return e=t.user.env.getNavigator(),r=(r=t.app.loadConfig.sw||"/pushly-sdk-worker.js")+"?domain_key="+t.domainKey,!0!==n?[3,3]:(i=new Promise(function(t){e.serviceWorker.oncontrollerchange=t,setTimeout(function(){e.serviceWorker.oncontrollerchange=function(){},t()},3e3)}),[4,e.serviceWorker.register(r+"&v="+t.app.version,{updateViaCache:"imports",scope:"/"})]);case 1:return s.sent(),[4,i];case 2:s.sent(),s.label=3;case 3:return[2,e.serviceWorker.register(r,{updateViaCache:"imports",scope:"/"})]}})})},n.prototype.registerWorker=function(t){return i(this,void 0,void 0,function(){var n,e,r,i;return s(this,function(s){switch(s.label){case 0:n=t.user.env.getNavigator(),s.label=1;case 1:return s.trys.push([1,11,,12]),[4,this._unregisterConflictingWorkers(t)];case 2:return s.sent(),[4,n.serviceWorker.getRegistration()];case 3:return e=s.sent(),r=t.app.loadConfig.sw||"/pushly-sdk-worker.js",!!e&&-1!==((e.active||{}).scriptURL||"").indexOf(r)?[3,5]:(d.Logger.info("Registering new ServiceWorker"),[4,this._installPushlyServiceWorker(t)]);case 4:return e=s.sent(),[3,10];case 5:return t.app.workerVersion===t.app.version?[3,8]:(d.Logger.info("Hot-swapping ServiceWorkers."),[4,this._installPushlyServiceWorker(t,!0)]);case 6:return e=s.sent(),t.app.workerVersion=t.app.version,[4,f.ApplicationRepository.set(t.app)];case 7:return s.sent(),[3,10];case 8:return"update"in e?(d.Logger.info("Running ServiceWorker update check"),[4,e.update()]):[3,10];case 9:s.sent(),s.label=10;case 10:return this._initializeFirebase(t,e),d.Logger.info("ServiceWorker setup completed"),[3,12];case 11:if((i=s.sent())instanceof c.FirebaseException)throw i;throw d.Logger.warn({type:i.type,code:i.code,message:i.message,error:i}),new c.WorkerRegistrationException(i);case 12:return[2]}})})},n.prototype.loadServiceWorkerDependencyScript=function(t){return i(this,void 0,void 0,function(){var n,e,r;return s(this,function(i){return(n=t.user.env.getCurrentDocument())&&n.body&&((e=n.createElement("script")).onload=function(){d.Logger.info("ServiceWorker dependency script loaded")},e.async=!0,e.src=h.SW_DEPENDENCY_URL,(r=n.getElementsByTagName("script")[0]).parentNode.insertBefore(e,r)),[2]})})},n.prototype._unregisterConflictingWorkers=function(t){return i(this,void 0,void 0,function(){var n,e,r,i,o,u,c,a,f;return s(this,function(s){switch(s.label){case 0:n=t.user.env.getNavigator(),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.serviceWorker.getRegistrations()];case 2:for(e=s.sent(),r=0,i=e;r<i.length;r++)o=i[r],u=o.scope,c=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/",u!==c?(d.Logger.info("Unregistering service worker with scope: "+u),o.unregister()):(a=o.active)&&-1!==a.scriptURL.indexOf("domain_key=undefined")&&(d.Logger.info("Unregistering service worker with undefined domain_key: "+u),o.unregister());return[3,4];case 3:return f=s.sent(),d.Logger.warn("Exception during unregistering service worker "+f.toString()),[3,4];case 4:return[2]}})})},n.prototype._initializeFirebase=function(t,n){if(t.app.isFirebaseAppInitialized)d.Logger.warn("Firebase already initialized");else try{o.default.initializeApp({messagingSenderId:t.domain.senderId}),t.app.isFirebaseAppInitialized=!0;var e=o.default.messaging();e.useServiceWorker(n),t.domain.shouldUseCustomVapidKey()&&e.usePublicVapidKey(t.domain.vapidPublicKey);var r=this._handleTokenRefresh.bind(this,e,t);e.onTokenRefresh(r)}catch(t){if(t.code!==u.FirebaseError.FIREBASE_DUPLICATE_APP)throw new c.FirebaseException(t);d.Logger.warn("Firebase already initialized")}},n.prototype._handleTokenRefresh=function(t,n){return i(this,void 0,void 0,function(){var e,r;return s(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,t.getToken()];case 1:return e=i.sent(),d.Logger.info("Firebase token refreshed",e),[4,l.UserService.setToken(n.user,e)];case 2:return i.sent(),this.post(new a.Events.StreamableEventModel(u.StreamableEventType.TOKEN_REFRESHED,{meta:{refreshed_token:e}},n)),this.dispatch(new a.Events.EventModel(u.EventType.FCM_TOKEN_REFRESH,e)),[3,4];case 3:return r=i.sent(),d.Logger.error(n,"Unable to retrieve refreshed token ",r),[3,4];case 4:return[2]}})})},n}(a.Events.EventableModel);n.WorkerService=new v},"./src/sdk/styles/app.scss":function(t,n,e){},"./src/sdk/utils.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/common/utils.ts");n.retryFetch=r.retryFetch,n.randomString=r.randomString,n.tryParseInt=r.tryParseInt,n.delay=r.delay,n.delayRandom=r.delayRandom;var i=e("./src/sdk/constants.ts");n.simpleHash=function(t){return btoa(JSON.stringify(t))},n.simpleUnHash=function(t){return n.tryParseJSON(atob(t))},n.isProductionBuild=function(){return"production"===i.ENV_NAME||"prod"===i.ENV_NAME},n.hashFromString=function(t){for(var n=5381,e=t.length;e;)n=33*n^t.charCodeAt(--e);return n>>>0},n.parseQueryString=function(t){for(var n={},e=0,r=t.split("?").pop().split("&");e<r.length;e++){var i=r[e].split("=");i[0]&&(i[1]=i[1]?i[1].replace(/\+/gi," "):"",n[i[0]]=decodeURIComponent(i[1]))}return n},n.tryParseJSON=function(t){var n;try{n=JSON.parse(t)}catch(t){}return n}},"./src/web.ts":function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./src/sdk/models/index.ts"),i=e("./src/sdk/sdk.ts");e("./src/sdk/styles/app.scss");var s=new i.SDK(new r.ContextModel),o=window.PushlySDK;if(o&&o instanceof Array)for(var u=0,c=o;u<c.length;u++){var a=c[u];s.push(a)}window.PushlySDK=s}});
//# sourceMappingURL=sdk/v2/pushly-sdk.min.js.map
